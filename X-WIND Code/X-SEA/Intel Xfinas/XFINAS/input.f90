      SUBROUTINE INPUT1
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)

C     ----------------------------------------------------------------
C     MAIN PROGRAM
C	------------
C     1. TO SET UP STORAGE
C     2. TO READ AND GENERATE SOLUTION CONTROL, JOINT AND ELEMENT DATA
C     3. TO COMPUTE EQUATION NUMBERS AND ADRESSES OF DIAGONAL ELEMENTS
C        IN COMPACTED GLOBAL STIFFNESS MATRIX
C     4. TO PRINT OUT INPUT DATA AND ADDRESSES
C     ----------------------------------------------------------------
C
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC

      COMMON /LOCA/ LID,LDS,LEL,LDC,LXY,LCH,LNU,LMP,LGP,LMS,LGS,
     1              LCO,LEX,LLM,LES,LEC,LED,LEI,LEE,LMA,LLF,LLV,
     2              LRE,LDI,LDL,LDT,LDK,LER,LEV,LTT,LWV,LAR,LBR,
     3              LVE,LDD,LRT,LBU,LBC,LVL,LAL,LEF,LDU,LPR,LLO,
	4              LRV,LRT1,LRET,LRET1,LDM,LDPT,LVL1,LMV,LXI,LCM,LCC,
	5			    LCN,LDIM,LFRE,LSFC

      COMMON /LOCO/ LOP,LOS,LSS,LSS2,LSS3,LHG,LHGN

C	Next Common Block added 13Dec03 by NguyenDV 
      COMMON /LOCD/ LSC

C
      COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
      COMMON /BOPT/ IBW1,IPF1,IBW2,IPF2,LCON,MCON,IDPTH,MAXCON,IREDU
      COMMON /SOLU/ NEQ,NEQ1,NBLOCK,MK,BM,NWK,NWM,ISTOR,NFAC,
     +              NRED,KPOSD,DETK,DET1,DAVR,STOL
      COMMON /ITER/ RHO,RHOP,RHOPREV,RTOL,ETOL,DLMAX,ALP,
	1              NSTEP,NPRIN,NDRAW,
	2			  KONEQ,NIREF,ITOPT,ICONV,NOLIN,KSTEP,
     3              LIMEQ(2),ITEMAX,NUMREF,NUMITE,ITETOT,LIMET
      COMMON /DYNA/ CDEN,IMASS
      COMMON /EIGN/ NSEIG,NROOT,NC,NNC,NITEM,IFSS,SHIFT0,EPS,IEIG,NEIG,
     +              ISOLV,IVPRT
      COMMON /FTIM/ TIM(20),IDATE,ITIME

	COMMON /SEIS/ ISEIDA,ISEIOP,IADIR,IAFM,ICOMB,IRES,NPICK,
	1			  NSTIM,NEAQ,NAV,NSAV
	COMMON /LOCW/ N1,N2,N3,N4,N5,N6,N7,N8,N9,N10,N11,NSTI,NAX,NAY,
     +			  NAZ,NSTIN,NAXI,NAYI,NAZI
     
      COMMON /DMCO/ IDMA,IANA,IDSO,NNBR,NNRA,NEBEBR,NPBEBR,NLRB,
     +			  NEWKTK,NPWKTK,NEBERA,NPBERA,NDOF,NNBE,NNWK

C	Next common /LODW/added Jul04 to store Dynamic Moving solution in W-array
c	COMMON /LODW/ I_MPWK,I_LNWK,I_PRWK
C	Changed 28Oct06 by Nguyen-Song
	COMMON /LODW/ I_MPWK,I_LNWK,I_PRWK,I_MPBEBR,I_LNBEBR,I_PRBEBR

C	DYNAMIC INTEGRATION PARAMETER
	COMMON /TIME/ DDT,CTIM,NINC

C	==================================================================
C	JOINT GLOBAL CONSTRAINT SONGSAK JAN2007 
	COMMON /LC007/ LC107,LC207,LC307,LC407
C	==================================================================
C	COMMON BLOCK FOR HEAT SONGSAK MAR2007
	COMMON /SHEAT/ NHAEF,LHEAT1,LHEAT2,LHEAT3,LHEAT4

	COMMON /LINEAT/ KTRAF,KEATH,KCSAL,KOFFL,KSPEC,KDESIGN,KFATM,KFATJ,KFATL,KFAST,KOREV !SONGSAK AUG2007 RESPONSE SPECTRUM FOR ISOLOP 1 !SONGSAK AUG2007 RESPONSE SPECTRUM FOR ISOLOP 1

C	NEW EARTHQUAKE ANALYSIS SONGSAK SEP2007
	COMMON /LNDEQK/ LDEK,LPR2,LDESTP
	COMMON /LNDEQR/ EQAMP(3),EQGAP(3)

      COMMON A(7000000),IA(6000000)

C	COMMON /MEMW/ W(5000000)
C	Previous lined changed to the next, July04
	COMMON /MEMW/ W(6000000),IW(4000000)
	
      COMMON /WARNING/ WARNING,RAMDA(100),RK
      COMMON / CONTROLSPECTRUM / KTOEY
C	--------------------------------------
C     Write for GiD Header, GaussPoints Use
C     --------------------------------------
	WRITE (101,1200)

C     --------------
C     INITIALISATION
C     --------------
      CALL CLEARA (TIM,20)

      CALL CPU_TIME (TIM(1))

      REWIND 1
C     -------------------------------------------------------
C     INPUT OF MASTER, NONLINEAR AND EIGENVALUE CONTROL
C     STORAGE ALLOCATION FOR EQUATION NUMBERS AND COORDINATES
C     -------------------------------------------------------
      CALL CONTRO
      CALL SOLOPT
      CALL NLMODE
      CALL EIGMOD
      
      IF (ICONTROLSPEC.EQ.1) ISOLOP = 1

C	Next IF-block added 25Jun04 by NguyenDV to read Dynamic Moving Load Controls
	IF (ISOLOP.EQ.11) CALL DMCONT

      CALL LOCATI (1)
C     ------------------------------
C     GENERATION OF NODAL INPUT DATA
C     ------------------------------
      CALL NODEIN (IA(LID),A(LSS),A(LSC),IA(LDS),A(LDC),A(LXY),
     1             NSF,NSN,A(LSS2),IA(LC307),IA(LC407))
C
      CALL CPU_TIME (TIM(2))


C	READ HEAT ABIENT TEMPERATURE MAR2007
	IF(ISOLOP.EQ.14) CALL HEATAMBT(A(LHEAT1))

C     --------------------------------
C     GENERATION OF ELEMENT GROUP DATA
C     --------------------------------
      CALL CLEARI (IA(LCH),NSN*MAXCON)

C     INITIALIZE MATRIX FOR SUPPRESS FLYING DOF (USE IN NESUPPRS -- SEE ALSO IN ELEMIN)
      CALL NNSUPPRS(IA(LID),NSF,NSN,'INIT')
	
      CALL ELEMIN (IA(LEL))
      
C	READ GENERAL LINK ELEMENT SONGSAK JUN2007
	CALL INPLINK(IA(LCH),0)

C     SUPPRESS FLYING DOF USING MATRIX FROM NESUPPRS (SEE ALSO IN ELEMIN)
      CALL NNSUPPRS(IA(LID),NSF,NSN,'SUPP')
      
      CALL CPU_TIME (TIM(3))
C     ------------------------------------------------------
C     COMPUTATION OF DIAGONAL ADDRESSES IN COMPACTED [K]
C     COLUMN NUMBERS, COUPLING AND INDEX OF STIFFNESS BLOCKS
C     ------------------------------------------------------
      CALL LOCATI (3)
      L1 = LCH + LCON*MCON
      L2 = L1  + 2*LCON+1
      CALL REDUCE (IA(LCH),IA(L1),IA(L1+LCON),IA(L2),IA(L2+LCON),
     +             IA(L2+2*LCON),IA(L2+3*LCON),IA(L2+4*LCON),LCON)

C
      CALL CPU_TIME (TIM(4))

      CALL NEQUAT (IA(LID),IA(LCH),IA(L1),NSF,NSN,IA(LC307),IA(LC407))
      CALL CLEARI (IA(LCH),NEQ)
      CALL READEL (IA(LEL))

C	UPDATE STIFFNESS COLUMN HEIGHT DUE TO GENERAL LINK ELEMENT SONGSAK JUN2007
	CALL INPLINK(IA(LCH),1)
C
      CALL LOCATI (4)
      CALL ADRESS (IA(LMA),IA(LCH))

C	BLOCK SOLVER
	CALL MBLOCK (IA(LMA),NEQ)
C
	CALL ININUMB
	
C	NEW OUTPUT SONGSAK JUL2007
	CALL INIOUT1
C	GID GROUP MAPPING
	CALL GIDMAP
C	ELEMENT GAUSS POINT PRINTING
	CALL GAUSSPRIN (IA(LEL))

C     SHRINKAGE PATTERN NOV2010
      CALL PATTERN('SKPT')

C     TEMPERATURE PATTERN FOR FRAME TEMPERATURE LOAD NOV2010
      CALL PATTERN('TMPT')


	IF(ISOLOP.EQ.1) THEN
C	MOVING LOAD SONGSAK JAN2007 SEE ALSO MOVING LOAD.FOR
	IF(KTRAF.EQ.1) CALL LANREAD(IA(LEL))

C	VEHICLE DATA
	IF(KTRAF.EQ.1) CALL VEHDAT

C	RESPONSE SPECTRUM ANALYSIS
	IF(KEATH.EQ.1) CALL RESSPE1(0)
	
C	CONSTRUCTION ANALYSIS
	IF(KCSAL.EQ.1) CALL MESHINP
	ENDIF


C	OFFSHORE LOAD ANALYSIS
	IF(KOFFL.EQ.1.OR.KSPEC.EQ.1) THEN
	  CALL OFFSPARA       !OFFSHORE PARAMETERS
	  CALL OFFSHFILE(NEQ) !OPEN FILE TO STORE OFFSHORE LOAD
      ENDIF
      
      IF(KDESIGN.EQ.1)THEN
       CALL DESIGNREAD
      ENDIF
      
      
	IF(ISOLOP.EQ.19) CALL MESHINP

500	CALL CPU_TIME (TIM(5))

C     ----------------------------------------------------
C     STORAGE ALLOCATION FOR LOAD AND NL.VECTORS (NOLIN>0)
C     STORAGE REQUIREMENTS FOR STIFFNESS BLOCKS AND
C     INITIAL STRESS OR MASS MATRIX (IEIG>0)
C     ----------------------------------------------------
      CALL LOCATI (7)

C	LOAD COMBINATION DATA
	IF(ISOLOP.EQ.1.AND.ICONTROLSPEC.EQ.0) CALL LDCMREAD

C	CREEP LOAD COMBINATION DATA
	IF(ISOLOP.EQ.19) CALL LDCMREAD		

C	ADDED MASS !MUST BE FOLLOW LOCATI (7)
	CALL NODALMS(A(LCM),IA(LID))  
	
C	ADDED DAMP !MUST BE FOLLOW LOCATI (7)
	CALL NODALDP(A(LCC),IA(LID)) 

C     -------------------------------------
C     INPUT OF NODAL LOADS AND LOAD FACTORS
C     -------------------------------------
C	IF (ISOLOP.EQ.3.OR.ISOLOP.EQ.11) GOTO 100	!removed 24Feb06
      IF (ISOLOP.EQ.11) GOTO 100	!removed 24Feb06

	IF (ISOLOP.EQ.5.OR.ISOLOP.EQ.1) THEN
	    IF(KSPEC.EQ.1) GOTO 100
	ENDIF
	
C	LOAD INFORMATION	
25	CALL LOADIN  (IA(LEL))
      CALL INCRLO (A(LLF))

30	IF (ISOLOP.GE.10) GOTO 40
C     -----------------------------------------------------
C     INPUT OF NSTEP # OF LOAD CUREVES FOR DYNAMIC ANALYSIS
C     -----------------------------------------------------
	IF (ISOLOP.GE.5) THEN
	IF(LDEK.EQ.0) CALL LOADCURV (0.0,1,NSTEP,A(LPR),PROPLD)
	IF(LDEK.NE.0) CALL READQUAK !NEW EARTHQUAKE SONGSAK SEP2007
	ENDIF


C     ---------------------------------------------------
C     INPUT OF INTEGRATION CONSTANTS FOR DYNAMIC ANALYSIS
C	NEWMARK OR WILSON-THETA
C     ---------------------------------------------------
35	IF (ISOLOP.GE.5) CALL INTCON !Changed next 24May07 by Nguyen Add Label

C     -------------------------------------------
C	INPUT OF SEISMIC DATA AND ANALYSIS SOLUTION
C	This part added by NguyenDV, July7,2003
C	-------------------------------------------
100	CALL LOCAW(1,0)


200	CALL CPU_TIME (TIM(6))
C     ---------------------------------------------------
C     STORAGE NEEDED DURING EIGENVALUE ITERATION (IEIG>0)
C     REDUCE FIELD LENGTH TO REQUIRED MAXIMUM VALUE
C     PRINT LOCATIONS OF FLEXIBLE ARRAYS
C     ---------------------------------------------------
      IF (IEIG.GT.0) CALL LOCATI (8)
      CALL LOCATI (9)
      
      IF (KSPEC.EQ.1.AND.KTOEY.EQ.0)THEN
      CALL ITERAT1(W,1)
      KTOEY = 1
      GOTO 25
      ENDIF
      
C	LOAD INFORMATION
C      IF (ISOLOP.EQ.1.AND.KSPEC.EQ.1.AND.KOFFL.EQ.1) CALL LOADIN  (IA(LEL))

C      CALL INCRLO (A(LLF))

40	DO 50  I=1,5
50	TIM(I) = TIM(I+1)-TIM(I)
	CALL CPU_TIME (TIM(6))


C	----------------------------------------------------------------
 1200 FORMAT ('GiD Post Results File 1.0'/)
C	----------------------------------------------------------------

      RETURN
      END
C
C=====================================================================
      SUBROUTINE CONTRO
      IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
      CHARACTER*7 HEAD
      COMMON /HEADER/ HEAD
C	SUNIL 01/05/03 COMPLETELY RE-ORGANIZED 
C     ----------------------------------------------------------------
C     READS STRUCTURAL CONTROL VARIABLES INTO COMMON BLOCK /NUMB/
C	-----------------------------------------------------------
C     HED(8)    = HEADER FOR LABELLING OUTPUT
C     MODEX     = EXECUTION MODE (DATA CHECK=1,SOLUTION=2,RESTART=3)
C	ISOLOP		SOLUTION CONTROL OPTIONS
C					1 = LINEAR STATIC
C					2 = NONLINEAR STATIC
C					3 = EIGNEVLUE (FREE VIBRATION)
C					4 = EIGENVLUE (LINEAR BUCKLING)
C					5 = LINEAR DYNAMIC
C					6 = LINEAR DYNAMIC (MODE SUPERPOSITION)
C					7 = NONLINEAR DYNAMIC
C					8 = NONLINEAR DYMAMIC (MODE SUPERPOSITION)
C     NRE       = NUMBER OF REGIONS
C     NRN       = NUMBER OF NODES TO DEFINE REGIONS
C     NSN       = NUMBER OF NODES FOR ENTIRE STRUCTURE
C     NEG       = NUMBER OF ELEMENT GROUPS
C     NBS       = NUMBER OF GLOBAL SUPPORTS
C     NLS       = NUMBER OF LOCAL SUPPORTS (SKEWED SUPPORTS)
C     NLA       = NUMBER OF LOCAL AXES
C     NSC       = MAXIMUM NUMBER OF COORDINATES AT ANY ONE NODE
C     NSF       = MAXIMUM NUMBER OF DEGREES OF FREEDOM AT ANY ONE NODE
C     IDOF(9)   = MASTER CODE TO LOCATE FREE DEGREES OF FREEDOM
C     ----------------------------------------------------------------
C	SUNIL 20/01/01 NRN REMOVED (NEVER USED)
C
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /NUMB2/ IDOFB(9)
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
      COMMON /FTIM/ TIM(20),IDATE,ITIME
C	NEXT THREE COMMON ADDED BY GILSON - NOV2003 (INPUT)
      COMMON /BOPT/ IBW1,IPF1,IBW2,IPF2,LCON,MCON,IDPTH,MAXCON,IREDU
      COMMON /SOLU/ NEQ,NEQ1,NBLOCK,MK,BM,NWK,NWM,ISTOR,NFAC,
     +              NRED,KPOSD,DETK,DET1,DAVR,STOL

C
C	ADDED BY DE SILVA NOV2003
	COMMON /SPBC/ NSS,NLSS


C	MOVING LOAD PRINTING FLAG SONGSAK JUL2007
	COMMON /LANPRIN/  LAN_PRN,ILPL,MLANE,NPL,LAN_OPT

C	==================================================================
C	JOINT GLOBAL CONSTRAINT SONGSAK JAN2007 
	COMMON /LC007/ LC107,LC207,LC307,LC407
C	==================================================================

C	SECURITY CHECK SONGSAK MAR2006
	COMMON /SECUR/ NDMAX,NMMAX

C	GRAVTITY DIRECTION ADDED BY SONGSAK MAR2006  
	COMMON /MGRAV/ NGRAV

C     FAST
C     ----------------------------------------
C     CHECK UNIT NUMBERS TO INPUT/OUTPUT FILES
C     ----------------------------------------
      ! WRITE : XFINAS PERMANENT VERSION
      WRITE (ISO,1000)
      WRITE (ITO,1000)

	IF (ITI.EQ.1) GOTO 110
      CALL ERRORS (18,NN,ITI,'I/O FILES ')
 110  IF (ISO.EQ.7) GOTO 120
      CALL ERRORS (18,NN,ISO,'I/O FILES ')
C     ----------------------------------------------
C     READ PRINT FLAGS FOR ADDITIONAL OUTPUT OPTIONS
C     ----------------------------------------------
 120	WRITE (ITO,2000)
      READ (ITI,*,END=200) IFPR
      GOTO 300
 200  CALL ERRORS (9,NN,NN,'PRINT OPT ')
C     ----------------------------
C     READ STRUCTURAL CONTROL DATA
C     ----------------------------
      ! WRITE : READ HEADER INFOMATION
 300	WRITE (ITO,2001)
C     START XFINAS DATA INPUT OF PROJECT NAME:
	READ (ITI,3100,END=310) HED
	GOTO 320
 310  CALL ERRORS (9,NN,NN,'HEADER    ')
      ! WRITE : READ STRUCTURAL CONTROL DATA
 320	WRITE (ITO,2002)


	MODEX = 2
C     READ EQUATION SIZE & SOLUTION OF:	
	READ (ITI,*) HEAD,HEAD,HEAD,HEAD,HEAD,HEAD
	IDOF(1:9) = 0
C     LINE NUMBER 4 	
	READ (ITI,*) ISOLOP,NRE,NSN,NEG,NBS,NLS,NSS,NLSS,
	1			 NLA,LCS,LC107,LC207,IDOFB,IREDU,MAXCON,
	2			 KPOSD,IMOPT,ITPRE,NGRAV !,LSYMM
 	LSYMM = 0
 	
 	IMOPT = 1
 	ITPRE = 3


C	READ HEADER
C     READ NUMBER OF LOAD CASE 
	CALL LCHEADER(LCS,'STND')


C	PREPARE STORAGE FOR ELEMENT GROUP WORKING ARRAY (NEG,10)
	CALL  DEMINT('GWOK',KGWOK,NEG,10,'FIRS')

	CALL  DEMINT('GEAS',KGEAS,NEG,15,'FIRS')

C	SYSTEM MATRIX SOLVER SCHEME
	CALL  DEMINT('SOLV',KSOLV,  1, 5,   'FIRS')		!STORE SOLVER OPTION
	CALL MINTFIL('SOLV',IMOPT,  1, 1, 1,'FIRS')		!STIFFNESS PROFILE AND SOLVER OPTION --0 = DIRECT  , 1 = ITERATION 
	CALL MINTFIL('SOLV',ITPRE,  1, 2, 1,'FIRS')		!PRECONDITIONER SCHEME FOR ITERATION --0 = STANDARD, 1 = JACOBI   , 2 = IMCOMPLETE CHOLESKI

C	IF(ISOLOP.EQ.11) STOP
      ! WITE : AND STIFFNESS MATRIX CONTROL VARIABLES
	WRITE (ITO,4000)

C	MOVING LOAD PRINTING FLAG SONGSAK JUL2007
	LAN_PRN = 0

C	SECURITY CHECK SONGSAK MAR2006 
      ! WRITE : NUMBER OF NODE IS GREATER THAN MAXIMUM ALLOWABLE (500 NODES) IF PASSWORD WRONG !
 	CALL NODCHEK(ISOLOP,NSN)


	GOTO 340
 330  CALL ERRORS (9,NN,NN,'STUR. CON.')
C
 340	IF (MODEX.LT.1 .OR. MODEX.GT.3) MODEX = 1
      IF (NRE.LT.0) NRE = 0
      IF (NSN.GE.2) GOTO 360
      CALL ERRORS (1,NSN,NSN,'CONTROL NO')
 360  IF (NEG.LE.0) NEG = 1
      IF (NBS.LT.0) NBS = 0
      IF (NLS.LT.0) NLS = 0
      IF (NLA.LT.0) NLA = 0

C	SET DIMENSION OF COORDINATE 2D OR 3D
      NSC = 3

C	==============================================
C	EVALUTE NUMBER OF STRUCTURAL DEGREE OF FREEDOM !CHANGED BY SACHARUCK MAR2007 (SONGSAK IMPLEMENTOR)
C	==============================================
      NSF = 0
      DO 370  I=1,9
 370  IF (IDOF(I).EQ.0) NSF = NSF+1

C     ----------------------------------
C     PRINT STRUCTURAL CONTROL VARIABLES
C     ----------------------------------
      WRITE (ISO,5000) HED,MODEX,ISOLOP,NRE,NSN,NEG,NBS,NLS,
     +                 NSS,NLSS,NLA,LCS,NSC,NSF,IDOF
C     ---------------------------
C     SET LOCATIONS OF FREE D.O.F.  !CHANGED BY SACHARUCK MAR2007 (SONGSAK IMPLEMENTOR)
C     ---------------------------
      IF = 0                       
      DO 490  I=1,9
      IF (IDOF(I)) 490,450,490
 450  IF = IF+1
      IDOF(IF) = I
 490  CONTINUE
      IF1 = IF+1
      IF (IF1.GT.9) RETURN
      DO 510  IF=IF1,9
 510  IDOF(IF) = 0
C
 1000 FORMAT (1X,78(1H*),/30x,'X F I N A S',/
     +        20X,'FINITE ELEMENT ANALYSIS PROGRAM',/
     +		18X,'NONLINEAR STATIC AND DYNAMIC OPTIONS',/35X,/
     +        1X,78(1H*))
 2000 FORMAT (1X,'READ FLAGS FOR PRINT OPTIONS (10)')
 2001 FORMAT (1X,'READ HEADER INFOMAION')
 2002 FORMAT (1X,'READ STRUCTURAL CONTROL DATA')

 3100 FORMAT (20A4)
C	NEXT LINE ADDED BY GILSON - AUG2002
 4000 FORMAT (1X,'     AND STIFFNESS MATRIX CONTROL VARIABLES')
 5000 FORMAT (//24X,31(1H*)/24X,1H*,29X,1H*/
     +        24X,'* STRUCTURE CONTROL VARIABLES *'/
     +        24X,1H*,29X,1H*/24X,31(1H*)//1X,20A4/1X,79(1H-)//
     +        14X,'EXECUTION MODE (1, 2 OR 3)  . . . . .MODEX =',I9/
     +        14X,'SOLUTION OPTION (1-10). . . . . . . ISOLOP =',I9/
     +        14X,'NUMBER OF REGIONS . . . . . . . . . .  NRE =',I9/
     +        14X,'NUMBER OF NODES FOR STRUCTURE . . . .  NSN =',I9/
     +        14X,'NUMBER OF ELEMENT GROUPS  . . . . . .  NEG =',I9/
     +        14X,'NUMBER OF GLOBAL SUPPORTS . . . . . .  NBS =',I9/
     +        14X,'NUMBER OF LOCAL (SKEWED) SUPPORTS . .  NLS =',I9/
     +        14X,'NUMBER OF GLOBAL SPRING SUPPORT . . .  NSS =',I9/
     +        14X,'NUMBER OF LOCAL  SPRING SUPPORT . . . NLSS =',I9/
     +        14X,'NUMBER OF LOCAL AXES  . . . . . . . .  NLA =',I9/
     +        14X,'NUMBER OF LOAD CASES  . . . . . . . .  LCS =',I9/
     +        14X,'MAX. NUMBER OF NODAL COORDINATES. . .  NSC =',I9/
     +        14X,'MAX. NUMBER OF NODAL D.O.F. . . . . .  NSF =',I9/
     +        14X,'LOCATIONS OF FREE D.O.F.  . . . . . . IDOF =  ',9I1)

      RETURN
      END
C
C=====================================================================
      SUBROUTINE NODEIN (ID,SD,DFACS,IDSET,DIRCOS,XY,MSF,MSN,SD2,
	1				   LCON1,LCON2)
      IMPLICIT INTEGER*4 (I-N)
      IMPLICIT REAL*8 (A-H,O-Z)
C     -----------------------------------------------------
C     GENERATION OF STRUCTURE NODES AND BOUNDARY CONDITIONS
C	-----------------------
C     ID(NSF,NSN)   = BOUNDARY CONDITIONS
C     IDSET(NSN)    = LOCAL AXES SET NUMBERS
C     DIRCOS(9,NLA) = DIRECTION COSINES OF LOCAL AXES
C     XY(NSN,NSC)   = STRUCTURE COORDINATES
C	DFACS(NSN)    = ARRAY CONTAINING NODAL ISOSLATOR DAMPING/STIFF FACTOR
C     -----------------------------------------------------
C
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /NUMB2/ IDOFB(9)  
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
C	ADDED BY DE SILVA NOV2003
	COMMON /SPBC/ NSS,NLSS
      

C	==================================================================
C	JOINT GLOBAL CONSTRAINT SONGSAK JAN2007 
	COMMON /LC007/ LC107,LC207,LC307,LC407
C	==================================================================
      
      ! ----------------------------------------------------------------
      ! ADDED BY TOEY 20-02-2013 FOR CALCULATE ACTUALLY LENGTH AND VALUE 
      COMMON /DESIGN/ AX(999999),AY(999999),AZ(999999),NNO,NND(999999),NCOM
      ! ----------------------------------------------------------------
      
C	--------------------------------------------------------------
      DIMENSION ID(MSF,1),IDSET(1),DIRCOS(9,1),XY(MSN,1),COORD(3,21)

C	CHANGED BY SACHARUCK MAR2007 (SONGSAK IMPLEMENTOR)
C	DIMENSION XYZ(3),ISD(3),IBC(7),IPERM(22),DCOS(9)
	DIMENSION XYZ(3),ISD(3),IBC(9),IPERM(22),DCOS(9)

C	NEXT ADDED BY VSAYAK  11AUG03
	DIMENSION NOD(NSN) !Node number

C	ADDED BY DE SILVA NOV2003
C	CHANGED BY SACHARUCK MAR2007 (SONGSAK IMPLEMENTOR)
C	DIMENSION SD(6,MSN),SBC(6),STL(6,MSN),STC(6),VR(3),VS(3),VT(3)
	DIMENSION SD(6,MSN),SBC(6),STC(NSF),VR(3),VS(3),VT(3)

	DIMENSION TT1(6,6),DFACS(MSN)

C	BILINEAR SPRING SUPPORT SONGSAK NOV2006
	DIMENSION SD2(7*6,MSN)  !ACTUAL SIZE IS SD2(7*6,NSS)

	DIMENSION LCON1(11,LC107),LCON2(LC207,LC107)
	
C	--------------------------------------------------------------
      DATA IPERM  /1,4*0,1,0,1,0,0,1,1,0,5*1,4*0/

C     --------------
C     INITIALISATION
C     --------------
      CALL CLEARA (XY,NSN*NSC)
      CALL CLEARI (IDSET,NSN)
C     ----------------------
C     DEFINE LOCAL AXES SETS
C     ----------------------
      IF (NLA.EQ.0) GOTO 50
      ISET = 0
      WRITE (ITO,6000) NLA

C	REIMPLIMENTATION BY DE SILVA 29/3/2004
c	read DIRECTION COSINES ***********************************
	READ (ITI,*)
 630  READ (ITI,*,END=631) NSET,(DCOS(N),N=1,6)
 631	DCOS(7) = DCOS(2)*DCOS(6)-DCOS(3)*DCOS(5)
      DCOS(8) = DCOS(3)*DCOS(4)-DCOS(1)*DCOS(6)
      DCOS(9) = DCOS(1)*DCOS(5)-DCOS(2)*DCOS(4)
      IF (NSET.LE.NLA) GOTO 610
      CALL ERRORS (21,ISET,NSET,'LOCAL AXES')
      GOTO 600
 610  UNITL = DCOS(7)*DCOS(7)+DCOS(8)*DCOS(8)+DCOS(9)*DCOS(9)
      IF (DABS(UNITL-1.0).LT.0.0001)  GOTO 620
      CALL ERRORS (22,ISET,NSET,'LOCAL AXES')
      GOTO 600
 620  DO 640  N=1,9
 640  DIRCOS(N,NSET) = DCOS(N)
      ISET = ISET + 1
 600  IF (ISET.LT.NLA) GOTO 630
C     -----------------------
C     PRINT DIRECTION COSINES
C     -----------------------
      WRITE (ISO,6100)
      DO 660 ISET=1,NLA
 660  WRITE (ISO,6200) ISET,(DIRCOS(N,ISET),N=1,9)


C     ----------------------------------------------
C     LOOP OVER NUMBER OF REGIONS, READ REGION CODE,
C     NODEL COORDINATES AND NUMBER OF INTERVALS
C     ----------------------------------------------
  50  NFIRST = 1
      IRE    = 0
 100  WRITE (ITO,1000) IRE+1

	READ (ITI,*)
      READ (ITI,*) ICODE
C     ---------------------
C     READ INDIVIDUAL NODES
C     ---------------------
 200  WRITE (ITO,2000)

	READ (ITI,*)
      READ (ITI,*) NNO
	NLAST = NFIRST + NNO - 1
      IF (NLAST.LE.NSN) GOTO 210
      CALL ERRORS (2,IRE,NLAST,'INDIV.NODE')

210	READ (ITI,*)

      ! READ NODE AND COORDINATE OF STRUCTURE SENT TO CODE CHECKING.FOR
      ! COMMON /DESIGN/ AX(9999999),AY(9999999),AZ(9999999),NNO
	DO INO = NFIRST,NLAST
	READ(ITI,*) NOD(INO),XY(INO,1:NSC)
	AX(INO) = XY(INO,1)
	AY(INO) = XY(INO,2)
	AZ(INO) = XY(INO,3)
	NND(INO)= NOD(INO)
	ENDDO
C     -------------------------------------------------------
C     END OF REGION LOOP, CHECK WHETHER ALL NODES ARE DEFINED
C     -------------------------------------------------------
 280  NFIRST = NLAST+1
      IRE    = IRE+1
 290  IF (IRE.LT.NRE) GOTO 100
      IF (NLAST.LT.NSN) CALL ERRORS (19,0,NLAST,'COORDINATE')


C     -------------------------
C     GLOBAL SUPPORT CONDITIONS
C     -------------------------
	READ (ITI,*)
	READ (ITI,*)

      CALL CLEARI (ID,NSF*NSN)
      
      IF (NBS.EQ.0) GOTO 395
      IF (MODEX.EQ.3) GOTO 500
      WRITE (ITO,3000) NSF,NBS

      NN  =  0
 300	READ (ITI,*,END=307) NODEA,(IBC(ISF),ISF=1,NSF)
 307	NODEA = IABS(NODEA)
      NODEB = NODEA
	INC = 1

      IF (NODEA.LE.NSN) GOTO 310
      CALL ERRORS (2,NN,NODEA,'SUPPORT C.')
      GOTO 390
 310  IF (NODEB.LE.NSN) GOTO 320
      CALL ERRORS (2,NN,NODEB,'SUPPORT C.')
      GOTO 390
 320  CONTINUE
C
      IF (INC.LE.0)  INC = 1
      DO 350  ISN=NODEA,NODEB,INC
      NN = NN+1
      DO 350  ISF=1,NSF
 350  ID(ISF,ISN) = ID(ISF,ISN) + IBC(ISF)
 390  IF (NN.LT.NBS) GOTO 300

C     -------------------------
C     SKEWED SUPPORT CONDITIONS
C     -------------------------
C 395  IF (NLS.EQ.0) GOTO 500
C	THIS LINE CHANGED BY DE SILVA NOV2003
  395  IF (NLS.EQ.0) GOTO 1036
      WRITE (ITO,4000) NSF,NLS
C
      NN = 0
 400	READ (ITI,*,END=408) NODEA,NSET,(IBC(ISF),ISF=1,NSF)
 408	NODEA = IABS(NODEA)
      NODEB = NODEA
	INC = 1

      IF (NODEA.LE.NSN) GOTO 410
      CALL ERRORS (2,NN,NODEA,'LOCAL SUP.')
      GOTO 490
 410  IF (NODEB.LE.NSN) GOTO 420
      CALL ERRORS (2,NN,NODEB,'LOCAL SUP.')
      GOTO 490
 420  IF (NSET.LE.NLA) GOTO 425
      CALL ERRORS (21,NN,NSET,'LOCAL SUP.')
      GOTO 490
 425  CONTINUE

      IF (INC.LE.0)  INC = 1
      DO 450  ISN=NODEA,NODEB,INC
      NN = NN+1
      DO 460  ISF=1,NSF
	IF ((ID(ISF,ISN).EQ.0).OR.(IDSET(ISN).EQ.NSET)) GOTO 460
      IF (ISF.EQ.NSF .AND. IDOF(NSF).GE.7) GOTO 460
      CALL ERRORS (23,NN,ISN,'LOCAL SUP.')
      GOTO 490
 460  ID(ISF,ISN) = ID(ISF,ISN) + IBC(ISF)
 450  IDSET(ISN) = NSET
 490  IF (NN.LT.NLS) GOTO 400

C
C	ADDED BY DE SILVA NOV2003
C     ---------------------------------------------------
C	SPRING SUPPORT CONDITIONS ADDED BY DE SILVA NOV2003
C     ---------------------------------------------------
1036  CALL CLEARA (SD,6*NSN)
C	Next line added 12Dec03 by NguyenDV DAMPING FACTOR
	CALL CLEARA (DFACS,NSN)
      IF (NSS.EQ.0) GOTO 1392

      NN  =  0
 1300	READ (ITI,*,END=1307) NODEA,DFAC,(SBC(ISF),ISF=1,6),IOPT2  !GiD input
 1307	NODEA = IABS(NODEA)
      NODEB = NODEA
	INC = 1

      IF (NODEA.LE.NSN) GOTO 1310
      CALL ERRORS (2,NN,NODEA,'SUPPORT C.')
      GOTO 1390
 1310 IF (NODEB.LE.NSN) GOTO 1320
      CALL ERRORS (2,NN,NODEB,'SUPPORT C.')
      GOTO 1390
 1320 CONTINUE
C
      IF (INC.LE.0)  INC = 1

      DO 1350  ISN=NODEA,NODEB,INC
		NN = NN+1
		DFACS(ISN) = DFAC
		DO 1350  ISF=1,6
			SD(ISF,ISN) = SD(ISF,ISN) + SBC(ISF)
 1350 CONTINUE

C	ADDED BY SONGSAK FOR BILINEAR BASE ISOLATION NOV2006
	CALL INPSD2(SD2(1,NN),NODEA,IOPT2,1)
	IF(IOPT2.GT.0) THEN
	CALL INPSD2(SD2(1,NN),NODEA,IOPT2,2)
	ENDIF

 1390 IF (NN.LT.NSS) GOTO 1300
      
C	-----------------------------------------
C     SOIL - PILE INTERACTION
C	-----------------------------------------
1392  IF (ISOLOP.EQ.1) CALL READSOILDATA ("READ",0,0,0,0,0,0)
      
C	-----------------------------------------
C	SKIWED SPRING SUPPORT BOUNDARY CONDITIONS (Local!)
C	-----------------------------------------
 1395 IF (NLSS.EQ.0) GOTO 2036

      NN = 0
 1400	READ (ITI,*,END=1408) NODEA,NSET,(SBC(ISF),ISF=1,6),IOPT2  !GiD input
 1408	NODEA = IABS(NODEA)
      NODEB = NODEA
	INC = 1

      IF (NODEA.LE.NSN) GOTO 1410
      CALL ERRORS (2,NN,NODEA,'LOCAL SUP.')
      GOTO 1490
 1410 IF (NODEB.LE.NSN) GOTO 1420
      CALL ERRORS (2,NN,NODEB,'LOCAL SUP.')
      GOTO 1490
 1420 IF (NSET.LE.NLA) GOTO 1425
      CALL ERRORS (21,NN,NSET,'LOCAL SUP.')
      GOTO 1490
 1425 CONTINUE

C	CHANGE THE SBC MATRIX FROM LOCAL TO GLOBAL
C	----------------------
C	SET THE LOCAL VECTORS
	DO I = 1,3
	VR(I) = DIRCOS(I,NSET)
	VS(I) = DIRCOS(I+3,NSET)
	VT(I) = DIRCOS(I+6,NSET)
	END DO
	CALL TT1B (VR,VS,VT,TT1)
	SBC = MATMUL(TT1,SBC)

      IF (INC.LE.0)  INC = 1
      DO 1460  ISN=NODEA,NODEB,INC
      NN = NN+1
      DO 1460  ISF=1,6
 1460 SD(ISF,ISN) = SD(ISF,ISN) + SBC(ISF)

C	ADDED BY SONGSAK FOR BILINEAR BASE ISOLATION NOV2006
	CALL INPSD2(SD2(1,NN+NSS),NODEA,IOPT2,1)
	IF(IOPT2.GT.0) THEN
	CALL INPSD2(SD2(1,NN+NSS),NODEA,IOPT2,2)
	ENDIF

 1490 IF (NN.LT.NLSS) GOTO 1400

C	----------------------------------------
C	GLOBAL JOINT CONSTRAINT SONGSAK JAN2007
C	----------------------------------------
2036  IF(LC107.EQ.0) GOTO 500

	NCJX = 0
	READ(ITI,*)
3002	NCJX = NCJX + 1
	READ(ITI,*) LCON1(1:11,NCJX)
	LCJX = LCON1(2,NCJX)
	READ(ITI,*) LCON2(1:LCJX,NCJX) 

	IF (NCJX.LT.LC107) GOTO 3002
C     ----------------------------------------
C     PRINT COORDINATES AND SUPPORT CONDITIONS
C     ----------------------------------------
 500  WRITE (ISO,5000)
	
	WRITE(112,*) 'NUMBER OF NODE'    !ADDED BY SONGSAK MAR2006 3D
	WRITE(112,6300) NSN              !ADDED BY SONGSAK MAR2006 3D
	WRITE(112,*) 'NODAL COORDINATES' !ADDED BY SONGSAK MAR2006 3D

      CALL CLEARA (XYZ,3)
      DO 510  I=1,9                    !CHANGED BY SACHARUCK MAR2007 (SONGSAK IMPLEMENTOR) FROM 7 TO 9 DOFS
 510  IBC(I) = 1
      DO 590  ISN=1,NSN
      DO 550  ISC=1,NSC
 550  XYZ(ISC) = XY(ISN,ISC)
      DO 560  ISF=1,NSF
      IPO = IDOF(ISF)
 560  IBC(IPO) = ID(ISF,ISN)
      IF (NLS.EQ.0) GOTO 580
      NSET = IDSET(ISN)
      IF (NSET.EQ.0) GOTO 580
      WRITE (ISO,5200) ISN,XYZ,NSET,IBC
	WRITE (112,5100) ISN,XYZ         !ADDED BY SONGSAK MAR2006 3D
      GOTO 590
 580  WRITE (ISO,5100) ISN,XYZ,IBC
	WRITE (112,5100) ISN,XYZ         !ADDED BY SONGSAK MAR2006 3D
 590  CONTINUE

      DO ISN = 1,NSN 
      IDLC = IDSET(ISN)
      DO ISF = 1,NSF
      IF(IDLC.EQ.0) ID(ISF,ISN) = ID(ISF,ISN) + IDOFB(ISF) 
      IF(IDLC.NE.0.AND.ISF.GT.6) ID(ISF,ISN) = ID(ISF,ISN) + IDOFB(ISF) 
      ENDDO  
      ENDDO
      
C
      RETURN
C
 1000 FORMAT (1X,'READ REGION CODE FOR GENERATION OF STRUCTURE',
	1		1X,'COORDINATES; FOR REGION',I5)
 1100 FORMAT (1X,'READ ',I1,' COORDINATES FOR EACH',I3,' REGION NODES',
	1		13X,'; FOR REGION',I5)
 1200 FORMAT (1X,'READ NUMBER OF DIVISIONS IN ',I2,' DIRECTIONS',
	1		15X,'; FOR REGION',I5)
 1500 FORMAT (26X,28H* INADMISSIBLE REGION CODE *//
     1        1X,20HPOSSIBLE OPTIONS ARE/
     2        1X,50HINDIVIDUAL NODES  . . . . . . . . ICODE = -1/1    /
     3        1X,50HSTRAIGHT LINE . . . . . . . . . . ICODE = -2/2    /
     4        1X,50HPARABOLIC/CIRCULAR LINE . . . . . ICODE = -3/3    /
     5        1X,50H2-D STRAIGHT SIDED QUADRILATERAL  ICODE = -4/4    /
     6        1X,50H2-D PARABOLIC QUADRILATERAL . . . ICODE = -5 TO -8/
     7        1X,50H2-D CIRCULAR IN 1 DIRECTION . . . ICODE =  6      /
     8        1X,50H2-D CIRCULAR IN 2 DIRECTIONS  . . ICODE =  9      /
     9        1X,50H3-D STRAIGHT SIDED HEXAHEDRON . . ICODE =  8      /
     1        1X,50H3-D PARABOLIC HEXAHEDRON  . . . . ICODE = -9 TO-21/
     2        1X,50H3-D CIRCULAR IN 1 DIRECTION . . . ICODE = 12      /
     3        1X,50H3-D CIRCULAR IN 2 DIRECTIONS  . . ICODE = 18      )
 2000 FORMAT (1X'READ NUMBER OF INDIVIDUAL NODES')
 2100 FORMAT (I6/I6/(3E20.10))
 3000 FORMAT (1X,'READ GLOBAL SUPPORT CONDITIONS; ',I1,1X,6HDOF'S,,I5,
	1		1X,'SUPPORTS')
 4000 FORMAT (1X,'READ LOCAL  SUPPORT CONDITIONS; ',I1,1X,6HDOF'S,,I5,
	1		1X,'SUPPORTS')
C	===================================================
C	CHANGED BY SACHARUCK MAR2007 (SONGSAK IMPLEMENTOR)
 5000 FORMAT (//,28X,23(1H*)/28X,1H*,21X,1H*/
     1        28X,23H*  NODAL COORDINATES  */
     2        28X,23H* SUPPORT  CONDITIONS */
     3        28X,1H*,21X,1H*/28X,23(1H*)//
     4        5H NODE,2X,12HX-COORDINATE,2X,12HY-COORDINATE,2X
     5        ,12HZ-COORDINATE,3X,6HSET NO,5X,
     6         34HDX  DY  DZ  RX  RY  RZ  Wp  T.  P./1X,94(1H-))
 5100 FORMAT (I5,3E14.5,12X,9I4)
 5200 FORMAT (I5,3E14.5,8H  LOCAL ,I2,2X,9I4)
C	===================================================
 6000 FORMAT (1X,'READ DIRECTION COSINES OF',I5,' LOCAL AXES SETS')
 6100 FORMAT (//30X,19(1H*)/,30X,1H*,17X,1H*,/
     1        30X,19H* LOCAL AXES SETS */,30X,1H*,17X,1H*/30X,19(1H*)//
     2        34X,12HLOCAL  1-2-3,/34X,12HGLOBAL X-Y-Z,//
     3        1X,6HSET NO,4X,3H1-X,5X,3H1-Y,5X,3H1-Z,5X,3H2-X,5X,3H2-Y
     4        ,5X,3H2-Z,5X,3H3-X,5X,3H3-Y,5X,3H3-Z,/,1X,79(1H-)/)
 6200 FORMAT (I5,3X,9F8.4)
 6300 FORMAT (X,I8)
C
      END
C
C=====================================================================

      SUBROUTINE ELEMIN (LEST)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	SUNIL 01/05/09 COMPLETELY MODIFIED
C     -----------------------------------------------------------------
C     SETS UP ELEMENT GROUP LOOP ALLS ROUTINES TO READ AND GENERATE 
C	ELEMENT INPUT DATA WRITES ELEMENT INFORMATION ONTO TAPE NELEM
C	-----------------------------------------------------------------
C     VARIABLES IN ARGUMENT LIST
C	--------------------------
C     LEST(2*NEG) = LENGTHS OF ELEMENT GROUP INFORMATION (ARRAY A & IA)
C	--------------------------------
C     VARIABLES IN COMMON BLOCK /ELEM/
C	--------------------------------
C     NAME(2) = NAME OF ELEMENT MODULE
C     ITYPE   = ELEMENT CODE NUMBER
C     ISTYP   = ELEMENT SUBTYPE
C     LINKF   = LINK BETWEEN LOCAL AND GLOBAL DOF AT NODES
C     NLOPT   = NONLINEAR OPTION (0=LINEAR,1=MATERIAL NONLINEAR ONLY,
C                                 2=TOTAL LAGRANGIAN,3=UPDATED LAGR.)
C     MTMOD   = CODE FOR MATERIAL MODULE
C     NSINC   = NUMBER OF SUBINCREMENTS
C     ITOLEY  = TOLERANCE ON EXCESSIVE YIELD FUNCTION
C     NELE    = NUMBER OF ELEMENTS IN GROUP
C     NMPS    = NUMBER OF MATERIAL PROPERTY SETS
C     NGPS    = NUMBER OF GEOMETRIC PROPERTY SETS
C     NMP     = NUMBER OF MATERIAL PROPERTIES
C     NGP     = NUMBER OF GEOMETRIC PROPERTIES
C     NNM     = MAXIMUM NUMBER OF NODES FOR ANY ONE ELEMENT
C     NEX     = NUMBER OF EXCESS NODES
C     NCO     = NUMBER OF NODAL COORDINATES
C     NNF     = NUMBER OF NODAL DEGREES OF FREEDOM
C     NEF     = NUMBER OF ELEMENT DEGREES OF FREEDOM
C     NWG     = NUMBER OF STORAGE LOCATIONS AT GAUSS POINTS
C     NPT     = NUMBER OF GAUSS POINTS FOR ELEMENT
C     NWA     = SIZE OF WORKING ARRAY STORING STRESSES (STRAINS,FLAG)
C     NWS     = SIZE OF ELEMENT STIFFNESS MATRIX (UPPER TRIANG.)
C     IEL     = CURRENT ELEMENT NUMBER
C     NNO     = CURRENT NUMBER OF ELEMENT NODES
C	NELEI   = MAXIMUM LENTH OF ARRAY IA REQUIED FOR ELEMENT GROUP
C	NELEA   = MAXIMUM LENTH OF ARRAY  A REQUIED FOR ELEMENT GROUP
C	NTMPI   = LENTH OF ARRAY IA REQUIED FOR CURRENT ELEMENT GROUP
C	NTMPA   = LENTH OF ARRAY  A REQUIED FOR CURRENT ELEMENT GROUP
C	NMV		= NUMBER OF MATERIAL AXIS FOR CURRENT ELEMENT GROUP
C----------------------------------------------------------------------
	CHARACTER*10 NSNAME(60)
	CHARACTER*10 NAME1(2)
C
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT

      COMMON /LOCA/ LID,LDS,LEL,LDC,LXY,LCH,LNU,LMP,LGP,LMS,LGS,
     1              LCO,LEX,LLM,LES,LEC,LED,LEI,LEE,LMA,LLF,LLV,
     2              LRE,LDI,LDL,LDT,LDK,LER,LEV,LTT,LWV,LAR,LBR,
     3              LVE,LDD,LRT,LBU,LBC,LVL,LAL,LEF,LDU,LPR,LLO,
	4              LRV,LRT1,LRET,LRET1,LDM,LDPT,LVL1,LMV,LXI,LCM,LCC,
	5			    LCN,LDIM,LFRE,LSFC

C	FOLLOWING COMMON BLOCKS ADDED BY DESILVA OCT2003
      COMMON /LOCO/ LOP,LOS,LSS,LSS2,LSS3,LHG,LHGN
      COMMON /OFFS/ NOPS,NHIGE

	COMMON /GiDEle/ LGID

C
	COMMON /MEMO/ MEMA,MEMI,LASTA,LASTI,NELEA,NELEI
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
      COMMON /BOPT/ IBW1,IPF1,IBW2,IPF2,LCON,MCON,IDPTH,MAXCON,IREDU
      COMMON /ITER/ RHO,RHOP,RHOPREV,RTOL,ETOL,DLMAX,ALP,
	1              NSTEP,NPRIN,NDRAW,
	2			  KONEQ,NIREF,ITOPT,ICONV,NOLIN,KSTEP,
     3              LIMEQ(2),ITEMAX,NUMREF,NUMITE,ITETOT,LIMET

      COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT

C	Next added 26Oct05 by NguyenDV for Dynamic Moving Load
	COMMON /BRIW/ I_PELW,I_NEID,I_PRST
	COMMON /MEMW/ W(6000000),IW(4000000)
	
      COMMON A(7000000),IA(6000000)

C	==================================================================
C	SECURITY CHECK SONGSAK MAR2006
	COMMON /SECUR/ NDMAX,NMMAX
C	==================================================================
C	CONCRETE SHELL COMMON BLOCK BY SONGSAK FEB2006
	COMMON /CONC/ MATLR(50,50),PROPS(50,10),MOPTN,MLAYR,MMATS,
	1			  MNLYR,NPONT
C	==================================================================
C	CONSOLIDATION SACHARUCK DEC2006
	COMMON /CONSO/ NCONSO
C	==================================================================
C	ELEMENT LINK POSITION AND DOF SONGSAK MAR2007
	COMMON /EFLINK/ NFLINK(30,30)
C	=============================================================
C	SMOOTH LINE DIAGRAM FOR 2 NODE BEAM AND FRAME (NUMBER OF STATION POINT)
	COMMON /BF_SMOTH/ NP_SMH
C	=============================================================
C	COMMON BLOCK FOR HEAT SONGSAK MAR2007
	COMMON /SHEAT/ NHAEF,LHEAT1,LHEAT2,LHEAT3,LHEAT4
C	==================================================================
C	COMMON BLOCK FOR TEND SONGSAK APR2009 
	COMMON /TENDON/ NTEND,LTDN
C	==================================================================
      DIMENSION LEST(1)


	DIMENSION NMPROP(30),NGPROP(30),NNODEM(30),NSTRES(30)
      DIMENSION NODMIN(30),NCOORD(30),NGWORK(30),NDFREE(30,30)

      DATA NSTRES /0 ,1 ,0 ,0 ,8 ,4 ,0 ,4 ,8 ,6 ,
	1			 6 ,0 ,0 ,0 ,0 ,0 ,1 ,0 ,0 ,0 ,
     2			 0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 /                !INITIAL STRESS SONGSAK THERMAL LOAD MAR2007

      DATA NMPROP /5 ,5 ,5 ,5 ,5 ,5 ,5 ,8 ,5 ,5 ,
	1			 8 ,5 ,0 ,5 ,8 ,8 ,5 ,5 ,0 ,5 ,
     2			 5 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 /
      DATA NGPROP /2 ,2 ,5 ,3 ,7 ,2 ,2 ,2 ,2 ,2 ,
	1			 2 ,2 ,2 ,2 ,2 ,2 ,2 ,2 ,0 ,2 ,
     2			 2 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 /
      DATA NNODEM /3 ,3 ,3 ,3 ,3 ,9 ,8 ,9 ,9 ,27,
	1			 27,4 ,9 ,27,9 ,27,54,2 ,0 ,9 ,
     2			 27,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 /
      DATA NODMIN /2 ,2 ,2 ,2 ,2 ,4 ,4 ,4 ,4 ,4 ,
	1			 4 ,4 ,4 ,4 ,4 ,4 ,2 ,2 ,0 ,4 ,
     2			 4 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 /
      DATA NCOORD /2 ,3 ,3 ,2 ,3 ,2 ,3 ,2 ,3 ,3 ,
	1			 3 ,2 ,3 ,3 ,3 ,3 ,3 ,3 ,0 ,3 ,
     2			 3 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 ,0 /
      DATA NSNAME /'   (PLANE ','TRUSS)    ','   (SPACE ','TRUSS)    ',
	1             '       (GR','ID)       ','    (PLANE',' FRAME)   ',
     2             '    (SPACE',' FRAME)   ','  (PLANE M','EMBRANE)  ',
     3             '  (MEMBRAN','E-PLATE)  ','   (PLATE-','BENDING)  ',
     4             '    (SHELL','DOF=6)    ','    (3-D S','OLID)     ',
     5             '    (CONSO','SOLID)    ','    (MEMBR','3DOF)     ',
     6             '  (SEEPAGE ',' 2-D)    ',' (SEEPAGE ',' 3-D)     ',
     7             '    ( HEAT ',' 2-D)    ','   ( HEAT ',' 3-D)     ',
     8             '   (TENDON ',' 3-D)    ','   (ELINK ',' 3-D)     ',
     8             '    (ELEMT ',' N-D)    ','   (ELEMT ',' N-D)     ',
     8             '    (ELEMT ',' N-D)    ','   (ELEMT ',' N-D)     ',
     8             '    (ELEMT ',' N-D)    ','   (ELEMT ',' N-D)     ',
     8             '    (ELEMT ',' N-D)    ','   (ELEMT ',' N-D)     ',
     8             '    (ELEMT ',' 3-D)    ','   (ELEMT ',' N-D)     ',
     8             '    (ELEMT ',' N-D)    ','   (ELEMT ',' N-D)     '/
C	-----------------------------------------------------------------

      MCON   = 1
      NLIND  = 0
      NELTOT = 0
	NELEI  = 0
	NELEA  = 0

C	NUMBER OF PRINTING STATION FOR 2 NODE BEAM&FRAME ELEMENT
	NP_SMH = 3

C	CONSOLIDATION SACHARUCK DEC2006  CALL FOR NONLINEAR ANALYSIS
	IF(NCONSO.EQ.1) NOLIN = 1

      IEGT = 0 !TENDON GROUP NUMBER
C     -------------------------------
C     GROUP LOOP, READ MASTER CONTROL
C     -------------------------------
      DO 900  IEG=1,NEG 

	WRITE (ITO,1000) IEG

	READ (ITI,*)
	READ (ITI,*) ITYPE,ISTYP,NLOPT,MTMOD,NELE,NMPS,NGPS,
     1             NOPS,NHIGE,NMV,NMP,NGP,NNM,NGR,NGS,NGT
      
      CALL CODETYPE (ITYPE,ISTYP,IEG,NEG,'STORE',0)

C     NUMBER OF ELEMENT FACE (NEFC) FOR SHELL (USE IN SHELL WITH NO ROTATION DOF ONATE)
      CALL ELMFACE(ITYPE,ISTYP,NEFC)
      
C	LINK POSITION AND ELEMENT DOF SONGSAK MAR2007
	CALL ECLINK(NFLINK(ITYPE,ISTYP),NDFREE(ITYPE,ISTYP),ITYPE,ISTYP,IDOF,NSF)
	
C	NUMBER OF TENDON ELEMENT 
	IF(ITYPE.EQ.17) THEN
	  IEGT = IEGT + 1
        CALL TENSERH(LEST,NFLINK,NDFREE,A(LXY),IEG,IEGT)
	ENDIF 

C     -------------------------------------------------

C	FOR SECURITY CHECK  MAXIMUM ELEMENT NUMBER SEP2006
	CALL ELMCHEK(ISOLOP,NSN,NEG,ITYPE,ISTYP,NNM,NELE)

C	==================================================================
C	INTIALIZE EAS ARRAY SONGSAK MAR2006
	CALL EASCOM(IEG,1)
C	==================================================================

C     ------------------------------
C     DEFAUTE VALUES AND ERROR CHECK
C     ------------------------------

	IF (NLOPT.LT.0 .OR. NLOPT.GT.3) NLOPT = 0
      IF (NLOPT.GT.1) NLIND = 2

	IF (NLOPT.GE.1.OR.MTMOD.GT.2)   NOLIN = 1             

      IF (NSINC.LE.0) NSINC = 20
      IF (NMPS.LE.0) NMPS = 1
      IF (NGPS.LE.0) NGPS = 1
      IF (NMP .LE.0) NMP  = NMPROP(ITYPE)
      IF (NGP .LE.0) NGP  = NGPROP(ITYPE)
      IF (NNM .LE.0) NNM  = NNODEM(ITYPE)

C     ------------------------------------
C     SET ADDITIONAL NUMBERS IN BLOCK ELEM
C     ------------------------------------
      MAXN  = NNODEM(ITYPE)
      MINN  = NODMIN(ITYPE)

	IF(ITYPE.EQ.9 .AND.NNM.EQ.3)  MINN = 3   !SHELL 3  NODE SONGSAK MAR2007
	IF(ITYPE.EQ.9 .AND.NNM.EQ.9)  MAXN = 9   !SHELL 3  NODE SONGSAK MAR2007
	IF(ITYPE.EQ.13.AND.NNM.EQ.3)  MINN = 3   !HEAT  3  NODE SONGSAK MAR2007
	IF(ITYPE.EQ.14.AND.NNM.EQ.4)  MINN = 4   !HEAT  4  NODE TETRAHEDRA SONGSAK MAR2007
	IF(ITYPE.EQ.15.AND.NNM.EQ.3)  MINN = 3   !HEAT  3  NODE SONGSAK MAR2007
	IF(ITYPE.EQ.16.AND.NNM.EQ.4)  MINN = 4   !HEAT  4  NODE TETRAHEDRA SONGSAK MAR2007
	IF(ITYPE.EQ.10.AND.NNM.EQ.4)  MINN = 4   !SOLID 4  NODE TETRAHEDRA SONGSAK MAR2007
	IF(ITYPE.EQ.10.AND.NNM.EQ.10) MAXN = 10  !SOLID 10 NODE TETRAHEDRA SONGSAK MAR2007

      LINKF = NFLINK(ITYPE,ISTYP)
      NCO   = NCOORD(ITYPE)
      NNF   = NDFREE(ITYPE,ISTYP)
      NEX   = NNM-MINN
      NEF   = NNF*NNM
	NNO   = NNM

C	HEAT ELEMENT FACE
	IF(ITYPE.EQ.15.AND.ISTYP.EQ.3) NHAEF = 6  !4 FOR BOUNDARY AND 2 FOR AREA (MEMBRANE)
	IF(ITYPE.EQ.15.AND.ISTYP.EQ.4) NHAEF = 5  !3 FOR BOUNDARY AND 2 FOR AREA (MEMBRANE) 3 NODE
	IF(ITYPE.EQ.16.AND.ISTYP.EQ.3) NHAEF = 6  !8 NODE BRICK ELEMENT
	IF(ITYPE.EQ.16.AND.ISTYP.EQ.4) NHAEF = 4  !4 NODE TETRAHEDRA ELEMENT

	NAME(1) = 2*ITYPE-1
	NAME(2) = 2*ITYPE

      NAME1(1) = NSNAME(2*ITYPE-1)
      NAME1(2) = NSNAME(2*ITYPE)


C	NEXT LINE INTRODUCE BY SONGSAK MAR2007 TO COMPUTE NPT ACCORDING TO ITYPE
	CALL ELMNPT (ITYPE,ISTYP,NGR,NGS,NGT,NPT)

C	======================================
C	NEXT BLOCK ADD BY SONGSAK FOR RC SHELL
C	======================================
	SELECTCASE(ITYPE)

	CASE(9)
	IF(MTMOD.EQ.5.OR.MTMOD.EQ.6) THEN
	MNLYR = NGT
	NPONT = 40
	ENDIF

	CASE(10)
	IF(ISTYP.EQ.4.AND.MTMOD.EQ.5.OR.MTMOD.EQ.6) THEN
	MNLYR = NGT
	NPONT = 40
	ENDIF

	ENDSELECT
C	======================================

C	ELEMENT STIFFNESS SIZE - UPPER TRIANGULAR
      NWS   = NEF*(NEF+1)/2
	IF(LSYMM.EQ.1) NWS = NWS*2  !FULL MATRIX

      ITOLEY = ITOLEY*ITOLEY
C     --------------------------------------
C     READ MATERIAL AND GEOMETRIC PROPERTIES
C     GENERATE NODAL COORDINATES OF ELEMENTS
C     --------------------------------------
      CALL LOCATI (2)
      
      CALL CLEARI (IA(LLM),NEF*NELE)
      
C     TENDON INTEGER DATA MAR2010
      IF(ITYPE.EQ.17) THEN
        CALL TENDATA(IA(LTDN))
      ENDIF
      
      

C	MATERIAL PROPERTIES FOR RC SHELL ISOLOP=2 EPF
	IF(ITYPE.EQ.9.AND.MTMOD.EQ.6) THEN
      CALL MTPROPE (A(LMP),IA(LMS),NMP,IA(LGID))
	ELSEIF (ITYPE.EQ.10.AND.ISTYP.EQ.4.AND.MTMOD.EQ.6) THEN
	CALL MTPROPE (A(LMP),IA(LMS),NMP,IA(LGID))
	ELSE
C	MATERIAL PROPERTIES FOR RC SHELL ISOLOP=2 PL
	CALL MTPROP (A(LMP),IA(LMS),NMP,IA(LGID))
	ENDIF

C	-------------------------
	READ(ITI,*)
	SELECT CASE (ITYPE)

	CASE (5) !BEAM
	
	! READ GEOMETRIC PROPERTIES
	READ(ITI,*) ISECT
	CALL FRAMSEC (IEG,ISECT,IA(LGS),NGPS)

	CASE DEFAULT

	CALL GEPROP (A(LGP),IA(LGS),NGP)

	END SELECT
C	-------------------------


C	======================================
C	DOING ELEMENT ADDITIONAL INPUT 
C	======================================
	SELECTCASE(ITYPE)

	CASE(5)
	CALL OFPROP (A(LOP),IA(LOS),IA(LGID),NOPS,NELE)
	CALL HINGAS (IA(LHG),IA(LHGN),IA(LGID),NHIGE,NELE)

	CASE(9)
	IF(MTMOD.EQ.2.OR.MTMOD.EQ.5.OR.MTMOD.EQ.6) 
	1CALL AXIS(A(LMV),IA(LXI),NMV,NELE)  !COMPOSITE & RC

	CASE(10)
	IF(ISTYP.EQ.4) THEN !FOR SOLID SHELL
	IF(MTMOD.EQ.2.OR.MTMOD.EQ.5.OR.MTMOD.EQ.6) 
	1CALL AXIS(A(LMV),IA(LXI),NMV,NELE)  !COMPOSITE & RC
	ENDIF
	
	ENDSELECT
C	======================================

C	ELEMENT CONNECTIVITY
      IF(ITYPE.EQ.17) THEN !FOR TENDON MAR2010
      CALL TENDNODE(IA(LLM),IA(LTDN),IA(LGID),IA(LMS),IA(LGS),NEF) 
      ELSE
      CALL INCIDE (IA(LLM),IA(LEX),NEF,MAXN,MINN,NEX)
      ENDIF
     
      IF (ITYPE.EQ.9.AND.ISTYP.EQ.10) THEN
        CALL ELEMLMS(IA(LLM),NELE,NEF,NEFC)
      ENDIF
      
C	BACK UP CONNECTIVITIES TO LCN (CONSTRUCTION STAGE WILL USE THIS)
	CALL MOVEI(IA(LLM),IA(LCN),NEF*NELE)

C     MAKE INDEX MATRIX THAT WILL USE TO SUPPRESS FLYING DOF
      CALL NESUPPRS(IA(LCN),IDOF,NSF,NSN,LINKF,NNF,NEF,NNM,NELE)
      
C     ELEMENT COORDINATES LCO
      CALL CORDIN (A(LXY),IA(LLM),A(LCO),NSN,NEF,MAXN,NCO*NNM)

C     -------------------------------------------------
C     UPDATE COLUMN HEIGHT AND INITIALIZE WORKING ARRAY
C     -------------------------------------------------
	CALL CONECT (IA(LCH),IA(LLM),NSN,NEF,MAXN,NELE)

C	CALCULATE ELEMENT WORKING ARRAY SIZE
	CALL INWOKN (IEG,ITYPE,ISTYP,MTMOD,NPT,NGT,NGPS,ISECT,NWA,NWG)
C	INITIALIZE ELEMENT GROUP WORKING ARRAY
	NSTH = NPT*NSTRES(ITYPE)                    !ADDED HERE FOR STORE INITIAL STRESS OF THERMAL LOAD
	CALL ADIWOK (IEG,NELE,NWA,NSTH,LCS)

C     -----------------------------------------------------------------
C     -----------------------------------------------------------------
C     PRINT ELEMENT INFORMATION
C     -----------------------------------------------------------------
      WRITE (ISO,1100) IEG,NAME1,ITYPE,ISTYP,LINKF,NLOPT,MTMOD,
     1                 NSINC,ITOLEY,NELE

C	======================================
C	NEXT BLOCK ADD BY SONGSAK FOR RC SHELL
C	======================================
	SELECTCASE(ITYPE)

	CASE(9)
	IF(MTMOD.EQ.5.OR.MTMOD.EQ.6) THEN
      WRITE (ISO,1500) NMPS,NGPS,NMV,NMP,NGP,NNM,NGR,NGS,NGT,
     1                 NEX,NCO,NNF,NEF,NWG,NPT,NWS,MNLYR,NPONT
	GO TO 350 
	ENDIF

	CASE(10)
	IF(ISTYP.EQ.4.AND.MTMOD.EQ.5.OR.MTMOD.EQ.6) THEN
      WRITE (ISO,1500) NMPS,NGPS,NMV,NMP,NGP,NNM,NGR,NGS,NGT,
     1                 NEX,NCO,NNF,NEF,NWG,NPT,NWS,MNLYR,NPONT
	GO TO 350 
	ENDIF

	ENDSELECT
C	======================================

      WRITE (ISO,1200) NMPS,NGPS,NMV,NMP,NGP,NNM,NGR,NGS,NGT,
     1                 NEX,NCO,NNF,NEF,NWG,NPT,NWS

350	CONTINUE
C     -----------------------------------------------------------------
C     -----------------------------------------------------------------

C	======================================
C	DOING ELEMENT INITIALIZATION
C	======================================
	SELECTCASE(ITYPE)

	CASE(2)
	IF(ISTYP.EQ.4) CALL INISIGCABL (IEG,IA(LGID))						!CABLE JACKING FORCE
	IF(ISTYP.EQ.6) CALL BONGEN (A(LXY),IA(LLM),A(LGP),IA(LGS),A(LMP))	!BONDLINK ELEMENT

C	SET NOLIN TO BE 1  SO THAT IT WILL ACTIVATE AN ITERATION OPTION IN LINEAR ANALYSIS
	IF(ISOLOP.EQ.1) THEN
	IF(ISTYP.EQ.4.OR.ISTYP.EQ.6.OR.ISTYP.EQ.7) NOLIN = 1
	ENDIF

	CASE(9)
	IF (ISTYP.EQ.10) CALL ESUPFACE(IA(LGID),IA(LLM),IA(LSFC),NEFC,NEF,NELE) !ASSIGN SUPPORT FLAG FOR SHELL WITH NO ROTATION DOF ONATE
	IF (MTMOD.EQ.5 ) CALL INSTAT  (NWA,IA(LMS),IEG)	!SHELL RC
	IF (MTMOD.EQ.6 ) CALL INSTATE (NWA,IA(LMS),IEG)	!SHELL RC

	CASE(10)
	IF (ISTYP.EQ.4.AND.MTMOD.EQ.5) CALL INSTAT  (NWA,IA(LMS),IEG)	!SOLID - SHELL RC
	IF (ISTYP.EQ.4.AND.MTMOD.EQ.6) CALL INSTATE (NWA,IA(LMS),IEG)	!SOLID - SHELL RC

	ENDSELECT
C	======================================


C     -----------------------------------------
C     PRINT ELEMENT CONNECTION TABLES
C     WRITE ELEMENT INFORMATION ONTO TAPE NELEM
C     -----------------------------------------
      CALL ELEOUT (IA(LLM),IA(LMS),IA(LGS),IA(LXI),NEF,MAXN)

	NTMPI = LMA - LNU
	NTMPA = LLF - LMP
	IF (NTMPI .GE. NELEI) NELEI = NTMPI
	IF (NTMPA .GE. NELEA) NELEA = NTMPA

     	LEST(IEG)       = NTMPI
	LEST(NEG + IEG) = NTMPA

      CALL MOVLEV (1)

	NELEMI=10+IEG
	NELEMA=30+IEG
	OPEN (NELEMI,FORM='UNFORMATTED',STATUS='SCRATCH')
	OPEN (NELEMA,FORM='UNFORMATTED',STATUS='SCRATCH')
      WRITE (NELEMI) (IA(NLNU),NLNU=LNU,LNU+(LEST(IEG    )-1))
      WRITE (NELEMA) ( A(NLNU),NLNU=LMP,LMP+(LEST(NEG+IEG)-1))

	CALL ADWBAK(IEG,'BAD')  !BACK UP WORKING ARRAY TO BACK UP FILE -- DEEP 

 900  NELTOT = NELTOT + NELE

C     -----------------------------------------------
C     SET FLAG NOLIN AND DEFAUTES FOR LINEAR ANALYSIS
C     -----------------------------------------------
      NOLIN = NOLIN + NLIND


      RETURN
C
 1000 FORMAT (1X,'READ ELEMENT DATA FOR ELEMENT GROUPS ',I2)
 1100 FORMAT (//28X,24(1H*)/28X,1H*,22X,1H*/
     1        28X,24H* CONTROL  INFORMATION */
     2        28X,20H* FOR ELEMENT GROUP ,I2,2H */28X,2H* ,2A10,2H */
     3        28X,1H*,22X,1H*/28X,24(1H*)//
     4        14X,'CODE NUMBER OF ELEMENT MODULE . . . ITYPE =',I7/
     5        14X,'ELEMENT SUBTYPE . . . . . . . . . . ISTYP =',I7/
     6        14X,'GLOBAL LINK FOR NODAL DOF . . . . . LINKF =',I7/
     6        14X,'NONLINEAR OPTION  . . . . . . . . . NLOPT =',I7/
     7        14X,'CODE FOR MATERIAL MODULE  . . . . . MTMOD =',I7/
     8        14X,'NUMBER OF SUBINCREMENTS . . . . . . NSINC =',I7/ 
     9        14X,'TOLERANCE ON EXCESSIVE YIELD FUNC .ITOLEY =',I7/
     1        14X,'NUMBER OF ELEMENTS FOR THIS GROUP .  NELE =',I7)
 1200 FORMAT (14X,'NUMBER OF MATERIAL PROPERTY SETS. .  NMPS =',I7/
     1        14X,'NUMBER OF GEOMETRIC PROPERTY SETS .  NGPS =',I7/
	2        14X,'NUMBER OF MATERIAL AXES           .   NMV =',I7/
     3        14X,'NUMBER OF MATERIAL PROPERTIES . . .   NMP =',I7/
     4        14X,'NUMBER OF GEOMETRIC PROPERTIES. . .   NGP =',I7/
     5        14X,'MAXIMUM NUM.OF NODES FOR ANY ELEM .   NNM =',I7/
     6        14X,'GAUSS NUMERICAL INT.ORDER IN R. . .   NGR =',I7/
     7        14X,'GAUSS NUMERICAL INT.ORDER IN S. . .   NGS =',I7/
     8        14X,'NUMERICAL INT.ORDER IN T DIRECTION.   NGT =',I7/ 
     9        14X,'NUMBER OF EXCESS NODES  . . . . . .   NEX =',I7/ 
     1        14X,'NUMBER OF NODAL COORDINATES . . . .   NCO =',I7/ 
     2        14X,'NUMBER OF NODAL DEGREES OF FREEDOM.   NNF =',I7/
     3        14X,'NUMBER OF ELEMENT D.O.F.  . . . . .   NEF =',I7/
     4        14X,'STORAGE LOCATIONS AT GAUSS POINTS .   NWG =',I7/
     5        14X,'NUMBER OF GAUSS POINTS FOR ELEMENT.   NPT =',I7/
     7        14X,'SIZE OF ELEMENT STIFFNESS MATRIX. .   NWS =',I7)
C
1500  FORMAT (14X,'NUMBER OF MATERIAL PROPERTY SETS. ....  NMPS =',I7/
     1        14X,'NUMBER OF GEOMETRIC PROPERTY SETS ....  NGPS =',I7/
	2        14X,'NUMBER OF MATERIAL AXES           ....   NMV =',I7/
     3        14X,'NUMBER OF MATERIAL PROPERTIES . . ....   NMP =',I7/
     4        14X,'NUMBER OF GEOMETRIC PROPERTIES. . ....   NGP =',I7/
     5        14X,'MAXIMUM NUM.OF NODES FOR ANY ELEM ....   NNM =',I7/
     6        14X,'GAUSS NUMERICAL INT.ORDER IN R. . ....   NGR =',I7/
     7        14X,'GAUSS NUMERICAL INT.ORDER IN S. . ....   NGS =',I7/
     8        14X,'NUMERICAL INT.ORDER IN T DIRECTION....   NGT =',I7/ 
     9        14X,'NUMBER OF EXCESS NODES  . . . . . ....   NEX =',I7/ 
     1        14X,'NUMBER OF NODAL COORDINATES . . . ....   NCO =',I7/ 
     2        14X,'NUMBER OF NODAL DEGREES OF FREEDOM....   NNF =',I7/
     3        14X,'NUMBER OF ELEMENT D.O.F.  . . . . ....   NEF =',I7/
     4        14X,'STORAGE LOCATIONS AT GAUSS POINTS ....   NWG =',I7/
     5        14X,'NUMBER OF GAUSS POINTS FOR ELEMENT....   NPT =',I7/
     7        14X,'SIZE OF ELEMENT STIFFNESS MATRIX. ....   NWS =',I7/
     8		14X,'NUMBER OF LAYER FOR CONCRETE SHELL.... MNLYR =',I7/
     9		14X,'NUMBER OF STRESS-PLASTIC STRAIN POINT. NPONT =',I7/)

      END

C	=====================================================================
C	=====================================================================	
C	=====================================================================
      SUBROUTINE ELMFACE (ITYPE,ISTYP,NEFC)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     NUMBER OF ELEMENT FACE -- NEFC      
C	---------------------------------------------------------------------

	SELECT CASE(ITYPE)

	CASE(2) !TRUSS

	NEFC = 1

	CASE(5) !FRAME

	NEFC = 1

	CASE(6) !PLANE

	NEFC = 4

	CASE(8) !PLANE CONSO

	NEFC = 4
	
	CASE(9) !SHELL

	NEFC = 4
	
	IF(ISTYP.EQ.10) NEFC = 3 !SHELL 3-NODE ONATE
	
	CASE(10) !SOLID

	NEFC = 6
	
	CASE(11) !SOLID CONSO

	NEFC = 6
	
	CASE(13) !SEEPAGE 2D

	NEFC = 4
	
	CASE(14) !SEEPAGE 3D

	NEFC = 6
	
	CASE(15) !HEAT 2D

	NEFC = 4
	
	CASE(16) !HEAT 3D

	NEFC = 6
	
	CASE(17) !TENDON

	NEFC = 1
	
	CASE(20) !FLUID 2D

	NEFC = 4
	
	CASE(21) !FLUID #D

	NEFC = 6

	END SELECT


	RETURN

	END

C	=====================================================================
C	=====================================================================	
C	=====================================================================
      SUBROUTINE ELMNPT (ITYPE,ISTYP,NGR,NGS,NGT,NPT)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	---------------------------------------------------------------------

	SELECT CASE(ITYPE)

	CASE(2)

	NPT = NGR	

	CASE(5)

	NGR  = NGR + 2  !ADD BOTH ENDS
	NPT  = NGR
	NGRF = NPT

C	------------------------------------------------------------
C	TEST WHETHER THE NUMBEr OOF GAUSS IS ALREADY STORED OR NOT
	ITEST = 0
	CALL INTFILL('%FGF',ITEST ,1,1,0)  
	IF(ITEST.EQ.0)  THEN
	CALL DEFNINT('%FGF',KGRF  ,1,1  )  !ALLOCATE SPACE IF NGRF NEVER EXIST
	CALL INTFILL('%FGF',NGRF  ,1,1,1)  !NUMBER OF FRAME GAUSS POINT STORE HERE TO USE IN CONSTRUCTION AND IN GENFIBER.FOR
	ENDIF
C	------------------------------------------------------------

	CASE(6,8,9,13,15,20)

	NPT = NGR*NGS	

	CASE(10)

	NPT = NGR*NGS*NGT
	IF(ISTYP.EQ.4) NPT = NGR*NGS

	CASE(11,14,16,21)

	NPT = NGR*NGS*NGT

	CASE(17) !TENDON

	NPT = NGR

	END SELECT


	RETURN

	END


C	=====================================================================
C	=====================================================================	
C	=====================================================================
	SUBROUTINE ECLINK (NFLINK,NDFREE,ITYPE,ISTYP,IDOF,NSF)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	---------------------------------------------------------------------
	DIMENSION IDOF(9),KDOF(9)

	SELECT CASE(ITYPE)

	CASE(2)
	NDFREE = 3
	NFLINK = 123
	
	CASE(5)
	NDFREE = 7
	NFLINK = 1234567
	
	CASE(6)
	NDFREE = 2
	NFLINK = 12
	
	CASE(8)
	NDFREE = 3
	NFLINK = 129

	CASE(9)
	NDFREE = 6
	NFLINK = 123456
	IF(ISTYP.EQ.10) THEN !SHELL WITH NO ROTATION
	NDFREE = 3
	NFLINK = 123
	ENDIF
	
	CASE(10)
	NDFREE = 3
	NFLINK = 123		

	CASE(11)
	NDFREE = 4
	NFLINK = 1239

	CASE(13)
	NDFREE = 3
	NFLINK = 129	

	CASE(14)
	NDFREE = 4
	NFLINK = 1239

	CASE(15)
	NDFREE = 3
	NFLINK = 128	

	CASE(16)
	NDFREE = 4
	NFLINK = 1238
	
	CASE(20)
	NDFREE = 3
	NFLINK = 129
	
	CASE(21)
	NDFREE = 4
	NFLINK = 1239
	
	CASE(17)  !FRAME AND SHELL TENDON
	SELECTCASE(ISTYP)
	CASE(1) !ON NODE
	NDFREE = 6
	NFLINK = 123456
	CASE(2) !ON FRAME
	NDFREE = 6
	NFLINK = 123456
	CASE(3) !ON SHELL
	NDFREE = 6
	NFLINK = 123456
	CASE(4) !ON SOLID
	NDFREE = 3
	NFLINK = 123
	ENDSELECT

	END SELECT


	RETURN

	END


C	=====================================================================
C	=====================================================================	
C	=====================================================================

      SUBROUTINE MTPROP (PROPM,MTSET,MMP,IGIDMEM)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     --------------------------------------------------------
C     READ MATERIAL PROPERTIES AND ASSIGN PROPERTY SET NUMBERS 
C	TO EACH ELEMENTS OF THE CURRENT ELEMENT GROUP
C	---------------------------------------------
C     PROPM(NMP,NMPS)  = MATERIAL PROPERTIES
C     MTSET(NELE)      = MATERIAL PROPERTY SET NUMBERS
C     ------------------------------------------------
      LOGICAL PROMPT,ERROR
C
	COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC

      COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
      COMMON /LOGO/ PROMPT,ERROR,ITEST

C	INTRODUCED BY DE SILVA
	COMMON /GAUS/  GLOC(10,10),GWT(10,10),NGR,NGS,NGT

C	RC SHELL COMMON BLOCK BY SONGSAK OCT2005
C	==================================================================
	COMMON /CONC/ MATLR(50,50),PROPS(50,10),MOPTN,MLAYR,MMATS,
	1			  MNLYR,NPONT
C	==================================================================

C      DIMENSION A(3,3),BC(3,3),D(3,3),GG(2,2)
      DIMENSION PROPM(NMP,1),MTSET(1),PROP(NMP),IGIDMEM(nele)

	DIMENSION LSTEEL(200)  !SONGSAK RC-SHELL DEC2006

C     -----------------------------------------------
C     READ MATERIAL PROPERTIES AND SET DEFAUTE VALUES
C     -----------------------------------------------
      
      IF (PROMPT)  WRITE (ITO,1000)  NMP,NMPS
      IMPS = 0

	LSTEEL = 0  !SONGSAK RC-SHELL DEC2006


C	NEXT IF ADDED BY SONGSAK RC SHELL
	IF (ITYPE.EQ.9.AND.MTMOD.EQ.5) GO TO 500
	IF (ITYPE.EQ.10.AND.ISTYP.EQ.4.AND.MTMOD.EQ.5) GO TO 500

c	read MATERIAL PROPERTIES
	READ (ITI,*)
	
c-----composite
 100  IF (MTMOD.EQ.2) Go to 10
 
      READ (ITI,*,END=10000)  ISET,(PROP(IMP),IMP=1,NMP)

      GO TO 10000

C     INPUT FOT LAMINATE COMPOSITE
10    CALL COMPINP(PROP,ISET,ITI)
      GOTO 200

c 100  READ (ITI,*,END=10000)  ISET,(PROP(IMP),IMP=1,NMP)
10000 IF (ISET.GE.1 .AND. ISET.LE.NMPS)  GOTO 150
      CALL ERRORS (4,IMPS,ISET,'MAT.PROP. ')
      GOTO 190
 110  CALL ERRORS (8,IMPS,ISET,'MAT.PROP. ')
      GOTO 190
 120  CALL ERRORS (9,IMPS,ISET,'MAT.PROP. ')
      GOTO 190
C
 150  IF (PROP(1).LE.0.)  PROP(1) = 210000.
      IF (PROP(2).LT.0.)  PROP(2) = 0.3
C	IF (PROP(2).GE.0.5) PROP(2) = 0.4999 !Suppress By Songsak Mar2006 (use propm(2) as Shear stiffness)
      IF (PROP(3).LE.0.)  PROP(3) = 270.
      IF (PROP(4).LE.0.)  PROP(4) = 0.

C
 200  IF (PROMPT)  WRITE (NDATI,1100)  ISET,(PROP(IMP),IMP=1,NMP)
      DO 180  IMP=1,NMP
 180  PROPM(IMP,ISET) = PROP(IMP)
      IMPS = IMPS+1
 190  IF (IMPS.LT.NMPS)  GOTO 100
C
C     -------------------------
C     PRINT MATERIAL PROPERTIES (changed for composite)
C     -------------------------
	IF (MTMOD.EQ.2) GO TO 293

 289	IF (MTMOD.GE.5.AND.NMP.EQ.17) GOTO 291  !CONCRETE BEAM FIBER
      DO 290  IMPS=1,NMPS
 290  WRITE (ISO,2000)  IMPS,(IMP,PROPM(IMP,IMPS),IMP=1,NMP)
	GOTO 293

  291	DO 292 IMPS=1,NMPS
	M4=NMP-12
	WRITE (ISO,2000) IMPS,(IMP,PROPM(IMP,IMP),IMP=1,M4)	
  292	WRITE (ISO,2005) IMPS,((5+I),PROPM(M4+I,IMPS),I=1,12) 
 	GOTO 293									

C     ---------------------------------------
C     ASSIGN MATERIAL SET NUMBERS TO ELEMENTS
C     ---------------------------------------
 293  IF (PROMPT)  WRITE (ITO,3000)  NMPS,NELE
      IELE = 0
	IELEt = 0

C     NO NEED TO ASSIGN TO TENDON ELEMENT  MAR2010
      IF(ITYPE.EQ.17) GOTO 15000
      
      
C	REIMPLIMENTATION BY DE SILVA 29/3/2004
c	read ASSIGN MATRIAL PROPERTIES TO ELEMENTS ***********************************
	READ (ITI,*)

  300	READ (ITI,*,END=10003)  MEMGID,ISET
      IF (ITYPE.EQ.5) CALL PROPERTIES (PROP,MEMGID,ISET,IMP)
C      IF (ITYPE.EQ.2) CALL 
10003	INC = 1
	IELEt = IELEt+1
	MEMBB = IELEt
	MEMBA = IELEt
	IGIDMEM(IELEt) = MEMGID

      IF (MEMBA.LE.NELE)  GOTO 330
      CALL ERRORS (3,IELE,MEMBA,'MAT.SETS  ')
      GOTO 390
 330  IF (MEMBB.LE.NELE)  GOTO 360
      CALL ERRORS (3,IELE,MEMBB,'MAT.SETS  ')
      GOTO 390
 360  IF (ISET.GE.1 .AND. ISET.LE.NMPS)  GOTO 370
      CALL ERRORS (4,IELE,ISET,'MAT.SETS  ')
      GOTO 390
 370  IF (INC.LE.1)  INC = 1
C
      IF (PROMPT)  WRITE (NDATI,3100)  MEMBA,MEMBB,INC,ISET
      DO 380  IMEM=MEMBA,MEMBB,INC
      MTSET(IMEM) = ISET
 380  IELE = IELE+1
 390  IF (IELE.LT.NELE)  GOTO 300
C

	GO TO 15000

C	=======================================================

C	=======================================================
C	CONCRETE WITH CRACKING
C	PRODUCED BY SONGSAK DEC2004
C	=======================================================
500	CONTINUE

	READ(ITI,*)
	READ(ITI,*)
	READ(ITI,*)	MOPTN,MLAYR,MMATS

	READ(ITI,*)
	DO 520 I = 1,MLAYR
	MATLR(I,1:MNLYR) = 0
	READ(ITI,*) NLAYER,MATLR(I,1:NLAYER)
520	MATLR(I,MNLYR+1) = NLAYER

	READ(ITI,*)
	DO 530 I = 1,MMATS
530	READ(ITI,*) (PROPS(I,J),J=1,10)



	READ(ITI,*)

	DO IELET = 1,NELE
      READ (ITI,*)  MEMGID,IPTRN
	IGIDMEM(IELET) = MEMGID
	MTSET(IELET) = IPTRN
	ENDDO


	WRITE(ISO,4700)

	IF(MOPTN.EQ.1) THEN
	WRITE(ISO,4800)
	ELSEIF(MOPTN.EQ.2) THEN
	WRITE(ISO,4900) 
	ENDIF

	WRITE(ISO,5000) MLAYR,MMATS
	WRITE(ISO,5050)



	DO 561 I = 1,MLAYR
	NLAYER = MATLR(I,MNLYR+1)
	WRITE(ISO,5100)	I,NLAYER
	WRITE(ISO,5200) (J,J=1,NLAYER)
	WRITE(ISO,5201) (MATLR(I,J),J=1,NLAYER)
	NSTEEL = 0
	ZETAZ = 0.0
	DO 570 J = 1,NLAYER
	NMAT  = MATLR(I,J)
	IDTCS = PROPS(NMAT,10)
	IF(IDTCS.EQ.0) THEN
	ZETAZ = PROPS(NMAT,3) + ZETAZ
	ELSE
	NSTEEL = NSTEEL + 1
	PII = 3.141592654

	IF(LSTEEL(NMAT).EQ.0) THEN
	PROPS(NMAT,7) = PROPS(NMAT,7)*PII/180.0
	ENDIF
	LSTEEL(NMAT) = 1

	ENDIF
570	CONTINUE

	WRITE(ISO,5202) ZETAZ,NSTEEL

	IF(ZETAZ.LT.1.98.OR.ZETAZ.GT.2.02) THEN
	WRITE(*,5600) I
	STOP
	ENDIF

561	CONTINUE

	WRITE(ISO,5300) 
	DO 580 I = 1,MMATS
	IF(PROPS(I,10).EQ.1) GO TO 575
	WRITE(ISO,5400) I,(PROPS(I,J),J=1,9)
	GO TO 580
575	WRITE(ISO,5500) I,(PROPS(I,J),J=1,9)
580	CONTINUE

C	=======================================================
C	OUTPUT FORMAT FOR REINFORCED CONCRETE
C	=======================================================


4700	FORMAT(//28X,24(1H*)/28X,1H*,22X,1H*/
     1        28X,24H* REINFORCED CONCRETE  */
     2        28X,24H* MATERIAL INFORMATION */
	3		28X,1H*,22X,1H*/
     3        28X,24(1H*)/,
	3		/30X,'* PLASTICITY MODEL *'/)

4800	FORMAT(//14X,
	1'PLASTICITY MODEL USE IN ANALYSIS...= PERFECT PLASTICITY MODEL'
     2,A40/)
4900	FORMAT(//14X,
	1'PLASTICITY MODEL USE IN ANALYSIS...= STRAIN HARDENING MODEL'
     2,A40/)

5000 	FORMAT(14X,'NUMBER OF LAYERED PATTERN....MLAYR =',I5/,
	1	   14X,'NUMBER OF MATERIAL TYPE......MMATS =',I5/)

5050	FORMAT(14X,'MATERIAL IDENTIFICATION OF EACH LAYER PATERN
	1. . .MATLR(MLAYR,MNLYR)'/)
C5100	FORMAT(/14X,'PATTERN NO.     =',I5,4X/,
C     1	   14X,'NUMBER OF LAYER =',I5/,
C     2	   14X,'PATERN LAYOUT')
C5200	FORMAT(10X,100I5)
5100	FORMAT(//14X,'PATTERN NO.     =',I5,4X/,
     1	   14X,'NUMBER OF LAYER =',I5/)
5200	FORMAT(14X,'LAYER  NUMBER',2X,100I4/)
5201	FORMAT(14X,'PATERN LAYOUT',2X,100I4)
5202	FORMAT(14X,'TOTAL ZETA(2)',2X,F9.4,5X,
	1	   'NUMBER OF STEEL LAYER =',I5)
5300	FORMAT(//14X,'MATERIAL PROPERTY. . .PROPS(MMATS,10)'/)
5400	FORMAT(14X,'[LAYER TYPE = CONCRETE]'/,
     1	   14X,'MATERIAL NUMBER. . . . . . . . . . . .=',I4,/
	1	   14X,'YOUNG MODULUS. . . . . . . . . . . . .=',E15.6,/
	2	   14X,'POISSON RATIO. . . . . . . . . . . . .=',F10.5,/
	3	   14X,'LAYER THICKNESS. . . . . . . . . . . .=',F10.5,/
	4	   14X,'DENSITY. . . . . . . . . . . . . . . .=',F10.5,/
	5	   14X,'ULTIMATE TENSILE STRENGTH. . . . . . .=',E15.6,/
	6	   14X,'ULTIMATE COMPRESSION STRENGTH. . . . .=',E15.6,/
	7	   14X,'ULTIMATE COMPRESSIVE STRAIN. . . . . .=',F10.5,/
	8	   14X,'TENSION STIFFENING PARAMETER(Em) . . .=',F10.5,/
	9	   14X,'TENSION STIFFENING PARAMETER(Alpha). .=',F10.5/)
 
5500	FORMAT(14X,'[LAYER TYPE = STEEL]'/,
	1	   14X,'MATERIAL NUMBER. . . . . . . . . . . .=',I4,/
	1	   14X,'YOUNG MODULUS. . . . . . . . . . . . .=',E15.6,/
	2	   14X,'ELASTO PLASTIC YOUNG MODULUS . . . . .=',E15.6,/
	3	   14X,'LAYER THICKNESS. . . . . . . . . . . .=',F10.5,/
	4	   14X,'DENSITY. . . . . . . . . . . . . . . .=',F10.5,/
	5	   14X,'YIELD STRENGTH OF STEEL. . . . . . . .=',E15.6,/
	6	   14X,'DISTANCE OF CENTROID TO MID SURFACE  .=',F10.5,/
	7	   14X,'ANGLE (STEEL - LOCAL X AXIS) (RAD) . .=',F10.5,/
	8	   14X,'CURRENT NOT USED . . . . . . . . . . .=',F10.5,/
	9	   14X,'CURRENT NOT USED . . . . . . . . . . .=',F10.5/)

5600	FORMAT(//12X,'*SUM OF LAYER',I3,' IS NOT EQUAL TO THICKNESS*'//)
C	=======================================================
C	END OF OUTPUT FORMAT FOR REINFORCED CONCRETE
C	=======================================================



 1000 FORMAT (//18X,24HINPUT OF MATERIAL PROP.(,I2,15H) FOR ANY SET (,I2
     2,          1H)/18X,44(1H-)/20H SET-NUM  PROPERTIES/1X,19(1H-))
 1100 FORMAT (I4,(6E12.5))
 2000 FORMAT (//21X,35HMATERIAL PROPERTIES FOR SET NUMBER ,I2/
     1         21X,37(1H-)//
     2         6H PROP(,I2,32H)  YOUNG'S MODULUS . . . .  YM =,E14.6/
     3           6H PROP(,I2,32H)  POISSON'S RATIO . . . .  PR =,E14.6/
     4             6H PROP(,I2,32H)  YIELD STRESS  . . . . . YLD =,E14.6
     5/              6H PROP(,I2,32H)  STRAIN HARDENING MODULE  HP =,E14
     6.6/             (6H PROP(,I2,32H)  . . . . . . . . . . . . . . =,E
     614.6/))
C***+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
 2005	FORMAT (///21X,35HMATERIAL PROPERTIES FOR SET NUMBER ,I2//
     1         21X,37(1H-)/21X,33HMATERIAL PROPERTIES FOR CONCRETE /
     1         21X,37(1H-)//
     2  6H PROP(,I2,36H) POISSON'S RATIO . . . . . . . PR =,E14.6/
     3  6H PROP(,I2,36H) YIELD STRENGTH OF HOOP. . . . FHY=,E14.6/ 
     4  6H PROP(,I2,36H) COMPRESSIVE STRENGTH . . . . .FC =,E14.6/          
     5  6H PROP(,I2,36H) DIAMETER OF HOOP. . . . . . . DS =,E14.6/    
     6  6H PROP(,I2,36H) LONGITUDINAL SPACE OF HOOPS . SH =,E14.6/  
     7  6H PROP(,I2,36H) CONCRETE MODULUS . . . . . . .YMC=,E14.6/
	8//21X,38HMATERIAL PROPERTIES FOR REINFORCEMENT /
     9         21X,37(1H-)//
     2  6H PROP(,I2,36H)  YOUNG'S MODULUS . . . . . . YMS =,E14.6/
     3  6H PROP(,I2,36H)  POISSON'S RATIO . . . . . . PRS =,E14.6/
     4  6H PROP(,I2,36H)  YIELD STRESS . . . . . . . YLDS =,E14.6/
     5  6H PROP(,I2,36H)  STRAIN-HARDENING STRAIN . . SHS =,E14.6/ 
     6  6H PROP(,I2,36H)  ULTIMATE STRAIN . . . . . . UTE =,E14.6/
     7  6H PROP(,I2,36H)  ULTIMATE STRESS . . . . .. .UTS =,E14.6/)
 2010 FORMAT (//21X,35HMATERIAL PROPERTIES FOR SET NUMBER ,I2/
     1         21X,37(1H-)//
     1  ,10X,'LAMINATE LONGITUDUNAL MODULUS     (0)       E11  =',E15.7/
     1  ,10X,'LAMINATE TRANSVERSE MODULUS       (90)      E22  =',E15.7/
     1  ,10x,'LAMINATE TRANSVERSE MODULUS                 E33  =',E15.7/
     1  ,10X,'POISSON RATIO  12                          MU12  =',F10.5/
     1  ,10x,'POISSON RATIO  23                          MU23  =',F10.5/
     1  ,10X,'POISSON RATIO  31                          MU21  =',F10.5/
     1  ,10x,'SHEAR MODULUS                               G12  =',E15.7/
     1  ,10X,'SHEAR MODULUS                               G13  =',E15.7/
     1 ,10X,'SHEAR MODULUS                               G23  =',E15.7/)

 3000 FORMAT (//16X,22HASSIGN MATERIAL SETS (,I2,15H) TO ELEMENTS (
     1         ,I3,1H)/16X,43(1H-)//21H ELEMA ELEMB INC ISET/1X,20(1H-))
 3100 FORMAT (4I5)
C
15000	CONTINUE

      RETURN
      END
C
C	=====================================================================
C	=====================================================================
      SUBROUTINE INCIDE (LM,NODEX,MEF,MAXN,MINN,MEX)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	SUNIL 01/05/10 COMPLETELY MODIFIED
C     ----------------------------------------------------------
C     READ AND GENERATE ELEMENT INCIDENCES (IN THREE DIMENSIONS)
C	OF EACH ELEMENTS OF THE CURRENT ELEMENT GROUP
C	----------------------------------------------------------
C     LM(NEF,NELE)    = ELEMENT COONECTIONS (NODAL INCIDENCES)
C     NODEX(NEX,NELE) = LOCATIONS OF EXCESSIVE NODES (NEX)
C     ----------------------------------------------------------
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
C	----------------------------------------------------------
C
      COMMON /CONNE/ INCINEW(4,5000) !TO SAVE THE CONNECTIVITY INTO INCINEW MATRIX BY BJ            
      DIMENSION LM(MEF,1),NODEX(MEX,1),INCI(200)
      DIMENSION LOCEX(13)
      

C
      NUMEL    = 0
      IELEMENT = 1
      
      READ(ITI,*) 
C     ------------------------------------------------------
C     READ INCIDENCES FOR FIRST ELEMENT AND CHECK FOR ERRORS
C     ------------------------------------------------------
100   NUMEL = NUMEL + 1
      CALL CLEARI (INCI,200)
      ! INCI = CONNECTIVITY OF FRAME
      READ(ITI,*) IANUR,(INCI(II),II=1,NNM)
      CALL STORENODE (IANUR,IELEMENT,INCI)
      IELEMENT = IELEMENT + 1
      
C     SAVE CONNECTIVITY INTO LMNEW MATRIX
      !INCINEW(1:NNM,IANUR) = INCI(1:NNM)      
       INCINEW(1:NNM,NUMEL) = INCI(1:NNM)  
      
	IF(MAXN.GT.NNM) THEN
	    DO II = NNM+1,MAXN
      	    INCI(II) = 0
	    END DO
	END IF

C     --------------------------------
C     SET POSITIONS OF EXCESSIVE NODES
C     --------------------------------
      CALL CLEARI (LOCEX,13)
      MINN1 = MINN+1
      IPOS  = 0
      DO 490  II=MINN1,MAXN
          IF (INCI(II).LE.0)  GOTO 490
          IPOS = IPOS+1
          LOCEX(IPOS) = II
 490  CONTINUE
 
C     -----------------------
C     GENERATE CONNECTIVITIES
C     -----------------------

      IF (NEX.LE.0)  GOTO 560
      DO 550  IEX=1,NEX
 550  NODEX(IEX,NUMEL) = LOCEX(IEX)
 
 560  DO INM=1,NNM
 	LM(INM,NUMEL) = INCI(INM)
      ENDDO
      
 900  IF (NUMEL.LT.NELE)  GOTO 100

	RETURN
C
      END
C
C=====================================================================
      SUBROUTINE LOADIN (LEST)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -----------------------------------------------------------------
C     CALLS ROUTINES TO READ AND GENERATE LOADING INPUT DATA
C     CALLS ROUTINES TO ASSEMBLE EQUIVALENT NODAL LOADS (MODEX>1)
C	-----------------------------------------------------------------
C     LEST(2*NEG) = LENGTHS OF ELEMENT BLOCK INFORMATION (ARRAY A & IA)
C
C	LTITLE	= TITLE OF THE LOAD CASES (80 CHARACTERS)
C	NNLOG	= NUMBER OF CONCENTRATED NODAL LOADS
C	NLEG	= NUMBER OF LOADED ELEMENT GROUPS
C	IEG		= LOADED ELEMENT GROUP NUMBER
C	NTLO	= NUMBER OF TRACTION LOADS FOR ELEMENT GROUP IEG
C	NPLO	= NUMBER OF PRESSURE LOADS FOR ELEMENT GROUP IEG
C	NELO	= NUMBER OF NORM/TANG EDGE LOADS FOR ELEMENT GROUP IEG
C	VELO	= VEHICLE LOAD
C     -----------------------------------------------------------------
	CHARACTER*80 TITLE
C
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT

      COMMON /LOCA/ LID,LDS,LEL,LDC,LXY,LCH,LNU,LMP,LGP,LMS,LGS,
     1              LCO,LEX,LLM,LES,LEC,LED,LEI,LEE,LMA,LLF,LLV,
     2              LRE,LDI,LDL,LDT,LDK,LER,LEV,LTT,LWV,LAR,LBR,
     3              LVE,LDD,LRT,LBU,LBC,LVL,LAL,LEF,LDU,LPR,LLO,
	4              LRV,LRT1,LRET,LRET1,LDM,LDPT,LVL1,LMV,LXI,LCM,LCC,
	5			    LCN,LDIM,LFRE,LSFC

      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
	COMMON /EIGN/ NSEIG,NROOT,NC,NNC,NITEM,IFSS,SHIFT0,EPS,IEIG,NEIG,
     +              ISOLV,IVPRT
      COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
      COMMON /SOLU/ NEQ,NEQ1,NBLOCK,MK,BM,NWK,NWM,ISTOR,NFAC,
     +              NRED,KPOSD,DETK,DET1,DAVR,STOL
      COMMON /ITER/ RHO,RHOP,RHOPREV,RTOL,ETOL,DLMAX,ALP,
	1              NSTEP,NPRIN,NDRAW,
	2			  KONEQ,NIREF,ITOPT,ICONV,NOLIN,KSTEP,
     3              LIMEQ(2),ITEMAX,NUMREF,NUMITE,ITETOT,LIMET

	COMMON /MEMO/ MEMA,MEMI,LASTA,LASTI,NELEA,NELEI
	! ----- COMMON FOR OFFSHORE ------
	COMMON /WARNING/ WARNING,RAMDA(100),RK
	COMMON /OFFSHOREOUT/ UXMAX,UYMAX,NSTREAMFUNCTION,NFUNCTION
	! --------------------------------
	
	COMMON /LINEAT/ KTRAF,KEATH,KCSAL,KOFFL,KSPEC,KDESIGN,KFATM,KFATJ,KFATL,KFAST,KOREV !SONGSAK AUG2007 RESPONSE SPECTRUM FOR ISOLOP 1 !SONGSAK AUG2007 RESPONSE SPECTRUM FOR ISOLOP 1
C	==================================================================
C	COMMON BLOCK FOR HEAT SONGSAK MAR2007
	COMMON /SHEAT/ NHAEF,LHEAT1,LHEAT2,LHEAT3,LHEAT4
C	==================================================================
C	COMMON BLOCK FOR TEND SONGSAK APR2009 
	COMMON /TENDON/ NTEND,LTDN
C	==================================================================

	COMMON /LCSS/ ILCN,ILCC

	COMMON /GiDEle/ LGID ! added by de silva 2004/6/28
      COMMON /LOCO/ LOP,LOS,LSS,LSS2,LSS3,LHG,LHGN

      COMMON A(7000000),IA(6000000)

      DIMENSION LEST(1)

	DIMENSION MFRMLD(20) !ADDED HERE FOR NEW LOAD SONGSAK MAY2007
      
      DIMENSION NUMCASE(1000),NFASTPARA(1000)
      
      
C     ----------------------------------
C     CONTROL VARIABLES FOR LOADING DATA
C     ----------------------------------
90	CALL CLEARA (A(LLV),LCS*NEQ)		!VARY LOAD
	CALL CLEARA (A(LLO),LCS*NEQ)		!CONT LOAD
      WRITE (ITO,1000)
     
      
C     FAST CONDITION      
      IF (KFAST.EQ.2)THEN
      READ (ITI,*) 
      READ (ITI,*) NODEFAST
      READ (ITI,*)
      READ (ITI,*) NTFASTPARA
          DO I = 1,NTFASTPARA
          READ (ITI,*) NUMCASE(I),NFASTPARA(I)
          ENDDO
      ENDIF
      
	READ (ITI,*)
	READ (ITI,1100,END=100) TITLE
100	READ (ITI,*) NNLO,NLEG,NSTTM,NEGLO ! ,NODSPEC

C      IF (NODSPEC.NE.0) CALL NODALSPEC (NODSPEC)

	WRITE (ISO,1300) TITLE,NNLO,NLEG

C     -----------------------------
C     READ AND GENERATE NODAL LOADS
C     -----------------------------
      IF (NNLO.GT.0) CALL NODELO (IA(LID),NSF,NNLO)
      IF (KFAST.EQ.2) CALL FASTTOPFORCE (IA(LID),NSF,NODEFAST,NUMCASE,NFASTPARA,NTFASTPARA,R,NEQ,1,'WRIT')

C	SETTLEMENT SONGSAK JUN2006
	IF (NSTTM.GT.0) CALL INPSET (NSTTM)

C	GLOBAL ELEMENT LOAD SONGSAK JAN2009
	IF (NEGLO.GT.0) CALL ELGLOL (LEST,NEGLO)

C     -----------------
	DO IEG = 1,NEG
	KEG = IEG
	NELEMI = 10 + IEG
      NELEMA = 30 + IEG
      REWIND NELEMI
      REWIND NELEMA
      READ (NELEMI) (IA(NLNU),NLNU=LNU,LNU + LEST(IEG)-1)
      READ (NELEMA) ( A(NLNU),NLNU=LMP,LMP + LEST(IEG+NEG)-1)
      CALL MOVLEV (2)
	IF(ITYPE.EQ.5) CALL SMHZERO                      !INITIALIZE ZERO SMOOTH INTERPOLATION OF BEAM&FRAME SONGSAK FEB2007	
	ENDDO
C     -----------------

C     -------------------------------------------------------
C     READ AND GENERATE ELEMENT LOADS
C     -------------------------------------------------------
      IF (NLEG.EQ.0) GOTO 933 

      KLEG  = 0
200	READ (ITI,*)          !ELEMENT LOAD LOOP START HERE
	READ (ITI,*) IEG
C     -------------------
	KEG = IEG 
C     ----------------------------------------
C     READ ELEMENT INFORMATION FROM TAPE NELEM
C     ----------------------------------------
300	NELEMI = 10 + IEG
      NELEMA = 30 + IEG
      REWIND NELEMI
      REWIND NELEMA
      READ (NELEMI) (IA(NLNU),NLNU=LNU,LNU + LEST(IEG)-1)
      READ (NELEMA) ( A(NLNU),NLNU=LMP,LMP + LEST(IEG+NEG)-1)
      CALL MOVLEV (2)


C     -----------------------------------------------------------
	MFRMLD = 0
	SELECT CASE (ITYPE)

	CASE(2)
	READ (ITI,*) NWLO,NBODY,NTMPLD,NOFFL
	MFRMLD(1:4) = [NWLO,NBODY,NTMPLD,NOFFL]

	CASE(5)
	READ (ITI,*) NWLO,NUBL,NUDP,NUPJ,NPNL,NVVL,NBODY,NTMPLD,NOFFL,NRES,NFAT,NBOFL
	MFRMLD(1:12) = [NWLO,NUBL,NUDP,NUPJ,NPNL,NVVL,NBODY,NTMPLD,NOFFL,NRES,NFAT,NBOFL]

	CASE(6,8)
	READ (ITI,*) NWLO,NPLOE,NHLOE,NBODY,NTMPLD,NGLOE
	MFRMLD(1:6) = [NWLO,NPLOE,NHLOE,NBODY,NTMPLD,NGLOE] 

	CASE(9)

	READ (ITI,*) NWLO,NPLOE,NHLOE,NUGLO,NUPRE,NHYDR,NBODY,NTMPLD,NGLOE,NOFFL,NRES,NBOFL
	MFRMLD(1:12) = [NWLO,NPLOE,NHLOE,NUGLO,
	1			   NUPRE,NHYDR,NBODY,NTMPLD,NGLOE,NOFFL,NRES,NBOFL] 

	CASE(10,11)
	READ (ITI,*) NWLO,NSGLO,NSPLO,NHYDR,NBODY,NTMPLD,NOFFL,NRES,NBOFL
	MFRMLD(1:9) = [NWLO,NSGLO,NSPLO,NHYDR,NBODY,NTMPLD,NOFFL,NRES,NBOFL] 

	CASE(13)
	READ (ITI,*) NHFLX
	MFRMLD(1)   = NHFLX

	CASE(14)
	READ (ITI,*) NHFLX
	MFRMLD(1)   = NHFLX

	CASE(15)
	READ (ITI,*) NHGEN,NHFLX1,NHFLX2,NHCVC1,NHCVC2
	MFRMLD(1:5) = [NHGEN,NHFLX1,NHFLX2,NHCVC1,NHCVC2]

	CASE(16)
	READ (ITI,*) NHGEN,NHFLX,NHCVC
	MFRMLD(1:3) = [NHGEN,NHFLX,NHCVC]

	CASE(17)
	READ (ITI,*) NJACK
	MFRMLD(1)   = NJACK

	ENDSELECT

C     -------------------------------------------------------------------------------

C     ----------------------------------------
C     READ AND GENERATE EQUIVALENT NODAL LOADS
C     ----------------------------------------

C     -------------------------------------------------------
	IF(ITYPE.EQ.2) THEN !ADDED HERE FOR NEW TRUSS&CABLE ELEMENT LOAD SONGSAK MAY2007
C	NWLO,NBODY,NTMPLD

	IF (NWLO.NE.0) THEN
	READ(ITI,*)
	CALL SEFTRS (NWLO,A(LCO),IA(LGS),A(LGP),
	1			 IA(LLM),A(LMP),IA(LMS),IA(LGID)) 
	ENDIF
	IF (NBODY.NE.0) THEN
	READ(ITI,*)
	CALL SEFTRS (NBODY,A(LCO),IA(LGS),A(LGP),
	1			 IA(LLM),A(LMP),IA(LMS),IA(LGID)) 
	ENDIF
	IF (NTMPLD.NE.0) THEN
	READ(ITI,*)
	CALL TEMPLTS(IA(LLM),A(LCO),IA(LGS),A(LGP),IA(LMS),A(LMP),NTMPLD,
	1		     IA(LGID)) 
      ENDIF
      
      IF (NOFFL.NE.0)THEN
      CALL CABLEOFFSHORE (IA(LLM),A(LCO),IA(LGS),A(LGP),IA(LMS),A(LMP),
	1		           IA(LGID),MFRMLD,IA(LHG),IA(LHGN)) 
      ENDIF

	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.5) THEN !ADDED HERE FOR NEW FRAME ELEMENT LOAD SONGSAK MAY2007
C	CALL ITERAT1(W)
	CALL FRAMFOC (IA(LLM),A(LCO),IA(LGS),A(LGP),IA(LMS),A(LMP),
	1		      IA(LGID),MFRMLD,IA(LHG),IA(LHGN)) 

	IF (NTMPLD.NE.0) THEN
	READ(ITI,*)
	CALL TEMPFRM(IA(LLM),A(LCO),IA(LGS),A(LGP),IA(LMS),A(LMP),NTMPLD,
	1		     IA(LGID)) 
	ENDIF
	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.6.OR.ITYPE.EQ.8) THEN !ADDED HERE FOR NEW PLANE ELEMENT LOAD SONGSAK MAY2007

C	NWLO,NPLOE,NHLOE,NBODY,NTMPLD

	IF (NWLO.NE.0) THEN
	READ(ITI,*)
	CALL MEMWTH (NWLO,A(LCO),IA(LGS),A(LGP),IA(LLM),
     1	         A(LMP),IA(LMS),IA(LGID))
	ENDIF

	IF (NPLOE.NE.0) THEN	
	READ(ITI,*)
	CALL MEMPRS (NPLOE,A(LCO),IA(LGS),A(LGP),IA(LLM),
     1	         A(LMP),IA(LMS),IA(LGID))
	ENDIF

	IF (NHLOE.NE.0) THEN	
	READ(ITI,*)
	CALL MEMPRS (NHLOE,A(LCO),IA(LGS),A(LGP),IA(LLM),
     1	         A(LMP),IA(LMS),IA(LGID))
	ENDIF

	IF (NBODY.NE.0) THEN
	READ(ITI,*)
	CALL MEMWTH (NBODY,A(LCO),IA(LGS),A(LGP),IA(LLM),
     1	         A(LMP),IA(LMS),IA(LGID))
	ENDIF

	IF (NTMPLD.NE.0) THEN
	READ(ITI,*)
	CALL TEMPLME(IA(LLM),A(LCO),IA(LGS),A(LGP),IA(LMS),A(LMP),NTMPLD,
	1		     IA(LGID),IA(LEX)) 
	ENDIF

	IF (NGLOE.NE.0) THEN	
	READ(ITI,*)
	CALL MEMTRAC (NGLOE,A(LCO),IA(LGS),A(LGP),IA(LLM),
     1	         A(LMP),IA(LMS),IA(LGID))
	ENDIF

	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.9) THEN !ADDED HERE FOR NEW SHELL ELEMENT LOAD SONGSAK MAY2007

C	NWLO,NPLOE,NHLOE,NUGLO,NUPRE,NHYDR,NBODY,NTMPLD

	IF (NWLO.NE.0) THEN
	READ(ITI,*)
	CALL SEFSHS (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),A(LMP),IA(LMS),
     1             NGP,NCO*NNM,NEX,NEF,IA(LGID),NWLO)
	ENDIF

	IF (NPLOE.NE.0) THEN
	READ(ITI,*)
	CALL SHEPERE (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),
     1              NGP,NCO*NNM,NEX,NEF,NPLOE,IA(LGID))
	ENDIF
	
	IF (NHLOE.NE.0) THEN
	READ(ITI,*)
	CALL SHEPERE (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),
     1              NGP,NCO*NNM,NEX,NEF,NHLOE,IA(LGID))
	ENDIF

	IF (NUGLO.NE.0) THEN
	READ(ITI,*)
	CALL SHEPURE (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),
     1              NGP,NCO*NNM,NEX,NEF,NUGLO,IA(LGID))
	ENDIF

	IF (NUPRE.NE.0) THEN
	READ(ITI,*)
	CALL SHEPSRE (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),
     1              NGP,NCO*NNM,NEX,NEF,NUPRE,IA(LGID))
	ENDIF

	IF (NHYDR.NE.0) THEN
	READ(ITI,*)
	CALL SHEPSRE (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),
     1              NGP,NCO*NNM,NEX,NEF,NHYDR,IA(LGID))
	ENDIF

	IF (NBODY.NE.0) THEN
	READ(ITI,*)
	CALL SEFSHS (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),A(LMP),IA(LMS),
     1             NGP,NCO*NNM,NEX,NEF,IA(LGID),NBODY)
	ENDIF
	
	IF (NTMPLD.NE.0) THEN
	READ(ITI,*)
	CALL TEMPLSH(IA(LLM),A(LCO),IA(LGS),A(LGP),IA(LMS),A(LMP),NTMPLD,
	1		     IA(LGID),IA(LEX)) 
	ENDIF

	IF (NGLOE.NE.0) THEN	
	READ(ITI,*)
	CALL SHETRAC (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),
     1              NGP,NCO*NNM,NEX,NEF,NGLOE,IA(LGID))
	ENDIF

	IF (NOFFL.NE.0) THEN	
	READ(ITI,*)
	CALL SHEOFFL (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),
     1              NGP,NCO*NNM,NEX,NEF,NOFFL,IA(LGID))
	ENDIF
	
	IF (NRES.NE.0)THEN
	READ(ITI,*)
	CALL SHEOFFLSPEC (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),
     1                 NGP,NCO*NNM,NEX,NEF,NRES,IA(LGID))
	ENDIF
C	IF (NSPEC.NE.0)THEN
C	READ(ITI,*)
C	CALL SHEOFFLSPEC (A(LGP),IA(LGS),A(LCO),IA(LEX),IA(LLM),
C     1                 NGP,NCO*NNM,NEX,NEF,NOFFL,IA(LGID))
C      ENDIF
	

	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.10.OR.ITYPE.EQ.11) THEN !ADDED HERE FOR NEW SOLID ELEMENT LOAD SONGSAK MAY2007

C	NWLO,NSGLO,NSPLO,NHYDR,NBODY,NTMPLD

	IF (NWLO.NE.0) THEN
	READ(ITI,*)
	CALL SOLWTH (NWLO,A(LCO),IA(LGS),A(LGP),IA(LLM),
     1	         A(LMP),IA(LMS),IA(LGID))
	ENDIF

	IF (NSGLO.NE.0) THEN
	READ(ITI,*)
	CALL SOLTRAG(NSGLO,A(LCO),IA(LLM),IA(LGID))
	ENDIF
	
	IF (NSPLO.NE.0) THEN
	READ(ITI,*)
	CALL SOLTRAT(NSPLO,A(LCO),IA(LLM),IA(LGID))
	ENDIF

	IF (NHYDR.NE.0) THEN
	READ(ITI,*)
	CALL SOLTRAT(NHYDR,A(LCO),IA(LLM),IA(LGID))
	ENDIF

	IF (NBODY.NE.0) THEN
	READ(ITI,*)
	CALL SOLWTH (NBODY,A(LCO),IA(LGS),A(LGP),IA(LLM),
     1	         A(LMP),IA(LMS),IA(LGID))
	ENDIF
	
	IF (NTMPLD.NE.0) THEN
	READ(ITI,*)
	CALL TEMPLSO(IA(LLM),A(LCO),IA(LGS),A(LGP),IA(LMS),A(LMP),NTMPLD,
	1		     IA(LGID),IA(LEX)) 
	ENDIF

	IF (NOFFL.NE.0) THEN	
	READ(ITI,*)
	CALL SOLOFFL(NOFFL,A(LCO),IA(LLM),IA(LGID))
	ENDIF
	
	IF (NRES.NE.0)THEN
	READ(ITI,*)
	CALL SOLOFFLRES(NRES,A(LCO),IA(LLM),IA(LGID))
      ENDIF

	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.13) THEN !SEEPAGE PLANE ELEMENT LOAD 

C	NHFLX
	IF (NHFLX.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(3,6)
	CALL SEEPLOD2DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			    IA(LGS),IA(LGID),NHFLX,1) 
	CASE(4,8)
	CALL SEEPLOD2D (IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			    IA(LGS),IA(LGID),NHFLX,1) 
	END SELECT
	ENDIF


	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.14) THEN !SEEPAGE SOLID ELEMENT LOAD 

C	NHFLX
	IF (NHFLX.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(4)
	CALL SEEPLOD3DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),IA(LGID),
	1			    NHFLX,1) 
	CASE(8)
	CALL SEEPLOD3D (IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),IA(LGID),
	1			    NHFLX,1) 
	END SELECT
	ENDIF


	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.15) THEN !ADDED HERE FOR NEW HEAT PLANE ELEMENT LOAD SONGSAK MAY2007

C	NHGEN,NHFLX1,NHFLX2,NHCVC1,NHCVC2

	IF (NHGEN.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(3,6)
	CALL HEATLOD2DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHGEN,1) 
	CASE(4,8)
	CALL HEATLOD2D(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHGEN,1) 
	END SELECT
	ENDIF


	IF (NHFLX1.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(3,6)
	CALL HEATLOD2DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHFLX1,2) 
	CASE(4,8)
	CALL HEATLOD2D(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHFLX1,2) 
	END SELECT
	ENDIF


	IF (NHFLX2.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(3,6)
	CALL HEATLOD2DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHFLX2,3) 
	CASE(4,8)
	CALL HEATLOD2D(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHFLX2,3) 
	END SELECT
	ENDIF

	IF (NHCVC1.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(3,6)
	CALL HEATLOD2DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHCVC1,4) 
	CASE(4,8)
	CALL HEATLOD2D(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHCVC1,4) 
	END SELECT
	ENDIF


	IF (NHCVC2.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(3,6)
	CALL HEATLOD2DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHCVC2,5) 
	CASE(4,8)
	CALL HEATLOD2D(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),A(LGP),
	1			   IA(LGS),IA(LGID),A(LHEAT1),A(LHEAT2),A(LHEAT3),
     2			   A(LHEAT4),NHCVC2,5) 
	END SELECT
	ENDIF



	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.16) THEN !ADDED HERE FOR NEW HEAT SOLID ELEMENT LOAD SONGSAK MAY2007

C	NHGEN,NHFLX,NHCVC

	IF (NHGEN.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(4)
	CALL HEATLOD3DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),IA(LGID),
	1			   A(LHEAT1),A(LHEAT2),A(LHEAT3),A(LHEAT4),NHGEN,1) 
	CASE(8)
	CALL HEATLOD3D(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),IA(LGID),
	1			   A(LHEAT1),A(LHEAT2),A(LHEAT3),A(LHEAT4),NHGEN,1) 
	END SELECT
	ENDIF

	IF (NHFLX.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(4)
	CALL HEATLOD3DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),IA(LGID),
	1			   A(LHEAT1),A(LHEAT2),A(LHEAT3),A(LHEAT4),NHFLX,2) 
	CASE(8)
	CALL HEATLOD3D(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),IA(LGID),
	1			   A(LHEAT1),A(LHEAT2),A(LHEAT3),A(LHEAT4),NHFLX,2) 
	END SELECT
	ENDIF

	IF (NHCVC.NE.0) THEN
	READ(ITI,*)
	SELECT CASE(NNM)
	CASE(4)
	CALL HEATLOD3DT(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),IA(LGID),
	1			   A(LHEAT1),A(LHEAT2),A(LHEAT3),A(LHEAT4),NHCVC,3) 
	CASE(8)
	CALL HEATLOD3D(IA(LID),A(LCO),IA(LLM),A(LMP),IA(LMS),IA(LGID),
	1			   A(LHEAT1),A(LHEAT2),A(LHEAT3),A(LHEAT4),NHCVC,3) 
	END SELECT
	ENDIF


	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.17) THEN !JACKING OF TENDON SONGSAK APR2009

	CALL TDJACK (NJACK,IA(LTDN),A(LMP),A(LGP))

	GOTO 900
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
900	CONTINUE
C     -------------------------------------------------------	

C	===========================================================
	REWIND NELEMI  !ADD THIS BLOCK SONGSAK MAR2007 BACKUP ELEMENT LOAD FOR HEAT TRANSFER
      REWIND NELEMA
      WRITE (NELEMI) (IA(NLNU),NLNU=LNU,LNU + LEST(IEG)-1)
      WRITE (NELEMA) ( A(NLNU),NLNU=LMP,LMP + LEST(IEG+NEG)-1)
C	===========================================================

      KLEG = KLEG + 1
      IF (KLEG.LT.NLEG) GOTO 200


933	CONTINUE


 1000 FORMAT (1X,'READ LOADING DATA (HEADER, NUMBER OF NODAL LOADS &'
	1        1X,'LOADED ELEMENT GROUPS)')
 1100 FORMAT (A80)
 1300 FORMAT (///29X,22(1H*)/29X,1H*,20X,1H*/
     +     29X,22H* LOADING INPUT DATA */29X,1H*,20X,1H*/
     +     29X,22(1H*)//1X,A80//
     +     14X,'NUMBER OF CONCENTRATED NODAL LOADS . . . .NNLO =',I3/
     +     14X,'NUMBER OF LOADED ELEMENT GROUPS  . . . . .NLEG =',I3)
 2000 FORMAT (1X,'READ LOADED ELEMENT GROUP',I5,' DATA (GROUP NO,'
	1        1X,'TRAC., PRES. & EDGE LOADS)')
 2100 FORMAT (4I5)

 2200 FORMAT (1H1///
     +10X,'ELEMENT GROUP NUMBER . . . . . . . . . . . . . . . IEG =',I3/
     +10X,'NUMBER OF FULL ELEM UNIFORM BEAM LOADS . . . . . .NUBL =',I3/
     +10X,'NUMBER OF TRACTION/UNIFORM BEAM LOADS  . . . . . .NTLO =',I3/
     +10X,'NUMBER OF NORMAL PRESSURE/PROJECTED BEAM LOAD. . .NPLO =',I3/
     +10X,'NUMBER OF NORM/TANG EDGE LOADS/BEAM POINT LOADS. .NELO =',I3/
     +10X,'NUMBER OF SELF WIEGHT LOADS. . . . . . . . . . . .NWLO =',I3/
     +10X,'NUMBER OF TRMPERATURE LOADS. . . . . . . . . . .NTMPLD =',I3)
C
      RETURN
      END
C	=====================================================================
C	=====================================================================
C	=====================================================================
C	Write here subroutine to find the xfinass element order for the 
C	element numbered from GiD
	SUBROUTINE ELEREODER(IGIDMEM,NELE,MEMBA)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)

	dimension IGIDMEM(NELE)
C	Call MEMGID from IGIDMEM and compare it with MEMBA
	DO  iGiDE = 1,NELE
		MEMGID = IGIDMEM(iGiDE) 
		IF(MEMGID.EQ.MEMBA) then
			MEMBA = iGiDE
			RETURN
		ENDIF
	ENDDO
	
	MEMBA = 0 !RETURN 0 IF CANNOT FIND THE CORRESPONDING ELEMENT

      RETURN
      END
C	=====================================================================
C	=====================================================================
C	=====================================================================
      SUBROUTINE INCRLO (RFAC)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	SUNIL 01/05/11 MODIFIED
C     --------------------------------------------------
C     READS FACTORS RFAC(NLFAC) TO DEFINE LOADING LEVELS
C     --------------------------------------------------
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
      COMMON /ITER/ RHO,RHOP,RHOPREV,RTOL,ETOL,DLMAX,ALP,
	1              NSTEP,NPRIN,NDRAW,
	2			  KONEQ,NIREF,ITOPT,ICONV,NOLIN,KSTEP,
     3              LIMEQ(2),ITEMAX,NUMREF,NUMITE,ITETOT,LIMET

      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     1              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /EIGN/ NSEIG,NROOT,NC,NNC,NITEM,IFSS,SHIFT0,EPS,IEIG,NEIG,
     +              ISOLV,IVPRT
c	COMMON/EIGN/ added Mar26-2003
C	-----------------------------------------------------------------
      DIMENSION RFAC(10)
C
      IF (NSTEP.EQ.0) RETURN
 100  WRITE (ITO,1000) NSTEP

	READ (ITI,*)
	READ (ITI,*) (RFAC(I),I=1,NSTEP)

	DO 300 I=2,NSTEP
 300	IF (RFAC(I).EQ.0.0) RFAC(I)=RFAC(1)*DLMAX

      RETURN

C
 1000 FORMAT (1X,'READ LOAD FACTORS; ',I3)
C
      END
C
C=====================================================================
      SUBROUTINE SOLOPT
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     ---------------------------------------------------------------
C     READS TYPE OF BANDWIDTH OPTIMISATION AND OPTIONS FOR SOLVER
C	-----------------------------------------------------------
C     IREDU   = CODE FOR BANDWIDTH REDUCTION 
C				0 = NO REDUCTION
C				1 = BANDWIDTH OPTIMISATION MORE IMPORTANT
C				2 = PROFILE REDUCTION MORE IMPORTANT
C     MCON    = MAXIMUM NUMBER OF CONNECTED NODES
C     KPOSD   = FLAG TO PERMIT REDUCTION OF NON-POSITIVE DEFINITE [K]
C				0 = NO REDUCTION OF NON-POSITIVE DEFINITE [K]
C				1 = PERMIT REDUCTION OF NON-POSITIVE DEFINITE [K]
C				2 = PERMIT REDUCTION OF INDEFINITE [K]
C     STOL    = TOLERANCE TO DEFINE INDEFINITE STIFFNESS MATRIX
C     ---------------------------------------------------------------
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
      COMMON /BOPT/ IBW1,IPF1,IBW2,IPF2,LCON,MCON,IDPTH,MAXCON,IREDU
      COMMON /SOLU/ NEQ,NEQ1,NBLOCK,MK,BM,NWK,NWM,ISTOR,NFAC,
     +              NRED,KPOSD,DETK,DET1,DAVR,STOL

C     --------------
C     DEFAULT VALUES
C     --------------
100	IF (IREDU.LT.0 .OR. IREDU.GT.2) IREDU = 0
      IF (MAXCON.LE.0) MAXCON = 20
      IF (IREDU.EQ.0) MAXCON = 1
      IF (KPOSD.LT.0) KPOSD = 0

      IF (STOL.LE.0.0) STOL = 0.0
C     --------------------------------
C     PRINT SOLUTION CONTROL VARIABLES
C     --------------------------------
      WRITE (ISO,2000) IREDU,MAXCON,KPOSD,STOL
	RETURN
C
 1000 FORMAT (1X,'READ STIFFNESS MATRIX CONTROL VARIABLES')
 2000 FORMAT (//25X,32(1H*)/25X,1H*,30X,1H*/
     +        25X,'* STIF. MAT. CONTROL VARIABLES *'/25X,1H*,30X,1H*/
     +        25X,32(1H*)//
     +        14X,'PROFILE (1) OR BANDWIDTH (2) OPT. .  IREDU = ',I9/
     +        14X,'MAX. NUMBER OF CONNECTED NODES. . . MAXCON = ',I9/
     +        14X,'REDUCTION OF NON-POS.DEF/INDEF [K].  KPOSD = ',I9/
     +        14X,'TOLERANCE TO DEFINE INDEFINITE [K].   STOL = ',E9.1)
C
      RETURN
      END
C
C=====================================================================
      SUBROUTINE NLMODE
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	SUNIL 01/05/04 COMPLETELY MODIFIED
C     ----------------------------------------------------------
C     READS TYPE AND OPTIONS OF NONLINEAR ANALYSIS
C	--------------------------------------------
C     NSTEP   = NUMBER OF LOAD STEPS
C     DLMAX   = FACTOR DEFINING MAXIMUM PERMITTED STEP WIDTH
C     NPRIN   = NUMBER OF STEPS BETWEEN PRINT OUTPUT
C     NDRAW   = NUMBER OF STEPS BETWEEN PLOT OUTPUT
C	NEQIT   = NUMBER OF STEPS BETWEEN EQUILIBRIUM ITERATTIONS
C     NIREF   = STRATEGY CODE 
C     ITEMAX  = MAXIMUM NUMBER OF ITERATIONS PERMITTED
C     RTOL    = RELATIVE TOLERANCE TO MEASURE CONVERGENCE
C     ITOPT   = CODE FOR ITERATION OPTION
C     NUMREF  = SUM OF REFORMATIONS FOR CURRENT STEP
C     NUMITE  = SUM OF ITERATIONS FOR CURRENT STEP
C     ITETOT  = TOTAL NUMBER OF ITERATIONS FOR RUN
C     RHO     = FACTOR DENOTING CURRENT LOADING LEVEL
C     ICONV   = FLAG FOR CONVERGENCE OR DIVERGENCE
C     NOLIN   = FLAG FOR TYPE OF NONLINEARITIES
C	LIMEQ1  = SELECTED NODE FOR DISPLACEMENT CONTROL
C	LIMEQ2  = SELECTED DOF. FOR DISPLACEMENT CONTROL
C     ----------------------------------------------------------
C
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
      COMMON /ITER/ RHO,RHOP,RHOPREV,RTOL,ETOL,DLMAX,ALP,
	1              NSTEP,NPRIN,NDRAW,
	2			  KONEQ,NIREF,ITOPT,ICONV,NOLIN,KSTEP,
     3              LIMEQ(2),ITEMAX,NUMREF,NUMITE,ITETOT,LIMET

      COMMON /PLOT/ LODE(2,10)

C	THIS COMMON LINE ADDED BY DE SILVA FOR SEEPAGE 30/04/2004
	COMMON /SEEP/ NTSTEP,KTSTEP,CTIME,DTINC,KFRES

	COMMON /DYNPL/ LDOPTI  !DYNAMIC LOAD CURVE OPTION 2=XFinas original 1,3=Time History Data  Songsak Jun2007

	COMMON /SEIS/ ISEIDA,ISEIOP,IADIR,IAFM,ICOMB,IRES,NPICK,
	1			  NSTIM,NEAQ,NAV,NSAV

C	PARAMETER FOR TRANSIENT HEAT tRANSFER SONGSAK MAR2007
	COMMON /SHEAT1/ PIMPLT,KSTEAD

C	==================================================================
C	CABLE PRETENSION OPTIMIZATION
	COMMON /CB556/ LCPZ,NCABZ,KBOPZ,NCOBZ
C	==================================================================

C	CONSOLIDATION SACHARUCK DEC2006  SILVA
	COMMON /EXCV/ NEXC,IEXC,NNODFI
	COMMON /BIOT/ TIMFAC,NBIOT
C	CONSOLIDATION SACHARUCK DEC2006
	COMMON /BIOT2/ TIMO
	COMMON /CONSO/ NCONSO

	COMMON /LINEAT/ KTRAF,KEATH,KCSAL,KOFFL,KSPEC,KDESIGN,KFATM,KFATJ,KFATL,KFAST,KOREV !SONGSAK AUG2007 RESPONSE SPECTRUM FOR ISOLOP 1,KFATL !SONGSAK AUG2007 RESPONSE SPECTRUM FOR ISOLOP 1

C	NEW EARTHQUAKE ANALYSIS SONGSAK SEP2007
	COMMON /LNDEQK/ LDEK,LPR2,LDESTP
	COMMON /LNDEQR/ EQAMP(3),EQGAP(3)
      

C	CONSOLIDATION SACHARUCK DEC2006 FLAG FOR SOLUTION CONTROL
	NBIOT = 0
	NEXC  = 0
C	==================================================================
	NCONSO = 0

C	------------------------------------------------------------------
C	SONGSAK NEW EARTHQUAKE SEP2007
	LDEK   = 0  !0 = STANDARD LOAD, 1=TIME HISTORY ,2=DYNAMIC CURVE GROUND MOTION
	LDESTP = 0  !NUMBER OF LOAD CURVE FOR GROUND MOTION SONGSAK SEP2007
C	-------------------------------------------------------------------
C	INITIALIZE CONTROL PARAMETER FOR CABLE OPTIMIZATION SONGSAK NOV2006
	KBOPZ = 0
	NCABZ = 0
C	-------------------------------------------------------------------
	KTRAF   = 0 !SONGSAK AUG2007
	KEATH   = 0
	KCSAL   = 0
	KOFFL   = 0
	KSPEC   = 0
	KDESIGN = 0
      KFATL   = 2  ! CANCLE FATIGUE READING DATA
      KOREV   = 0  ! 7-05-2015 RELATIVE FLOW
      
      IF (ISOLOP.EQ.21) CALL SOILMODULE (ISOLOP,"STORE")
C	Next line added 18Sep by NguyenDV for DM load
	IF(ISOLOP.EQ.11) GOTO 100

	READ (ITI,*)
	  SELECT CASE (ISOLOP)
C	  LINEAR STATIC
	  CASE(1)
	
	    READ (ITI,*,END=100) LIMEQ(1),LIMEQ(2),KBOPZ,NCABZ,
	1						 KTRAF,KEATH,KCSAL,KOFFL,KSPEC,KDESIGN,KFAST  !KTRAF = TRAFFIC LOAD ,KEATH = EARTHQUAKE ,KCSAL = CONSTRUCTION STAGE ,KOFFL = OFFSHORE LOAD                          !KDESIGN = DESIGN OPTION
		IF(KBOPZ.EQ.1) CALL CABCON(NCABZ,NCOBZ)             !FOR CABLE OPTIMIZATION SONGSAK NOV2006
	
	ITOPT = 1
	RTOL  = 0.001
	NIREF = 3
	DLMAX = 1.0
	ITEMAX= 100
	NPRIN = 1

C	  NONLINEAR STATIC
	  CASE(2)
          READ (ITI,*,END=100) NSTEP,DLMAX,NIREF,ITEMAX,RTOL,ITOPT
     +                        ,LIMEQ(1),LIMEQ(2),NPRIN,KOFFL

C	  LINEAR DYNAMIC
	  CASE(5)
	    READ (ITI,*,END=100) NSTEP,LDOPTI,LIMEQ(1),LIMEQ(2),LDEK,KOFFL,KSPEC,KFAST,KOREV
	    IF (KSPEC.EQ.1) ICONTROLSPEC = 1

		LDESTP = NSTEP  !NUMBER OF LOAD CURVE FOR GROUND MOTION SONGSAK SEP2007
C	  LINEAR DYNAMIC(VECTOR SUPERPOSITION)
        CASE(6)
          READ (ITI,*,END=100) NSTEP,LDOPTI,LIMEQ(1),LIMEQ(2),LDEK,KOFFL,KSPEC,KFAST,KOREV
		LDESTP = NSTEP  !NUMBER OF LOAD CURVE FOR GROUND MOTION SONGSAK SEP2007
C	  NONLINEAR DYNAMIC(DIRECT TIME INTEGRATION)
	  CASE(7)
          READ (ITI,*,END=100) NSTEP,LDOPTI,DLMAX,NIREF,ITEMAX,RTOL,
     +                         ITOPT,LIMEQ(1),LIMEQ(2),LDEK,KOFFL

		LDESTP = NSTEP  !NUMBER OF LOAD CURVE FOR GROUND MOTION SONGSAK SEP2007
C	  NONLINEAR DYNAMIC(VECTOR SUPERPOSITION)
	  CASE(8)
	    READ (ITI,*,END=100) NSTEP,LDOPTI,DLMAX,NIREF,ITEMAX,RTOL,
     +                         ITOPT,LIMEQ(1),LIMEQ(2)
C	  SEISMIC ANALYSIS
	  CASE(9)
C          READ (ITI,*,END=100) NSTEP,DLMAX,NIREF,ITEMAX,RTOL,ITOPT
C     +                        ,LIMEQ(1),LIMEQ(2)
C	Previous line changed to the next Nov2,03 by NguyenDV
C          READ (ITI,*,END=100) NSTEP,LIMEQ(1),LIMEQ(2)
C	ISEIDA,ISEIOP: added by NguyenDV-6Apr04-
          READ (ITI,*,END=100) NSTEP,ISEIDA,ISEIOP,LIMEQ(1),LIMEQ(2)
C	  INFLUENCE LINE
	  CASE(10)
	    READ (ITI,*,END=100) LIMEQ(1),LIMEQ(2)
C	  NEXT CASE ADDED BY GILSON - DEC2003 (LOAD CASES)
C	  BRIDGE, AUTOMATIC BRIDGE
	  CASE(12,13)
	    READ (ITI,*,END=100) LIMEQ(1),LIMEQ(2)

C	  HEAT ANALYSIS
	  CASE(14)
		READ (ITI,*,END=100) NTSTEP,DTINC,LIMEQ(1),LIMEQ(2),
	1						 KSTEAD,PIMPLT

C	  SEEPAGE ANALYSIS
	  CASE(15)
		READ (ITI,*,END=100) NTSTEP,LIMEQ(1),LIMEQ(2),KFRES  !KFRES = FREE SURFACE ITERATION FOR 1

C       FATIGUE ANALYSIS  
        CASE(16)
          READ (ITI,*,END=100) NSTEP,LDOPTI,LIMEQ(1),LIMEQ(2),LDEK,KOFFL,KSPEC,KFATM,KFATJ,KFATL
          IF (KSPEC.EQ.1) ICONTROLSPEC = 1
          LDESTP = NSTEP  !NUMBER OF LOAD CURVE FOR GROUND MOTION SONGSAK SEP2007
C	----------------------------------
C	CONSOLIDATION SACHARUCK DEC2006
C	  NONLINEAR CONSOLIDATION ANALYSIS
C	----------------------------------
	  CASE(18)

		READ (ITI,*,END=100) NTSTEP,DTINC,TIMO,LIMEQ(1),LIMEQ(2),
	1						 NCONSO,ITEMAX,RTOL,DLMAX,NIREF

C	NTSTEP = NUMBER OF TIME STEP INTEGRATION (FINAL TIME CONSIDERATION).
C	DTINC  = DIFFERENTIAL TIME INCREMENT.
C	NCONSO = 0  ELASTIC ANALYSIS.
C			 1  NONLINEAR MATERIAL ANALYSIS.
C	ITEMAX = ALLOWABLE ITERATION MAX.
C	RTOL   = CONVERGENCE TOLERANCE .

C	==============================================

C	  CREEP ANALYSIS ------------------------------------
C       CONTROL OVER SOLUTION ALGORITHM CREEP ANALYSIS
	  CASE(19)
		READ (ITI,*,END=100) LIMEQ(1),LIMEQ(2),NLOPT,NIREF,ITEMAX,
	1						 RTOL,DAYS,NPRIN	
	
		ITOPT = 1	  
	  DLMAX = 1.0	 
C       ---------------------------------------------------	  

C	  EIGENVALUE ANALYSIS/LINEAR BUCKLING ANALYSIS
	  CASE DEFAULT
	    LIMEQ(1) = 1
	    LIMEQ(2) = 1

	  END SELECT
	  IFPL(7) = 0

C	ENDIF

100	IF (IFPL(7).EQ.0) GOTO 400
C	--------------------------------------
C	READ NUMBER OF LOAD DEPLECTION CUREVES
C	--------------------------------------
      IC = 1
	WRITE (ITO,2500) IFPL(7)
300	READ (ITI,*,END=301) ISN,ISF
301	IF (IABS(ISN).LE.NSN) GOTO 310
      CALL ERRORS (2,IC,ISN,'DISPL.PLOT')
      GOTO 390
310	IF (ISF.GE.1 .AND. ISF.LE.NSF) GOTO 340
      CALL ERRORS (6,IC,ISF,'DISPL.PLOT')
      GOTO 390
C
 340  LODE(1,IC) = ISN
      LODE(2,IC) = ISF
      IC = IC+1
 390  IF (IC.LE.IFPL(7)) GOTO 300
C     --------------
C     DEFAUTE VALUES
C     --------------
 400  IF (NSTEP.LT.0)  NSTEP = 1
      IF (DLMAX.LE.0.) DLMAX = 1.0
      IF (NPRIN.LT.1)  NPRIN = 1
      IF (NDRAW.LT.1)  NDRAW = 1
      IF (NIREF.LT.0)  NIREF = 0
      IF (ITEMAX.LT.1) ITEMAX= 15
      IF (RTOL.LE.0.)  RTOL  = 1.0E-3
      IF (ITOPT.LT.1.OR.ITOPT.GT.3) ITOPT = 1
C	NEXT TWO 'IF' ADDED BY GILSON - AUG2002
	IF (LIMEQ(1).LE.0.OR.LIMEQ(1).GT.NSN) LIMEQ(1) = 1

C	CHANGED BY SACHARUCK MAR2007 (SONGSAK IMPLEMENTOR)
C	IF (LIMEQ(2).LE.0.OR.IDOF(LIMEQ(2)).EQ.0.OR.LIMEQ(2).GT.9)
C	2  LIMEQ(2) = 1

	IF (LIMEQ(2).LE.0.OR.LIMEQ(2).GT.9) LIMEQ(2) = 1
	NDUM = LIMEQ(2)
	DO II = 1,9
	IF(NDUM.EQ.IDOF(II)) LIMEQ(2) = II
	ENDDO

C     ---------------------------------
C     PRINT NONLINEAR CONTROL VARIABLES
C     ---------------------------------
      WRITE (ISO,4000) NSTEP,DLMAX,NPRIN,NDRAW,NEQIT,NIREF,ITEMAX,
     +                 ITOPT,IFPL(7),RTOL,LIMEQ
      RTOL = RTOL*RTOL
C
	RETURN
C
 1000 FORMAT (1X,'READ NONLINEAR CONTROL VARIABLES')
 2500 FORMAT (1X,'READ LOAD-DEFLECTION CURVES (',I2,1H))

 4000 FORMAT (//24X,31(1H*)/24X,1H*,29X,1H*/
     +        24X,31H* NONLINEAR CONTROL VARIABLES */
     +        24X,1H*,29X,1H*/24X,31(1H*)//
     +        14X,'NUMBER OF LOAD STEPS . . . . . . . . NSTEP =',I9/
     +        14X,'FACTOR DEFINING MAXIMUM STEP SIZE. . DLMAX =',E9.1/
     +        14X,'PRINTING INTERVAL. . . . . . . . . . NPRIN =',I9/
     +        14X,'PLOTTING INTERVAL. . . . . . . . . . NDRAW =',I9/
     +        14X,'NUM OF STEPS BETWEEN EQ.ITERATIONS . NEQIT =',I9/
     +        14X,'NUM OF ITERATIONS BETWEEN REF.[K]. . NIREF =',I9/
     +        14X,'MAXIMUM NUMBER OF ITERATIONS . . . .ITEMAX =',I9/
     +        14X,'CODE FOR ITERATION OPTION. . . . . . ITOPT =',I9/
     +        14X,'NUMBER OF LOAD-DEFLECTION CURVES . . IFPL7 =',I9/
     +        14X,'RELATIVE TOLERANCE FOR CONVERGENCE .  RTOL =',E9.1/
     +        14X,'SELECTED NODE FOR DISP. CONTROL. . .LIMEQ1 =',I9/
     +        14X,'SELECTED DIR. FOR DISP. CONTROL. . .LIMEQ2 =',I9)
C
      RETURN
      END
C
C=====================================================================
      SUBROUTINE EIGMOD
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	SUNIL MODIFIED INPUT VARIABLES (ADDED ISOLV, IMASS AND IVPRT)
C     ----------------------------------------------------------------
C     READS FLAG AND OPTIONS OF EIGENVALUE ANALYSIS
C	---------------------------------------------
C	ISOLV     = EIGEN VALUE SOLVER 
C				(1-SUBSPACE ITERATION,2-LANCZOS,3-INVERSE ITERATION)
C     IEIG      = TYPE OF EIGENVALUE ANALYSIS
C				(0-NO EIGEN SOLUTION,1-STANDARD EIGEN SOLUTION
C				 2-BUCKLING EIGEN SOLUTION,	3-NATUTAL FREQUANCEY)
C     IMASS     = OPTIONS FOR FORMATION OF MASS MATRIX
C				(0-NO MASS MATRIX,     1-LUMPED MASS MATRIX
C				 2-CONSISTETLY LUMPED, 3-CONSISTENT MASS MATRIX)
C     NSEIG     = NUMBER OF STEPS BETWEEN EIGENVALUE ANALYSIS
C     NROOT     = NUMBER OF EIGENVALUES REQUIRED
C	IVPRT     = NUMBER OF EIGENVECTOR REQUIRED
C     NC        = NUMBER OF ITERATION VECTORS USED
C     NNC       = SIZE OF MATRICES (UPPER TRIANG.)
C     NITEM     = NUMBER OF SUBSPACE ITERATIONS PERMITTED
C     IFSS      = FLAG FOR STURM SEQUENCE CHECK
C     EPS       = CONVERGENCE TOLERANCE ON EIGENVALUES
C     ----------------------------------------------------------------
C
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
      COMMON /EIGN/ NSEIG,NROOT,NC,NNC,NITEM,IFSS,SHIFT0,EPS,IEIG,NEIG,
     +              ISOLV,IVPRT
      COMMON /DYNA/ CDEN,IMASS
C	NEXT TWO COMMON ADDED BY GILSON - NOV2003 (INPUT)
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC

	COMMON /SEIS/ ISEIDA,ISEIOP,IADIR,IAFM,ICOMB,IRES,NPICK,
	1			  NSTIM,NEAQ,NAV,NSAV

	COMMON /LINEAT/ KTRAF,KEATH,KCSAL,KOFFL,KSPEC,KDESIGN,KFATM,KFATJ,KFATL,KFAST,KOREV !SONGSAK AUG2007 RESPONSE SPECTRUM FOR ISOLOP 1
	
	COMMON /RESO/ OPRES,STEPSTAT,STEPINCR,STEPEND
C	-----------------------------------------------------------------
	WRITE (ITO,1000)
      

	SELECT CASE (ISOLOP)

C	LINEAR ANALYSIS WITH RESPONSE SPECTRUM ANALYSIS
	CASE(1)
	IF(KEATH.EQ.1) THEN
	READ (ITI,*,END=100) ISOLV,IEIG,NROOT,IVPRT,NITEM,
     +                     IFSS,EPS,SHIFT0
	IMASS = 3		
	ENDIF
	
	IF(KSPEC.EQ.1)THEN
	READ (ITI,*,END=100) ISOLV,IEIG,NROOT,IVPRT,NITEM,
     +                     IFSS,EPS,SHIFT0
	IMASS = 3		
	ENDIF
	

C	FREQUENCY EIGENVALUE ANALYSIS
	CASE(3)
	READ (ITI,*,END=100) ISOLV,IEIG,NROOT,IVPRT,NITEM,
     +                     IFSS,EPS,SHIFT0
	IMASS = 3

C	LINEAR BUCKLING EIGENVALUE
	CASE(4)
	READ (ITI,*,END=100) ISOLV,IEIG,NROOT,IVPRT,NITEM,
     +                     IFSS,EPS,SHIFT0
	IMASS = 0

C	DYNAMIC ANALYSIS
	CASE(5,7)
	
C	  IF (KSPEC.EQ.1)THEN
C		READ (ITI,*,END=100) ISOLV,IEIG,NROOT,IVPRT,NITEM,
C     +                     IFSS,EPS,SHIFT0
C        ENDIF
	
	IMASS = 3

C	LINEAR DYNAMIC(VECTOR SUPERPOSITION)
	CASE(6)
	READ (ITI,*,END=100) ISOLV,IEIG,NROOT,IVPRT,NITEM,
     +                     IFSS,EPS,SHIFT0
	IMASS = 3

C	DYNAMIC MOVING LOAD (BRIGDE/TRAIN INTERACTION)

	CASE(11)
	READ (ITI,*)  !added 18Sep04 by NguyenDV		
	READ (ITI,*,END=100) ISOLV,IEIG,NROOT,IVPRT,NITEM,
     +                     IFSS,EPS,SHIFT0
	IMASS = 3

	END SELECT

C     ======================================
C         BY TOEY FOR OFFSHORE SPECTRUM
C     ======================================
      IF (ISOLOP.EQ.5.AND.KSPEC.EQ.1)THEN
         READ (ITI,*) NROOT,OPRES,STEPSTAT,STEPINCR,STEPEND
         IVPRT  = NROOT
         ISOLV  = 1
         IEIG   = 3
         NITEM  = 30
         IFSS   = 0
         EPS    = 0.0001D0
         SHIFT0 = 0
      ENDIF
      
      IF (ISOLOP.EQ.16)THEN
         READ (ITI,*) NROOT,OPRES,STEPSTAT,STEPINCR,STEPEND
         IVPRT  = NROOT
         ISOLV  = 1
         IEIG   = 3
         NITEM  = 30
         IFSS   = 0
         EPS    = 0.0001D0
         SHIFT0 = 0
      ENDIF    

C     --------------
C     DEFAUTE VALUES
C     --------------
100	IF (ISOLV.LT.1.OR.ISOLV.GT.5) ISOLV = 1

	IF (IEIG.LT.0 .OR. IEIG.GT.3) IEIG = 0
      IF (IEIG.EQ.0) NSEIG = 0

	IF (IMASS.LT.0 .OR. IMASS.GT.3) IMASS = 0
      IF (NSEIG.LE.0) NSEIG = 0
      IF (NROOT.LE.0) NROOT = 1

      IF (NC.LT.NROOT) NC = MIN0(2*NROOT,NROOT+8)

      IF (NITEM.LE.0.AND.ISOLOP.NE.11) NITEM = 15
      IF (IFSS.LT.0) IFSS = 0
      IF (EPS.LE.0.) EPS = 1.0E-06
      NNC = NC*(NC+1)/2

C     ----------------------------------
C     WRITE EIGENVALUE CONTROL VARIABLES
C     ----------------------------------
      WRITE (ISO,2000) ISOLV,IEIG,IMASS,NSEIG,NROOT,IVPRT,NC,NNC,
     +                 NITEM,IFSS,EPS,SHIFT0

C	SONGSAK FEB2008
      CALL DEFNINT('EIGM',KEIGM,1,20)
      CALL INTZERO('EIGM')
	CALL INTFILL('EIGM',ISOLV,1,1,1)
	CALL INTFILL('EIGM',IEIG ,1,2,1)  !2-BUCKLING EIGEN SOLUTION,	3-NATUTAL FREQUANCEY
	CALL INTFILL('EIGM',NROOT,1,3,1)
	CALL INTFILL('EIGM',IVPRT,1,4,1)  
	NFILM = 853
	CALL INTFILL('EIGM',NFILM,1,5,1)  !FILE FOR STORE MODESHAPE
	CALL DIROPEN(NFILM,518)           !518 BYTE PER ACCESS

      CALL DEFNREL('EIVV',KEIVV,1,NROOT)		 !EIGEN-VALUE TABLE
      CALL RELZERO('EIVV')

C
      RETURN
C
C	SUNIL 24/02/01 CHANGE RELEVANT FORMATS FOR ISOLV, IMASS AND IVPRT
 1000 FORMAT (1X,'READ EIGENVALUE CONTROL VARIABLES')
 2000 FORMAT (//24X,32(1H*)/24X,1H*,30X,1H*/
     +        24X,32H* EIGENVALUE CONTROL VARIABLES */
     +        24X,1H*,30X,1H*/24X,32(1H*)//
     +        14X,'TYPE OF EIGENSOLVER (1-4) . . . . .  ISOLV =',I9/
     +        14X,'TYPE OF EIGENVALUE ANALYSIS (0-3) .   IEIG =',I9/
     +        14X,'TYPE OF MASS MATRIX (0-3) . . . . .  IMASS =',I9/
     +        14X,'NUM OF STEPS BETWEEN EIGENV.ANAL. .  NSEIG =',I9/
     +        14X,'NUMBER OF EIGENVALUES REQUIRED. . .  NROOT =',I9/
     +        14X,'NUMBER OF EIGENVECTORS REQUIED. . .  IVPRT =',I9/
     +        14X,'NUMBER OF ITERATION VECTORS USED. .     NC =',I9/
     +        14X,'SIZE OF MATRICES IN JACOBI. . . . .    NNC =',I9/
     +        14X,'NUM OF SUBSPACE ITERATIONS PERMIT .  NITEM =',I9/
     +        14X,'FLAG FOR STURM SEQUENCE CHECK . . .   IFSS =',I9/
     +        14X,'CONVERGENCE TOL.ON EIGENVALUES. . .    EPS =',E9.1/
     +        14X,'INITIAL SHIFT TO BE APPLIED . . . . SHIFT0 =',E9.1)
C
      END
C
C	=====================================================================
C	=====================================================================
C	=====================================================================
      SUBROUTINE INTCON
      IMPLICIT REAL*8 (A-H,O-Z)
	IMPLICIT INTEGER*4 (I-N)
C     --------------------------------------------------------------
C     CALCULATE CONSTANTS FOR TIME INTEGRATION METHODS
C	PROGRAMED BY SUNIL 08/04/01
C	--------------------------------------------------------------
C     IOPT		TIME INTEGRATION OPTIONS
C					1 = WILSONS THETA METHOD
C					2 = NEWMARK METHOD
C					3 = CENTRAL DIFFERENCE METHOD
C					4 = HILBER-HUGHES-TAYLOR METHOD
C     DDT			TIME INCREMENT
C	CTIM		CURRENT TIME
C	NINC		NUMBER OF TIME INCREMENTS
C	IMASS		MASS MATRIX OPTION
C					1 = LUMPED MASS
C					2 = CONSISTENT DIAGONAL MASS
C					3 = CONSISTENT MASS
C	IDAMP		DAMPING MATRIX OPTION
C	IMASSN		NODAL MASS OPTION
C	IDAMPN		NODAL DAMPING OPTION
C	A0-A8		TIME INTEGRATION CONSTANTS
C	ALFA		RAYLEIGH DAMPING PARAMETER (ALPHA)
C	BETA		RAYLEIGH DAMPING PARAMETER (BETA)
C	A11			DELTA FOR NEWMARK (OR THETA FOR WILSON THETA)
C	A12			ALPHA  FOR NEWPARK (OR THETA*DDT FOR WILSON THETA)
C	--------------------------------------------------------------
	CHARACTER*80 TITLE
C
      COMMON /DYNA/ CDEN,IMASS
      COMMON /TIME/ DDT,CTIM,NINC
      COMMON /INCO/ A0,A1,A2,A3,A4,A5,A6,A7,A8,ALFA,BETA,
	1              A11,A12,ALF,IOPT
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)

	COMMON /EIGN/ NSEIG,NROOT,NC,NNC,NITEM,IFSS,SHIFT0,EPS,IEIG,NEIG,
     +              ISOLV,IVPRT
	COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
C
      DATA ZERO/1.E-12/
      DATA THMIN/1.39/,THMAX/2.01/
C	Common /EIGN/,/NUMB/ added Mar 2003 by NguyenDV
C
C	--------------------------------------------
C	READ THE PARAMETERS FOR DYNAMIC INTEGRATIONS
C	--------------------------------------------

	WRITE (ITO,1000)
      READ (ITI,1050,END=11) TITLE
11	WRITE (ISO,1060) TITLE

C	"ALF" ADDED TO THE NEXT LINE BY GILSON - OCT2001
	READ (ITI,*,END=12) IOPT,NINC,DDT,ALFA,BETA,A11,A12,ALF
	GOTO 13
12	CALL ERRORS (9,I,J2,'LOAD CURVE')
C
C	NEXT LINE CHANGED TO SECOND LINE BY GILSON - OCT2001
C13    IF (IOPT.LE.3) GOTO 15
13    IF (IOPT.LE.4) GOTO 15
      WRITE (ISO,1001)
      STOP

15	CONTINUE
      IF (DDT.GT.ZERO) GOTO 20
      WRITE (ISO,1003)
      STOP

20	CONTINUE
C	------------------------------------
C	COMPUTATION OF INTEGRATION CONSTANTS
C	------------------------------------
C	The next line added by NguyenDV, Mar24,2003	
	IF (ISOLOP.LT.5) GOTO 400
C	------------------------
C	Next line added by NguyenDV,Aug30/03 for Seismic analysis
C			to reduce DDT before computing constants Ai
	IF (ISOLOP.EQ.9) GOTO 400

C	--------------------------------------------------
C	FOURTH GOTO IN NEXT LINE ADDED BY GILSON - OCT2001	
      GOTO (100,200,300,231,400),IOPT
C	-------------------
C     WILSON THETA METHOD
C	-------------------                           
100	IF (A11.LE.0.0) A11=1.4
      TH = A11
      IF ((TH.GT.THMIN).AND.(TH.LT.THMAX)) GOTO 110
      WRITE (ISO,1002)
      STOP
110	CONTINUE
      DTA=DDT*TH
      A0 = 6.0/(DTA*DTA)
      A1 = 3.0/DTA
      A2 = 2.0*A1
      A3 = 0.5*DTA
      A4 = A0/TH
      A5 =-A2/TH
      A6 = 1.0-3.0/TH
      A7 = 0.5*DDT
      A8 = DDT*DDT/6.0
	A12= DTA
	WRITE (ISO,1500) NINC,DDT,ALFA,BETA,A11
	RETURN
C	--------------
C     NEWMARK METHOD
C	--------------
200	IF (A11.LE.0.0) A11 = 0.5
      IF (A12.LE.0.0) A12 = 0.25*((A11 + 0.50)**2)
      DELT = A11
      ALPA = A12
      IF (DELT.LT.0.50) GOTO 210
      IF (DELT.GT.0.55) GOTO 220                                       
      D1=0.5*(DELT+0.5)
      D2=D1*D1
      IF (ALPA.LE.ZERO) GOTO 210
      IF (ALPA.LT.D2) GOTO 230
      IF (ALPA.GT.D1) GOTO 220
      GOTO 240
210	CONTINUE
      WRITE (ISO,1002)
      STOP
220	CONTINUE
      WRITE (ISO,1004)                                                 
      GOTO 240
230	CONTINUE
      WRITE (ISO,1005)
C	FOLLOWING LINES WERE ADDED BY GILSON - OCT2001
	GOTO 240
C	---------------------------
C	HILBER-HUGHES-TAYLOR METHOD
C	---------------------------
231	IF (ALF.GE.-0.333.OR.ALF.LE.0.0) GOTO 232
	WRITE (ISO,1002)
	STOP
232	IF (A11.EQ.0.0) THEN
	  DELT = (1.0-2.0*ALF)/2.0
	ELSE
	  DELT = A11
	ENDIF
	IF (A12.EQ.0.0) THEN
	  ALPA = 0.25*(1.0-ALF)**2
	ELSE
	  ALPA = A12
	ENDIF
C	END OF ADDITION - OCT2001
C	---------------------------------
C	COMMON TO NEWMARK AND HHT METHODS
C	---------------------------------
240	CONTINUE
      DEAL=DELT/ALPA
      A0 = 1.0/(ALPA*DDT*DDT)
      A1 = DEAL/DDT
      A2 = 1.0/(ALPA*DDT)
      A3 = 0.5/ALPA-1.0
      A4 = DEAL-1.0
      A5 = DDT*(0.5*DEAL-1.0)
      A6 = DDT*(1.0 - DELT)
      A7 = DELT*DDT
	WRITE (ISO,2000) NINC,DDT,ALFA,BETA,A11,A12
	RETURN
C	--------------------------
C     CENTRAL DIFFENRENCE METHOD
C	--------------------------
300	A0 = 1/DDT/DDT
	A1 = 1/2.0/DDT
	A2 = 2.0*A0
	A3 = 1/A2
	WRITE (ISO,3000) NINC,DDT,ALFA,BETA

400	RETURN
C                                                                       
 1001 FORMAT(//,10X,'ERROR; INTEGRATION METHOD OUT OF RANGE')
 1002 FORMAT(//,10X,'ERROR; TIME INTEGRATION PARAMETER NOT ADMISSIBLE')
 1003 FORMAT(//,10X,'ERROR; TIME STEP TOO SMALL')
 1004 FORMAT(//,10X,'WARNNING; TIME INTEGRATION PARAMETER SUSPICIOUS')
 1005 FORMAT(//,10X,'CONDITIONALLY STABLE NEWMARK ALGORITHM')

1000  FORMAT (1X,'READ TIME INTEGRATION PARAMETERS')
1050  FORMAT (A80)
1060  FORMAT (//1X,A80)
1500	FORMAT(/19X,'TIME INTEGRATION PARAMETER FOR WILSON-THETA'//,
     1 11X,' INCR',2X,'TIME-STEP',2X,'RAY DAM-ALPHA',2X,'RAY DAM-BETA',
     2 6X,'THETA',/12X,55(1H-)/10X,I6,E11.4,4X,E11.4,3X,E11.4,E11.4)
2000	FORMAT(/21X,'TIME INTEGRATION PARAMETER FOR NEWMARK'//,
     1 1X,' INCR',2X,'TIME-STEP',2X,'RAY DAM-ALPHA',2X,'RAY DAM-BETA',
     2 2X,'NEWMARK-DELTA',2X,'NEWMARK-ALPHA'/2X,74(1H-)/,
     3 I6,E11.4,4X,E11.4,3X,E11.4,4X,E11.4,4X,E11.4)
3000	FORMAT(/15X,'TIME INTEGRATION PARAMETER FOR CENTRAL DIFFERENCE'//,
     1 16X,' INCR',2X,'TIME-STEP',2X,'RAY DAM-ALPHA',2X,'RAY DAM-BETA',
     2 /17X,44(1H-)/15X,I6,E11.4,4X,E11.4,3X,E11.4)
C                                                                       
	END
C
C=====================================================================
      SUBROUTINE LOADCURV (T,J1,J2,A,PROPLD)
      IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	SUNIL 01/05/11 PROGRAMMED BY SUNIL
C	----------------------------------------------------------------
C	READ PROPORTIONAL LOAD CURVES FOR DYNAMIC ANALYSIS AND
C	COMPUTE PROPLD AT EACH TIME T; IT IS POSSIBLE TO GENERATE
C	ANY ARBITRAY LOAD USING THE FOURIER COEFFICIENTS
C	----------------------------------------------------------------
C	T			= CURRENT TIME
C	J1			= FLAG (1-READ LOAD CUREVES, 2-COMPUTE PROPLD)
C	J2			= NUMBER OF LOAD CURVES 
C	A(1,J2)		= STARTING TIMES OF EACH LOAD CURVE
C	A(2,J2)		= ENDING TIMES OF EACH LOAD CURVE
C	A(6,J2)		= COEFFICEIENTS OF FORMULAR
C				  A(3,J2)-A(5,J3) ARE IN FORCE UNITS
C				  A(6,J2) IS IN Rad/Sec. AND A(7,J2) IS IN Deg.
C	PROPLD		= PROPORTIONAL LOAD {A3+A4*T+A5(SIN(A6*T+A7))}
C	----------------------------------------------------------------
	CHARACTER*80 TITLE

      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
	COMMON /DYNPL/ LDOPTI  !DYNAMIC LOAD CURVE OPTION 2=XFinas original 1,3=Time History Data  Songsak Jun2007

      DIMENSION A(7,1)


	IF(LDOPTI.NE.2) THEN
	CALL LOADCRV2(T,PROPLD,ITI,J1)
	RETURN
	ENDIF


      GOTO (100,200), J1
C	-------------------------------
C	INPUT PROPORTIONAL LOADS CURVES
C	-------------------------------
100   WRITE (ITO,1000) J2
      READ (ITI,1050,END=101) TITLE
101   WRITE (ISO,1060) TITLE

      WRITE (ISO,1100)
      DO 110 I=1,J2
		READ (ITI,*,END=102) (A(JK,I),JK=1,7)
C		L = A(6,I)
		WRITE (ISO,2000) I,(A(JK,I),JK=1,7)
110	CONTINUE
	RETURN
102	CALL ERRORS (9,I,J2,'LOAD CURVE')
C	-----------------------
C	COMPUTE VALUE AT TIME T
C	-----------------------
200	PROPLD = 0.0
      IF (T.LT.A(1,1) .OR. T.GT.A(2,J2)) GOTO 500
      I = 1
220	IF (T.GE.A(1,I) .AND. T.LT.A(2,I)) GOTO 230
      IF (I.GE.J2) GOTO 250
      I = I+1
      GOTO 220

230	CON = 3.141592654/180.0
	PROPLD = PROPLD + 
	1         A(3,I) + A(4,I)*T + A(5,I)*(DSIN(A(6,I)*T+CON*A(7,I)))
	I = I+1
	GOTO 220

250	RETURN 

500   RETURN
	WRITE (ITO,5000) T,A(1,1),A(2,J2)
      WRITE (ISO,5000) T,A(1,1),A(2,J2)
      STOP
C
1000  FORMAT (1X,'READ DYNAMIC LOAD DATA (HEADER & NUMBER OF LOAD'
	1        1X,'CURVES)',I5)
1050  FORMAT (A80)
1060  FORMAT (//1X,A80)
1100	FORMAT(/24X,'LOAD CURVES FOR DYMANIC ANALYSIS'//,
     1       1X,' NOS',7X,'TMIN',7X,'TMAX',9X,'A1',9X,'A2',9X,'A3',
     2       9X,'A4',9X,'A5'/2X,80(1H-))
2000	FORMAT(I5,7E11.4)

5000  FORMAT(/,1HX,
     *' ***   WARNING; CURRENT TIME IS OUT OF RANGE !   ***',/
     *'                CURRENT TIME STEP  =',E14.6,/
     *'                INPUT MINMUM TIME  =',E14.6,/
     *'                INPUT MAXIMUM TIME =',E14.6,/)
C
      END
C
C	=====================================================================
	SUBROUTINE LOADCRV2(TIM,VV,ITI,IND)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	=============================================================
C	PRODUCED BY SONGSAK JUN2007
C	INTERPOLATION OF TIME HISTORY DATA
C	=============================================================
C	=============================================================

	IF(IND.EQ.2) GOTO 4

	READ(ITI,*) 
	READ(ITI,*) 
	READ(ITI,*) NUMT
	IF(NUMT.GT.0) READ(ITI,*)

	CALL  DEMREL('DYNL',KNUMT,NUMT,2,'FIRS') 

	DO IUMT = 1,NUMT
	READ(ITI,*) ID,TIME,FACL
	CALL MRELFIL('DYNL',TIME,IUMT,1,1,'FIRS')
	CALL MRELFIL('DYNL',FACL,IUMT,2,1,'FIRS')
	ENDDO

	RETURN


4	CONTINUE

C	CALLING NUMT
	CALL  LOCATM('DYNL',KNUMT,NUMT,NC,2,'FIRS')

	NP = NUMT/5       !NUM 1ST PICK
	IF(NP.LE.1) NP = 1

	IF(NP.GT.NUMT) NP = NUMT
	I1 = 1
	I2 = NP

	DO I = 1,NUMT
	
	IF(I2.GT.NUMT) THEN
	I2 = NUMT
	I1 = I2 - NP + 1
	GOTO 5
	ENDIF


C	TT1 = TIMET(1,I1)
C	TT2 = TIMET(1,I2)
	CALL MRELFIL('DYNL',TT1,I1,1,0,'FIRS')
	CALL MRELFIL('DYNL',TT2,I2,1,0,'FIRS')


	IF(TIM.GE.TT1.AND.TIM.LE.TT2) GOTO 5

	I1 = I2
	I2 = I2 + NP

	ENDDO

	I1 = 1
	I2 = NUMT

5	CONTINUE


	DO I = I1,I2

C	TT1 = TIMET(1,I)
C	TT2 = TIMET(1,I+1)
	CALL MRELFIL('DYNL',TT1,I  ,1,0,'FIRS')
	CALL MRELFIL('DYNL',TT2,I+1,1,0,'FIRS')

	IF(TIM.GE.TT1.AND.TIM.LE.TT2) THEN
	IT = I
	GOTO 10
	ENDIF 
	ENDDO

	VV = 0.0D0
	GOTO 20

10	CONTINUE

	DT = TIM-TT1
	TT = TT2-TT1
	IF(TT.NE.0.0D0) THEN
	    H1 = 1.0 - DT/TT
	    H2 = DT/TT
	ELSE
	    H1 = 1.0D0
	    H2 = 0.0D0
      ENDIF
      
C	FAC1 = TIMET(2,IT)
C	FAC2 = TIMET(2,IT+1)
	CALL MRELFIL('DYNL',FAC1,IT  ,2,0,'FIRS')
	CALL MRELFIL('DYNL',FAC2,IT+1,2,0,'FIRS')
	VV = FAC1*H1 + FAC2*H2

20	CONTINUE


	RETURN
	END
C	=============================================================
C	=============================================================
C	=============================================================
	SUBROUTINE AXIS(AMV,IAX,NV,NELE)
C	-----------------------------------------------------------
C	TO READ STORE MATERIAL PRINCIPAL AXES AND ID NUMBERS
C	  PROGRAMMED BY GILSON   ! ALL MODIFIED BY SONGSAK MAY2007
C	-----------------------------------------------------------
C	ALEN - DUMMY VARIABLE - DISTANCE BETWEEN TWO POINTS
C	AMV - NORMALIZED MATERIAL REFERENCE AXIS (NUMBER,DIRECTION)
C	IAX - ELEMENT MATERIAL AXIS NUMBER
C	ICK - CHECKING FLAG
C	ICNT - MEMBER COUNTER
C	IDUM - DUMMY VARIABLE
C	INC - MEMBER NUMBER INCREMENT
C	ITI - INPUT FILE ID NUMBER
C	MEMBA,MEMBB - START/END MEMBER NUMBER
C	NELE - NUMBER OF ELEMENTS IN THE GROUP
C	NUM - AXIS NUMBER
C	NV - NUMBER OF MATERIAL AXES
C	V(3) - NORMALIZED MATERIAL AXIS VECTOR
C	X1,Y1,Z1 - FIRST POINT OF MATERIAL AXIS
C	X2,Y2,Z2 - END POINT OF MATERIAL AXIS
C	-----------------------------------------------------------
	IMPLICIT REAL*8(A-H,O-Z)

      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)

	DIMENSION AMV(3,NV),IAX(NELE)
	DIMENSION V(3)

	ICNT = 0
	WRITE (ISO,1000)

C	-------------------------
C	READ MATERIAL AXIS POINTS
C	-------------------------
	READ (ITI,*)
	IMV = 0
10	IMV = IMV + 1
	READ (ITI,*) NUM,X1,Y1,Z1,X2,Y2,Z2
	V(1) = X2-X1
	V(2) = Y2-Y1
	V(3) = Z2-Z1
	
	IF ((DABS(V(1))+DABS(V(2))+DABS(V(3))).EQ.0.0D0) THEN
	  V(1:3) = [1.0D0,0.0D0,0.0D0] !DEFAULT TO X-AXIS IF VECTOR IS UNDEFINED
	ENDIF
	
	CALL SCALEN(V,V,ALEN,3)
	
      DO 20 I = 1,3
20	AMV(I,NUM) = V(I)

C	PRINT MATERIAL REFERENCE AXIS
	WRITE (ISO,1010) NUM,AMV(1,NUM),AMV(2,NUM),AMV(3,NUM)
	IF (IMV.LT.NV) GOTO 10
C	----------------------------------
C	STORE ELEMENT MATERIAL AXIS NUMBER
C	----------------------------------
	READ (ITI,*)
	DO IELE = 1,NELE
	READ(ITI,*) IE,IAX(IELE)
	ENDDO


1000	FORMAT (//25X,23HMATERIAL REFERENCE AXES/25X,23(1H-)//
	1  14X,44H AXIS NO.     X-COMP      Y-COMP      Z-COMP/15X,44(1H-))
1010	FORMAT (17X,I2,8X,E10.3,4X,E10.3,4X,E10.3,4X)

40	RETURN
	END

C
C=====================================================================

C=====================================================================
      SUBROUTINE GEPROP (PROPG,IGSET,MGP)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C	SUNIL 01/05/09 COMPLETELY MODIFIED
C     ------------------------------------------------------------
C     READ GEOMETRIC PROPERTIES AND ASSIGN GEOMETRIC PROPERTY SETS
C	TO EACH ELEMENTS OF THE CURRENT ELEMENT GROUP
C	---------------------------------------------
C     PROPG(NGP,NGPS)  = GEOMETRIC PROPERTIES
C     IGSET(NELE)      = GEOMETRIC PROPERTY SET NUMBER
C     ------------------------------------------------------------
      COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
C
	COMMON /SPDETA/ NSNGP(200),KGP
      DIMENSION PROPG(MGP,1),IGSET(1),PROP(250)
	DIMENSION NCNOD(10,4,5),NCELL(100)
	DIMENSION IGEO(NELE,2) !ADDED BY GILSON - JUN2004


C	SUNIL 18/01/01 REMOVE NEXT LINE
C     EQUIVALENCE (PROP(1),IPROP)
C     ------------------------------------------------
C     READ GEOMETRIC PROPERTIES AND SET DEFAUTE VALUES
C     ------------------------------------------------
	IGEO = 0 !ADDED BY GILSON - JUN2004
      IGPS = 0 !added by gilson - march2004 (geom prop)

C	CHANGED BY SACHARUCK MAR2007 (SONGSAK IMPLEMENTOR)	
C	IF(ITYPE.EQ.10) GOTO 200
	IF(ITYPE.EQ.10.OR.ITYPE.EQ.11.OR.ITYPE.EQ.14.OR.
	1   ITYPE.EQ.16) GOTO 200

100	IGPS = IGPS+1
	IF (ITYPE.EQ.5) THEN !added by gilson - march2004 (geom prop)

		READ(ITI,*) KGP
		NSNGP(IGPS) = KGP

		WRITE (ITO,1000) KGP,NGPS
		READ (ITI,*,END=101) ISET,IPROP,(PROP(IGP),IGP=2,KGP)

	ELSE

        KGP = NGP

        WRITE (ITO,1000) KGP,NGPS

	  READ (ITI,*,END=101) ISET,IPROP,(PROP(IGP),IGP=2,KGP)
	

	ENDIF


 101	IF (ISET.GE.1 .AND. ISET.LE.NGPS) GOTO 150
      CALL ERRORS (4,IGPS,ISET,'GEOM.PROP.')
      GOTO 190
C
 150  IF (IPROP.LE.0 .OR. IPROP.GT.NNM) IPROP = NNM
C	SUNIL 18/01/01 ADD NEXT LINE
 	PROP(1)=FLOAT(IPROP)
C
      DO 180  IGP=1,KGP
 180  PROPG(IGP,ISET) = PROP(IGP)


 190  IF (IGPS.LT.NGPS) GOTO 100
C     --------------------------
C     PRINT GEOMETRIC PROPERTIES
C     --------------------------

      IF (ITYPE.EQ.5) GOTO 295
      DO 290  IGPS=1,NGPS
 290  WRITE (ISO,2000) IGPS,(IGP,PROPG(IGP,IGPS),IGP=1,NGP)
C     ----------------------------------------
C     ASSIGN GEOMETRIC SET NUMBERS TO ELEMENTS
C     ----------------------------------------
 295  WRITE (ITO,3000) NGPS,NELE
      IELE = 0
	IELEt= 0
	
C     NO NEED TO ASSIGN TO TENDON ELEMENT  MAR2010
      IF(ITYPE.EQ.17) RETURN
      
	READ(ITI,*)

C	READ ELEMENTS TO ASSIGN GEOMETRIC PROP
 300	READ (ITI,*) MEMBA,ISET
	INC = 1
	IELEt = IELEt+1
	MEMBB = IELEt
	MEMBA = IELEt

 400  DO 480  IMEM=MEMBA,MEMBB,INC
      IGSET(IMEM) = ISET
 480  IELE = IELE+1

 490  IF (IELE.LT.NELE)  GOTO 300

C
	RETURN
C
 200	ISET = 1
	PROPG(1,1)= NNM
	PROPG(2,1)= 1.0
      DO 280  IMEM=1,NELE
 280  IGSET(IMEM) = ISET
	RETURN

 1000 FORMAT (1X,'READ GEOMETRIC PROPERTIES ',I2,' FOR SETS ',I2)
 2000 FORMAT (//21X,36HGEOMETRIC PROPERTIES FOR SET NUMBER ,I2/
     1         21X,38(1H-)//
     2      14X,'PROP(',I2,32H)  NUMBER OF NODES . . . . NNO =,F9.0/
     3     (14X,'PROP(',I2,32H)  . . . . . . . . . . . .     =,E14.6))
 3000 FORMAT (1X,'READ ASSIGNMENT OF GEOMETRI SETS ',I2,' TO',I5,
	1        1X,'ELEMENTS')
C
      END
C=====================================================================
C	=====================================================================
      SUBROUTINE LDASEM (RLOAD)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -----------------------------------------------------------------
C	PURPOSE: TO ASSEMBLE THE MATRIX OF LOADS FOR DIFFERENT LOAD CASES
C
C	INPUT VARIABLES
C
C     -----------------------------------------------------------------
      COMMON /LOCA/ LID,LDS,LEL,LDC,LXY,LCH,LNU,LMP,LGP,LMS,LGS,
     1              LCO,LEX,LLM,LES,LEC,LED,LEI,LEE,LMA,LLF,LLV,
     2              LRE,LDI,LDL,LDT,LDK,LER,LEV,LTT,LWV,LAR,LBR,
     3              LVE,LDD,LRT,LBU,LBC,LVL,LAL,LEF,LDU,LPR,LLO,
	4              LRV,LRT1,LRET,LRET1,LDM,LDPT,LVL1,LMV,LXI,LCM,LCC,
	5			    LCN,LDIM,LFRE,LSFC
      COMMON /SOLU/ NEQ,NEQ1,NBLOCK,MK,BM,NWK,NWM,ISTOR,NFAC,
     +              NRED,KPOSD,DETK,DET1,DAVR,STOL
	COMMON /LCSS/ ILCN,ILCC
      COMMON A(7000000),IA(6000000)

	DIMENSION RLOAD(NEQ)
	

	IF(ILCN.GT.0) THEN

	IREF  = LLV +NEQ*(ILCN-1)-1
	DO 100 I = 1,NEQ
	A(IREF+I) = A(IREF+I) + RLOAD(I)
100	CONTINUE

	ENDIF

	IF(ILCC.GT.0) THEN

	IREF  = LLO +NEQ*(ILCC-1)-1
	DO 200 I = 1,NEQ
	A(IREF+I) = A(IREF+I) + RLOAD(I)
200	CONTINUE

	ENDIF

	CALL CLEARA(RLOAD,NEQ)


	RETURN
	END
C	=====================================================================
      SUBROUTINE NODELO (ID,MSF,NNL)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     READS AND GENERATES NODAL LOADS, ADDS CONTRIBUTIONS TO LOAD V
C     -------------------------------------------------------------
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     1              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)
      COMMON /SOLU/ NEQ,NEQ1,NBLOCK,MK,BM,NWK,NWM,ISTOR,NFAC,
     +              NRED,KPOSD,DETK,DET1,DAVR,STOL

	COMMON /LCSS/ ILCN,ILCC
C
      DIMENSION ID(MSF,1),R(NEQ),TNO(NSN),FLOAD(MSF,NSN),FORCE(6)
      
      DIMENSION VFOMA(3)
      
      DIMENSION RMA(NEQ)

	TNO = 0.0

C     ---------------
C     INITIALISATION
C     --------------
      CALL CLEARA (R,NEQ)
      CALL CLEARA (RMA,NEQ)
      CALL CLEARA (FLOAD,NSF*NSN)
C     --------------------
C     INPUT OF NODAL LOADS
C     --------------------
 150  WRITE (6,1100) NNL
      INL = 0

	READ (ITI,*)

200	READ (ITI,*,END=202) NODEA,ISF,RLOAD,NFOMA,VFOMA(1:3),GRAV,ILCN,ILCC
 202  NODEA = IABS(NODEA)
      NODEB = NODEA
	INC = 1

	ISF = IDOFCALL(IDOF,ISF)

      IF (NODEA.LE.NSN) GOTO 210
      CALL ERRORS (2,INL,NODEA,'JOINT LOAD')
      GOTO 290
 210  IF (NODEB.LE.NSN) GOTO 220
      CALL ERRORS (2,INL,NODEB,'JOINT LOAD')
      GOTO 290
C

220	 DO 250  INO=NODEA,NODEB,INC
		TNO(INO) = 1.0
		FLOAD(ISF,INO)  =  FLOAD(ISF,INO)  + RLOAD
		IEQ = ID(ISF,INO)
		INL = INL+1
		IF (IEQ) 240,240,230
 230      R(IEQ)   = R(IEQ)   + RLOAD
          NFIEQ    = ((NODEA-1)*6)+1
          IF (VFOMA(1).EQ.1.AND.NFOMA.EQ.1) RMA(NFIEQ)   = RMA(NFIEQ)   + (RLOAD/ABS(GRAV))
          IF (VFOMA(2).EQ.1.AND.NFOMA.EQ.1) RMA(NFIEQ+1) = RMA(NFIEQ+1) + (RLOAD/ABS(GRAV))
          IF (VFOMA(3).EQ.1.AND.NFOMA.EQ.1) RMA(NFIEQ+2) = RMA(NFIEQ+2) + (RLOAD/ABS(GRAV))
		GOTO 250
 240		CALL ERRORS (7,INL,INO,'JOINT LOAD')
 250   CONTINUE
       
	CALL LDASEM (R)


	IF (INL.GT.NNL) CALL ERRORS (24,INL,NNL,'JOINT LOAD')
 290  IF (INL.LT.NNL) GOTO 200
     
      CALL FORCEMASSVECTOR (RMA,'WRITE')
      CALL CLEARA (RMA,NEQ)
      
C     -----------------
C     PRINT NODAL LOADS
C     -----------------
C	FORCES
      WRITE (ISO,2100)
      CALL CLEARA (FORCE,6)
      
 !     DO 490  ISN=1,NSN
 !     IF (TNO(ISN).EQ.0.)THEN
 !     GOTO 490
 !     ENDIF
 !     DO 450  ISF=1,NSF
 !     IPO = IDOF(ISF)
 !450  FORCE(IPO) = FLOAD(ISF,ISN)
 !     WRITE (ISO,4000) ISN,FORCE
 !490  CONTINUE
      
       DO ISN=1,NSN
         IF (TNO(ISN).EQ.0.) THEN
         GOTO 490
         ENDIF
         DO ISF=1,NSF
          PO = IDOF(ISF)
          FORCE(IPO) = FLOAD(ISF,ISN)
        ENDDO
          WRITE (ISO,4000) ISN,FORCE
490   ENDDO
C

C	SUNIL 01/05/10 ADDED NEXT TWO LINE (WARNING CHECK ANY EFFECTS DUE TO THIS)
      CALL CLEARA (FLOAD,NSF*NSN)
      CALL CLEARA (TNO,NSN)
C
      RETURN
C
 1100 FORMAT (1X,'READ & GENERATE NODAL LOADS;',I5,' NODAL LOADS')
 2100 FORMAT (///28X,24HCONCENTRATED NODAL LOADS//
     +        1X,'JOINT',8X,'FORCE-X',5X,'FORCE-Y',5X,'FORCE-Z',4X,
     +        'MOMENT-X',4X,'MOMENT-Y',4X,'MOMENT-Z'/1X,80(1H-))
 2200 FORMAT (///30X,19HNODAL DISPLACEMENTS//
     +        1X,'JOINT',8X,'DISPL-X',5X,'DISPL-Y',5X,'DISPL-Z',4X,
     +        'ROTATI-X',4X,'ROTATI-Y',4X,'ROTATI-Z'/1X,80(1H-))
 4000 FORMAT (1X,I5,3X,6E12.5)
C
      END
C
C=====================================================================
      SUBROUTINE FASTTOPFORCE (ID,MSF,NODEA,NCASE,NFPR,NTFPR,R,NEQ,ILC,OPTION)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
      DIMENSION R(NEQ)
      DIMENSION NCASE(1000),NFPR(1000)
      CHARACTER*4 OPTION
      CHARACTER(LEN=200)::LINE
      DIMENSION ID(MSF,1)
      CHARACTER(100) TurbStaFileName,TurbDynFileName,NumberofPara,ROOTFST
      COMMON / NODEFAST / NODEAF,NUMCASE(1000),NFASTPARA(1000)
      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     1              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      
      IF (OPTION.EQ."WRIT")THEN ! WRITE 
      NODEAF             = NODEA
      NUMCASE(1:NTFPR)   = NCASE(1:NTFPR)
      NFASTPARA(1:NTFPR) = NFPR(1:NTFPR)
      
      ELSEIF (OPTION.EQ."READ")THEN ! LOAD CASE ( STATIC )
      OPEN(UNIT=553,FILE="INTEGER_TO_STRING"  ,STATUS='UNKNOWN')    
!      NumberofPara = '1'   
C      NumberofPara    = NFASTPARA(ILC)
      WRITE (553,10) NFASTPARA(ILC)
10    FORMAT (I5)
      REWIND (553)
      READ (553,*) NumberofPara 
      CLOSE(553)
      ROOTFST         = '.dat'
      TurbStaFileName = "FASTLoadSta"//"/"//"TurbStaFile"//TRIM(NumberofPara)//TRIM(ROOTFST)    
      TurbDynFileName = "FASTLoadDyn"//"/"//"TurbDynFile"//TRIM(NumberofPara)//TRIM(ROOTFST)
      OPEN(UNIT=551,FILE=TurbStaFileName,STATUS='UNKNOWN')
      OPEN(UNIT=552,FILE=TurbDynFileName,STATUS='UNKNOWN')
      
      READ (551,'(A)',IOSTAT=ios) LINE
C      IF (LEN_TRIM(LINE).NE.22) RETURN
      READ (551,*) FX,FY,FZ,AMX,AMY,AMZ
      
      DO I = 1,6
      IEQ = ID(I,NODEAF)
      IF (I.EQ.1)  R(IEQ) = R(IEQ)+FX*1000D0
      IF (I.EQ.2)  R(IEQ) = R(IEQ)+FZ*1000D0
      IF (I.EQ.3)  R(IEQ) = R(IEQ)+FY*1000D0
      IF (I.EQ.4)  R(IEQ) = R(IEQ)+AMX*1000D0
      IF (I.EQ.5)  R(IEQ) = R(IEQ)+AMZ*1000D0
      IF (I.EQ.6)  R(IEQ) = R(IEQ)+(-AMY*1000D0)
      ENDDO

      ELSEIF (OPTION.EQ."REDD") THEN ! LOAD CASE 1 ( DYNAMIC )
      IF (ILC.EQ.1)THEN ! FIRST LOOP
      OPEN(UNIT=553,FILE="INTEGER_TO_STRING"  ,STATUS='UNKNOWN')    
      WRITE (553,20) NFASTPARA(ILC)
20    FORMAT (I5)
      REWIND (553)
      READ (553,*) NumberofPara 
      CLOSE(553)
      ROOTFST         = '.dat'
      TurbStaFileName = "FASTLoadSta"//"/"//"TurbStaFile"//TRIM(NumberofPara)//TRIM(ROOTFST)    
      TurbDynFileName = "FASTLoadDyn"//"/"//"TurbDynFile"//TRIM(NumberofPara)//TRIM(ROOTFST)
      OPEN(UNIT=551,FILE=TurbStaFileName,STATUS='UNKNOWN')
      OPEN(UNIT=552,FILE=TurbDynFileName,STATUS='UNKNOWN')
      
      READ (552,'(A)',IOSTAT=ios) LINE
C      IF (LEN_TRIM(LINE).NE.23) RETURN
      READ (552,*) ! WIND CASE
      READ (552,*) ! TIMESTEP
      ENDIF 
      
      READ (552,*) FX,FY,FZ,AMX,AMY,AMZ
      
C     KN TO N
      DO I = 1,6
      IEQ = ID(I,NODEAF)
      IF (I.EQ.1)  R(IEQ) = R(IEQ)+FX*1000D0
      IF (I.EQ.2)  R(IEQ) = R(IEQ)+FZ*1000D0
      IF (I.EQ.3)  R(IEQ) = R(IEQ)+FY*1000D0
      IF (I.EQ.4)  R(IEQ) = R(IEQ)+AMX*1000D0
      IF (I.EQ.5)  R(IEQ) = R(IEQ)+AMZ*1000D0
      IF (I.EQ.6)  R(IEQ) = R(IEQ)+(-AMY*1000D0)
      ENDDO

      ENDIF
      END
C=====================================================================  
      SUBROUTINE FORCEMASSVECTOR (R,NOPT)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
      CHARACTER*5 NOPT
      DIMENSION VFOMA(3)
      COMMON /SOLU/ NEQ,NEQ1,NBLOCK,MK,BM,NWK,NWM,ISTOR,NFAC,
     +              NRED,KPOSD,DETK,DET1,DAVR,STOL
      COMMON/ VECTORFORCEMASS / VECFORCEMASS(100000)
      COMMON /LCSS/ ILCN,ILCC
      
      DIMENSION R(NEQ)
      
      IF (NOPT.EQ.'WRITE') THEN
      ! STOREAGE FORCE MATRIX
      VECFORCEMASS(1:NEQ) = R(1:NEQ)
         IF (NEQ.GT.100000)THEN
         WRITE (*,1)
1        FORMAT ('THE STORAGE LIMIT ON 100,000 POINTS (PLEASE CONTRACT DEVELOPER)')
         STOP
         ENDIF
      ELSEIF (NOPT.EQ.'READD') THEN
      ! READ FORCE MATRIX
      R(1:NEQ)            = VECFORCEMASS(1:NEQ)
      NUMBER  = (NEQ/6D0)
C        FX,FY,FZ.NE.0 (BUT) MX,MY,MZ.EQ.0 
         DO I = 1,NUMBER
         INDEX = (I-1)*6
         R(INDEX+4) = 0.0D0
         R(INDEX+5) = 0.0D0
         R(INDEX+6) = 0.0D0
         ENDDO
         
      ENDIF
      END
C=====================================================================
      SUBROUTINE GAUSSPRIN (LEST)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -----------------------------------------------------------------
C     PRINT GAUSS LOACATION FOR EACH ELEMENT TYPES
C	-----------------------------------------------------------------
C     LEST(2*NEG) = LENGTHS OF ELEMENT BLOCK INFORMATION (ARRAY A & IA)
C     -----------------------------------------------------------------

      COMMON /NUMB/ HED(20),MODEX,NRE,NSN,NEG,NBS,NLS,NLA,
     +              NSC,NSF,IDOF(9),LCS,ISOLOP,LSYMM,ICONTROLSPEC
      COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT

      COMMON /LOCA/ LID,LDS,LEL,LDC,LXY,LCH,LNU,LMP,LGP,LMS,LGS,
     1              LCO,LEX,LLM,LES,LEC,LED,LEI,LEE,LMA,LLF,LLV,
     2              LRE,LDI,LDL,LDT,LDK,LER,LEV,LTT,LWV,LAR,LBR,
     3              LVE,LDD,LRT,LBU,LBC,LVL,LAL,LEF,LDU,LPR,LLO,
	4              LRV,LRT1,LRET,LRET1,LDM,LDPT,LVL1,LMV,LXI,LCM,LCC,
	5			    LCN,LDIM,LFRE,LSFC

      COMMON /INOU/ ITI,ITO,ISO,NDATI,NPLOT,NKFAC,NELEM,
     1              IFPR(10),IFPL(10)


	COMMON /GiDEle/ LGID 

      COMMON A(7000000),IA(6000000)

      DIMENSION LEST(1)

C	unit 102 for gaussp.flavia.res
	IGO = 102

C	LOOP OVER ELEMENT GROUP
C     -------------------------------------------------------
	DO 1000 IEG = 1,NEG
C     -------------------------------------------------------

	KEG = IEG
	NELEMI = 10 + IEG
      NELEMA = 30 + IEG
      REWIND NELEMI
      REWIND NELEMA
      READ (NELEMI) (IA(NLNU),NLNU=LNU,LNU + LEST(IEG)-1)
      READ (NELEMA) ( A(NLNU),NLNU=LMP,LMP + LEST(IEG+NEG)-1)
      CALL MOVLEV (2)
	

C     ----------------------------------------
C     WRTIE GAUSS POINT POSITION INTO FILE
C     ----------------------------------------

C     -------------------------------------------------------
	IF(ITYPE.EQ.2) THEN !TRUSS CABLE

	CALL GAUSSTYP2 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.5) THEN !FRAME

	CALL GAUSSTYP5 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.6) THEN !PLANE

	CALL GAUSSTYP6 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.8) THEN !PLANE CONSO

	CALL GAUSSTYP8 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.9) THEN !SHELL

	CALL GAUSSTYP9 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.10) THEN !SOLID

	CALL GAUSSTYP10 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.11) THEN !SOLID CONSO

	CALL GAUSSTYP11 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.13) THEN !SEEPAGE PLANE

	CALL GAUSSTYP13 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.14) THEN !SEEPAGE SOLID

	CALL GAUSSTYP14 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.15) THEN !HEAT PLANE

	CALL GAUSSTYP15 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------
	IF(ITYPE.EQ.16) THEN !HEAT SOLID

	CALL GAUSSTYP16 (A(LCO),IA(LGID),IGO) 

	GOTO 1000
	ENDIF
C     -------------------------------------------------------	
C     -------------------------------------------------------

C     -------------------------------------------------------
1000	CONTINUE
C     -------------------------------------------------------	

C	CLOSE gaussp.flavia.res
	CLOSE(102)


      RETURN
      END
C	=====================================================================
C	=====================================================================
C	=====================================================================
	SUBROUTINE GAUSSTYP2 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION TRUSS & CABLE
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3),H(NNM)

	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NGR
	IPT = IPT + 1

	R = GLOC(IGR,NGR)
	H(1:2) = [0.5*(1.0-R),0.5*(1.0+R)]
	GXYZ(1:3) = 0.0D0

	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J) = GXYZ(J) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3)
	ENDIF

	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XTruss & XCable"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP5 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION FRAME
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3),H(NNM)

	ALLOCATABLE GPL(:)

C	CALLING ELEMENT GAUSS POINT NUMBER
	CALL INTFILL('OGRP',NGG ,5 ,KEG,0) !

	ALLOCATE(GPL(NGG))

	DO IGG = 1,NGG
	IF(IGG.EQ.1  ) GPL(IGG) = -1.0D0
	IF(IGG.EQ.NGG) GPL(IGG) =  1.0D0 
	IF(IGG.NE.1.AND.IGG.NE.NGG) GPL(IGG) =  GLOC(IGG-1,NGG-2)
	ENDDO

	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NGG
	IPT = IPT + 1

	R = GPL(IGR)
	H(1:2) = [0.5*(1.0-R),0.5*(1.0+R)]
	GXYZ(1:3) = 0.0D0

	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J) = GXYZ(J) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3)
	ENDIF

	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)

      DEALLOCATE(GPL)

50	FORMAT(/'Gausspoint "XFrame"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP6 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION PLANE
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3,9),H(NNM),P(2,NNM),NODEX(5),NPOGS(9)

	IF(NPT.EQ.4) THEN  !SONGSAK GID STRESS
	NPOGS(1) = 4
	NPOGS(2) = 2
	NPOGS(3) = 1
	NPOGS(4) = 3
	ELSEIF(NPT.EQ.3) THEN
	NPOGS(1) = 1
	NPOGS(2) = 2
	NPOGS(3) = 3
	ELSEIF(NPT.EQ.9) THEN
	NPOGS(1) = 9
	NPOGS(2) = 3
	NPOGS(3) = 1
	NPOGS(4) = 7
	NPOGS(5) = 6
	NPOGS(6) = 2
	NPOGS(7) = 4
	NPOGS(8) = 8
	NPOGS(9) = 5
	ENDIF


	NODEX(1:5) = [5,6,7,8,9]

	NNGR = NGR
	NNGS = NGS
	IF(NNM.EQ.3) THEN
	NNGR = 3
	NNGS = 1
	ENDIF

	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NNGR
	R = GLOC(IGR,NNGR)
	DO IGS = 1,NNGS
	S = GLOC(IGS,NNGS)

	IPT = IPT + 1

C     ----------------------------------------------
C     SHAPE FUNCTIONS (H),JACOBIAN DETERMINANT (DET)
C     AND DIRECTION COSINES (VR,VS,VT)
C     ----------------------------------------------
	IF(NNM.NE.3) CALL SHAP2D (R,S,H,P,NODEX,NNM)
	IF(NNM.EQ.9) CALL SHAP2D9(R,S,H,P,NODEX,NNM)				!9 NODE ELEMENT
	IF(NNM.EQ.3) THEN											!3 NODE
	CALL GAUSST(R,S,T,WT,IPT,NNGR,0)
	CALL SHAP2D3(R,S,H,P,NNM)
	ENDIF
C     --------------------------------------------------------

	GXYZ(1:3,IPT) = 0.0D0
	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J,IPT) = GXYZ(J,IPT) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	ENDDO
	ENDDO

	DO IPT = 1,NPT	
	IGP = NPOGS(IPT)
	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3,IGP)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3,IGP)
	ENDIF
	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XPlane"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP8 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION PLANE CONSOLIDATION
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3,9),H(NNM),P(2,NNM),NODEX(5),NPOGS(9)

	IF(NPT.EQ.4) THEN  !SONGSAK GID STRESS
	NPOGS(1) = 4
	NPOGS(2) = 2
	NPOGS(3) = 1
	NPOGS(4) = 3
	ELSEIF(NPT.EQ.3) THEN
	NPOGS(1) = 1
	NPOGS(2) = 2
	NPOGS(3) = 3
	ELSEIF(NPT.EQ.9) THEN
	NPOGS(1) = 9
	NPOGS(2) = 3
	NPOGS(3) = 1
	NPOGS(4) = 7
	NPOGS(5) = 6
	NPOGS(6) = 2
	NPOGS(7) = 4
	NPOGS(8) = 8
	NPOGS(9) = 5
	ENDIF


	NODEX(1:5) = [5,6,7,8,9]

	NNGR = NGR
	NNGS = NGS
	IF(NNM.EQ.3) THEN
	NNGR = 3
	NNGS = 1
	ENDIF

	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NNGR
	R = GLOC(IGR,NNGR)
	DO IGS = 1,NNGS
	S = GLOC(IGS,NNGS)

	IPT = IPT + 1

C     ----------------------------------------------
C     SHAPE FUNCTIONS (H),JACOBIAN DETERMINANT (DET)
C     AND DIRECTION COSINES (VR,VS,VT)
C     ----------------------------------------------
	IF(NNM.NE.3) CALL SHAP2D (R,S,H,P,NODEX,NNM)
	IF(NNM.EQ.9) CALL SHAP2D9(R,S,H,P,NODEX,NNM)				!9 NODE ELEMENT
	IF(NNM.EQ.3) THEN											!3 NODE
	CALL GAUSST(R,S,T,WT,IPT,NNGR,0)
	CALL SHAP2D3(R,S,H,P,NNM)
	ENDIF
C     --------------------------------------------------------

	GXYZ(1:3,IPT) = 0.0D0
	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J,IPT) = GXYZ(J,IPT) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	ENDDO
	ENDDO

	DO IPT = 1,NPT	
	IGP = NPOGS(IPT)
	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3,IGP)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3,IGP)
	ENDIF
	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XConso Plane"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP9 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION SHELL
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3,9),H(NNM),P(2,NNM),NODEX(5),NPOGS(9)

	IF(NPT.EQ.4) THEN  !SONGSAK GID STRESS
	NPOGS(1) = 4
	NPOGS(2) = 2
	NPOGS(3) = 1
	NPOGS(4) = 3
	ELSEIF(NPT.EQ.3) THEN
	NPOGS(1) = 1
	NPOGS(2) = 2
	NPOGS(3) = 3
	ELSEIF(NPT.EQ.9) THEN
	NPOGS(1) = 9
	NPOGS(2) = 3
	NPOGS(3) = 1
	NPOGS(4) = 7
	NPOGS(5) = 6
	NPOGS(6) = 2
	NPOGS(7) = 4
	NPOGS(8) = 8
	NPOGS(9) = 5
	ENDIF

C	SHELL QSI
	IF(ISTYP.EQ.4) NPOGS(1:4) = [1,2,3,4]

	NNGR = NGR
	NNGS = NGS
	IF(NNM.EQ.3) THEN
	NNGR = 3
	NNGS = 1
	ENDIF

	NODEX(1:5) = [5,6,7,8,9]

	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NNGR
	R = GLOC(IGR,NNGR)
	DO IGS = 1,NNGS
	S = GLOC(IGS,NNGS)

	IPT = IPT + 1

C     ----------------------------------------------
C     SHAPE FUNCTIONS (H)
C     ----------------------------------------------

	IF(NNM.EQ.3) THEN !SHELL 3 NODE QSI
	IF(IPT.EQ.1) H(1:3) = [1.0,0.0,0.0]
	IF(IPT.EQ.2) H(1:3) = [0.0,1.0,0.0]
	IF(IPT.EQ.3) H(1:3) = [0.0,0.0,1.0]
	ENDIF
	IF(ISTYP.EQ.4.AND.NNM.EQ.4) THEN !SHELL 4 NODE QSI
	IF(IPT.EQ.1) H(1:4) = [1.0,0.0,0.0,0.0]
	IF(IPT.EQ.2) H(1:4) = [0.0,1.0,0.0,0.0]
	IF(IPT.EQ.3) H(1:4) = [0.0,0.0,1.0,0.0]
	IF(IPT.EQ.4) H(1:4) = [0.0,0.0,0.0,1.0]
	ENDIF
	IF(ISTYP.NE.4.AND.NNM.NE.3) CALL SHAP2D (R,S,H,P,NODEX,NNM) !4 NODE AND 8 NODE
	IF(NNM.EQ.9) CALL SHAP2D9(R,S,H,P,NODEX,NNM)            !9 NODE ELEMENT
C     --------------------------------------------------------

	GXYZ(1:3,IPT) = 0.0D0
	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J,IPT) = GXYZ(J,IPT) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	ENDDO
	ENDDO

	DO IPT = 1,NPT	
	IGP = NPOGS(IPT)
	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3,IGP)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3,IGP)
	ENDIF
	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XShell"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP10 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION SOLID
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3,27),H(NNM),P(3,NNM),NPOGS(27)

C     NOTHING FOR SOLID SHELL
      IF(ISTYP.EQ.4) RETURN
      
C     -------------------------------
	IF(NPT.EQ.8) THEN
	NPOGS(1) = 7
	NPOGS(2) = 3
	NPOGS(4) = 5
	NPOGS(3) = 1
	NPOGS(5) = 8
	NPOGS(6) = 4
	NPOGS(8) = 6
	NPOGS(7) = 2
	ENDIF
	IF(NPT.EQ.4) THEN
	NPOGS(1) = 2
	NPOGS(2) = 1
	NPOGS(3) = 4
	NPOGS(4) = 3
	ENDIF
C     ---------------------------------

	NNGR = NGR
	NNGS = NGS
	NNGT = NGT

	IF(NNM.EQ.4.OR.NNM.EQ.10) THEN
	NNGR = 4
	IF(NNM.EQ.10) NNGR = 4
	NNGS = 1
	NNGT = 1
	ENDIF


	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NNGR
	R = GLOC(IGR,NNGR)
	DO IGS = 1,NNGS
	S = GLOC(IGS,NNGS)
	DO IGT = 1,NNGT
	T = GLOC(IGT,NNGT)
	IPT = IPT + 1

C     ----------------------------------------------
C     SHAPE FUNCTIONS (H)
C     ----------------------------------------------

	IF(NNM.EQ.4.OR.NNM.EQ.10) THEN
	CALL GAUSST (R,S,T,WT,IPT,NNGR,1)
	CALL SHAP3DT(R,S,T,H,P,NNM)
	ELSE
      CALL SHAP3D8 (R,S,T,H,P) 
	ENDIF

C     --------------------------------------------------------

	GXYZ(1:3,IPT) = 0.0D0
	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J,IPT) = GXYZ(J,IPT) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	ENDDO
	ENDDO
	ENDDO

	DO IPT = 1,NPT	
	IGP = NPOGS(IPT)
	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3,IGP)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3,IGP)
	ENDIF
	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XSolid"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP11 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION SOLID CONSOLIDATION
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3,27),H(NNM),P(3,NNM),NPOGS(27)

C     -------------------------------
	IF(NPT.EQ.8) THEN
	NPOGS(1) = 7
	NPOGS(2) = 3
	NPOGS(4) = 5
	NPOGS(3) = 1
	NPOGS(5) = 8
	NPOGS(6) = 4
	NPOGS(8) = 6
	NPOGS(7) = 2
	ENDIF
	IF(NPT.EQ.4) THEN
	NPOGS(1) = 2
	NPOGS(2) = 1
	NPOGS(3) = 4
	NPOGS(4) = 3
	ENDIF
C     ---------------------------------

	NNGR = NGR
	NNGS = NGS
	NNGT = NGT

	IF(NNM.EQ.4.OR.NNM.EQ.10) THEN
	NNGR = 4
	IF(NNM.EQ.10) NNGR = 4
	NNGS = 1
	NNGT = 1
	ENDIF


	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NNGR
	R = GLOC(IGR,NNGR)
	DO IGS = 1,NNGS
	S = GLOC(IGS,NNGS)
	DO IGT = 1,NNGT
	T = GLOC(IGT,NNGT)
	IPT = IPT + 1

C     ----------------------------------------------
C     SHAPE FUNCTIONS (H)
C     ----------------------------------------------

	IF(NNM.EQ.4.OR.NNM.EQ.10) THEN
	CALL GAUSST (R,S,T,WT,IPT,NNGR,1)
	CALL SHAP3DT(R,S,T,H,P,NNM)
	ELSE
      CALL SHAP3D8 (R,S,T,H,P) 
	ENDIF

C     --------------------------------------------------------

	GXYZ(1:3,IPT) = 0.0D0
	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J,IPT) = GXYZ(J,IPT) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	ENDDO
	ENDDO
	ENDDO

	DO IPT = 1,NPT	
	IGP = NPOGS(IPT)
	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3,IGP)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3,IGP)
	ENDIF
	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XConso Solid"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP13 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION PLANE SEEPAGE
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3,9),H(NNM),P(2,NNM),NODEX(5),NPOGS(9)

	IF(NPT.EQ.4) THEN  !SONGSAK GID STRESS
	NPOGS(1) = 4
	NPOGS(2) = 2
	NPOGS(3) = 1
	NPOGS(4) = 3
	ELSEIF(NPT.EQ.3) THEN
	NPOGS(1) = 1
	NPOGS(2) = 2
	NPOGS(3) = 3
	ELSEIF(NPT.EQ.9) THEN
	NPOGS(1) = 9
	NPOGS(2) = 3
	NPOGS(3) = 1
	NPOGS(4) = 7
	NPOGS(5) = 6
	NPOGS(6) = 2
	NPOGS(7) = 4
	NPOGS(8) = 8
	NPOGS(9) = 5
	ENDIF


	NODEX(1:5) = [5,6,7,8,9]

	NNGR = NGR
	NNGS = NGS
	IF(NNM.EQ.3) THEN
	NNGR = 3
	NNGS = 1
	ENDIF

	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NNGR
	R = GLOC(IGR,NNGR)
	DO IGS = 1,NNGS
	S = GLOC(IGS,NNGS)

	IPT = IPT + 1

C     ----------------------------------------------
C     SHAPE FUNCTIONS (H),JACOBIAN DETERMINANT (DET)
C     AND DIRECTION COSINES (VR,VS,VT)
C     ----------------------------------------------
	IF(NNM.NE.3) CALL SHAP2D (R,S,H,P,NODEX,NNM)
	IF(NNM.EQ.9) CALL SHAP2D9(R,S,H,P,NODEX,NNM)				!9 NODE ELEMENT
	IF(NNM.EQ.3) THEN											!3 NODE
	CALL GAUSST(R,S,T,WT,IPT,NNGR,0)
	CALL SHAP2D3(R,S,H,P,NNM)
	ENDIF
C     --------------------------------------------------------

	GXYZ(1:3,IPT) = 0.0D0
	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J,IPT) = GXYZ(J,IPT) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	ENDDO
	ENDDO


	DO IPT = 1,NPT	
	IGP = NPOGS(IPT)
	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3,IGP)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3,IGP)
	ENDIF
	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XSeepage Plane"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP14 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION SOLID SEEPAGE
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3,27),H(NNM),P(3,NNM),NPOGS(27)

C     -------------------------------
	IF(NPT.EQ.8) THEN
	NPOGS(1) = 7
	NPOGS(2) = 3
	NPOGS(4) = 5
	NPOGS(3) = 1
	NPOGS(5) = 8
	NPOGS(6) = 4
	NPOGS(8) = 6
	NPOGS(7) = 2
	ENDIF
	IF(NPT.EQ.4) THEN
	NPOGS(1) = 2
	NPOGS(2) = 1
	NPOGS(3) = 4
	NPOGS(4) = 3
	ENDIF
C     ---------------------------------

	NNGR = NGR
	NNGS = NGS
	NNGT = NGT

	IF(NNM.EQ.4.OR.NNM.EQ.10) THEN
	NNGR = 4
	IF(NNM.EQ.10) NNGR = 4
	NNGS = 1
	NNGT = 1
	ENDIF


	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NNGR
	R = GLOC(IGR,NNGR)
	DO IGS = 1,NNGS
	S = GLOC(IGS,NNGS)
	DO IGT = 1,NNGT
	T = GLOC(IGT,NNGT)
	IPT = IPT + 1

C     ----------------------------------------------
C     SHAPE FUNCTIONS (H)
C     ----------------------------------------------

	IF(NNM.EQ.4.OR.NNM.EQ.10) THEN
	CALL GAUSST (R,S,T,WT,IPT,NNGR,1)
	CALL SHAP3DT(R,S,T,H,P,NNM)
	ELSE
      CALL SHAP3D8 (R,S,T,H,P) 
	ENDIF

C     --------------------------------------------------------

	GXYZ(1:3,IPT) = 0.0D0
	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J,IPT) = GXYZ(J,IPT) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	ENDDO
	ENDDO
	ENDDO

	DO IPT = 1,NPT	
	IGP = NPOGS(IPT)
	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3,IGP)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3,IGP)
	ENDIF
	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XSeepage Solid"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP15 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION PLANE HEAT
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3,9),H(NNM),P(2,NNM),NODEX(5),NPOGS(9)

	IF(NPT.EQ.4) THEN  !SONGSAK GID STRESS
	NPOGS(1) = 4
	NPOGS(2) = 2
	NPOGS(3) = 1
	NPOGS(4) = 3
	ELSEIF(NPT.EQ.3) THEN
	NPOGS(1) = 1
	NPOGS(2) = 2
	NPOGS(3) = 3
	ELSEIF(NPT.EQ.9) THEN
	NPOGS(1) = 9
	NPOGS(2) = 3
	NPOGS(3) = 1
	NPOGS(4) = 7
	NPOGS(5) = 6
	NPOGS(6) = 2
	NPOGS(7) = 4
	NPOGS(8) = 8
	NPOGS(9) = 5
	ENDIF


	NODEX(1:5) = [5,6,7,8,9]

	NNGR = NGR
	NNGS = NGS
	IF(NNM.EQ.3) THEN
	NNGR = 3
	NNGS = 1
	ENDIF

	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NNGR
	R = GLOC(IGR,NNGR)
	DO IGS = 1,NNGS
	S = GLOC(IGS,NNGS)

	IPT = IPT + 1

C     ----------------------------------------------
C     SHAPE FUNCTIONS (H),JACOBIAN DETERMINANT (DET)
C     AND DIRECTION COSINES (VR,VS,VT)
C     ----------------------------------------------
	IF(NNM.NE.3) CALL SHAP2D (R,S,H,P,NODEX,NNM)
	IF(NNM.EQ.9) CALL SHAP2D9(R,S,H,P,NODEX,NNM)				!9 NODE ELEMENT
	IF(NNM.EQ.3) THEN											!3 NODE
	CALL GAUSST(R,S,T,WT,IPT,NNGR,0)
	CALL SHAP2D3(R,S,H,P,NNM)
	ENDIF
C     --------------------------------------------------------

	GXYZ(1:3,IPT) = 0.0D0
	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J,IPT) = GXYZ(J,IPT) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	ENDDO
	ENDDO

	DO IPT = 1,NPT	
	IGP = NPOGS(IPT)
	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3,IGP)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3,IGP)
	ENDIF
	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XHeat Plane"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
	SUBROUTINE GAUSSTYP16 (XYZ,IGIDM,ITO) 
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N)
C     -------------------------------------------------------------
C     PRINT GAUSS POSITION SOLID HEAT
C     -------------------------------------------------------------
	COMMON /ELEM/ NAME(2),ITYPE,ISTYP,NLOPT,MTMOD,NSINC,ITOLEY,
     1              NELE,NMPS,NGPS,NMP,NGP,NNM,NEX,NCO,NNF,NWG,NEFC,
     2              NPT,NWA,NWS,KEG,MEL,NNO,NEF,NELTOT,NMV,MTYP,ISECT
	COMMON /GAUS/ GLOC(10,10),GWT(10,10),NGR,NGS,NGT
C	==================================================================
      DIMENSION XYZ(NCO*NNM,NELE),IGIDM(NELE)
	DIMENSION GXYZ(3,27),H(NNM),P(3,NNM),NPOGS(27)

C     -------------------------------
	IF(NPT.EQ.8) THEN
	NPOGS(1) = 7
	NPOGS(2) = 3
	NPOGS(4) = 5
	NPOGS(3) = 1
	NPOGS(5) = 8
	NPOGS(6) = 4
	NPOGS(8) = 6
	NPOGS(7) = 2
	ENDIF
	IF(NPT.EQ.4) THEN
	NPOGS(1) = 2
	NPOGS(2) = 1
	NPOGS(3) = 4
	NPOGS(4) = 3
	ENDIF
C     ---------------------------------

	NNGR = NGR
	NNGS = NGS
	NNGT = NGT

	IF(NNM.EQ.4.OR.NNM.EQ.10) THEN
	NNGR = 4
	IF(NNM.EQ.10) NNGR = 4
	NNGS = 1
	NNGT = 1
	ENDIF


	H(1:NNM) = 0.0D0

	WRITE(ITO,50) NPT

C	-------------------------------------------
	DO 1000 IEL = 1,NELE
	IGD = IGIDM(IEL) 

	IPT = 0
	DO IGR = 1,NNGR
	R = GLOC(IGR,NNGR)
	DO IGS = 1,NNGS
	S = GLOC(IGS,NNGS)
	DO IGT = 1,NNGT
	T = GLOC(IGT,NNGT)
	IPT = IPT + 1

C     ----------------------------------------------
C     SHAPE FUNCTIONS (H)
C     ----------------------------------------------

	IF(NNM.EQ.4.OR.NNM.EQ.10) THEN
	CALL GAUSST (R,S,T,WT,IPT,NNGR,1)
	CALL SHAP3DT(R,S,T,H,P,NNM)
	ELSE
      CALL SHAP3D8 (R,S,T,H,P) 
	ENDIF

C     --------------------------------------------------------

	GXYZ(1:3,IPT) = 0.0D0
	K = 0
	DO I = 1,NNM
	DO J = 1,NCO
	K = K + 1
	GXYZ(J,IPT) = GXYZ(J,IPT) + H(I)*XYZ(K,IEL)
	ENDDO
	ENDDO

	ENDDO
	ENDDO
	ENDDO

	DO IPT = 1,NPT	
	IGP = NPOGS(IPT)
	IF(IPT.EQ.1) THEN
	WRITE(ITO,100) IGD,IPT,GXYZ(1:3,IGP)
	ELSE
	WRITE(ITO,101)	   IPT,GXYZ(1:3,IGP)
	ENDIF
	ENDDO

1000	CONTINUE
C	-------------------------------------------

	WRITE(ITO,500)



50	FORMAT(/'Gausspoint "XHeat Solid"',X,I3/,
	1		'Element "Gauss No." "x" "y" "z"'/,
	2		'Values')
100	FORMAT(X,I5,2X,I5,X,3E12.5)
101	FORMAT(X,5X,2X,I5,X,3E12.5)
500	FORMAT('End Values'/)

      RETURN

      END
C
C	=======================================================================
C	=======================================================================
C	=======================================================================
    	SUBROUTINE CODETYPE (ITYPE,ISTYP,IEG,NNEG,OPT,NOPTOUT)
	IMPLICIT REAL*8 (A-H,O-Z)
      IMPLICIT INTEGER*4 (I-N) 
      CHARACTER*5 OPT
      COMMON /CODEMEM/ NTYPE(30),NSTYP(30),NEG

      IF (OPT.EQ."STORE")THEN
      NTYPE(IEG) = ITYPE  
      NSTYP(IEG) = ISTYP
      NEG        = NNEG
      ELSEIF (OPT.EQ."READD")THEN
       DO I = 1,NEG
           IF (NTYPE(I).EQ.2)THEN
               IF (NSTYP(I).EQ.8)THEN
               NOPTOUT = 1   
               ENDIF
           ENDIF
       ENDDO
      ENDIF
      
      END

